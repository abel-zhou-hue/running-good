<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="email=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="x5-orientation" content="portrait">
    <meta name="x5-fullscreen" content="true">
    <meta name="x5-page-mode" content="app">
    <title>è·‘æ­¥æ‰“å¡è®°å½•ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* å¾®ä¿¡æµè§ˆå™¨é€‚é…æ ·å¼ */
        .weui-fix {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        /* å¾®ä¿¡æµè§ˆå™¨å­—ä½“ä¼˜åŒ– */
        body.wechat {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        /* AIè¯†åˆ«åŠŸèƒ½å·²ç§»é™¤ - ç›¸å…³æ ·å¼å·²æ¸…ç† */

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #ff6b6b, #ffa726);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
            padding: 25px;
            border-radius: 10px;
            background: #f8f9fa;
            border-left: 5px solid #007bff;
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
        }

        .section h2::before {
            content: "ğŸƒâ€";
            margin-right: 10px;
            font-size: 1.2em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        .btn {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,123,255,0.3);
        }

        .btn-success {
            background: linear-gradient(45deg, #28a745, #1e7e34);
        }

        .btn-danger {
            background: linear-gradient(45deg, #dc3545, #c82333);
        }

        .btn-warning {
            background: linear-gradient(45deg, #ffc107, #e0a800);
            color: #333;
        }

        .runner-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .runner-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 4px solid #28a745;
            transition: transform 0.3s;
        }

        .runner-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .runner-card.incomplete {
            border-left-color: #dc3545;
        }

        .runner-card.warning {
            border-left-color: #ffc107;
        }

        .runner-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .runner-target {
            color: #666;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #28a745, #20c997);
            border-radius: 10px;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .week-stats {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 15px;
        }

        .day-stat {
            text-align: center;
            padding: 8px 4px;
            border-radius: 5px;
            font-size: 0.8em;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
        }

        .day-stat.completed {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .day-stat.incomplete {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .records-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .records-table th,
        .records-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .records-table th {
            background: #007bff;
            color: white;
            font-weight: bold;
        }

        .records-table tr:hover {
            background: #f8f9fa;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-top: 4px solid #007bff;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
        }

        .penalty-info {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .penalty-info h3 {
            margin-bottom: 10px;
        }

        .hidden {
            display: none;
        }

        /* å·²ç§»é™¤å·¦å³åˆ†æ å¸ƒå±€ - ç•Œé¢ç®€åŒ– */

        /* æ¯å‘¨å†å²è®°å½•æ ·å¼ */
        .week-history-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .week-history-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            text-align: center;
            border-left: 4px solid #007bff;
        }

        .week-history-card h4 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 16px;
        }

        .week-history-card .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 5px;
        }

        .week-history-card .stat-label {
            color: #666;
            font-size: 14px;
        }

        .week-history-details {
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .week-history-runner {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .week-history-runner:last-child {
            border-bottom: none;
        }

        .week-history-runner-name {
            font-weight: bold;
            color: #333;
            font-size: 16px;
        }

        .week-history-runner-stats {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .week-history-runner-stat {
            text-align: center;
        }

        .week-history-runner-stat .value {
            font-weight: bold;
            color: #007bff;
            font-size: 14px;
        }

        .week-history-runner-stat .label {
            font-size: 12px;
            color: #666;
        }

        .status-complete {
            color: #28a745;
        }

        .status-incomplete {
            color: #dc3545;
        }

        .divider {
            text-align: center;
            margin: 20px 0;
            color: #666;
            font-weight: bold;
            position: relative;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #ddd;
            z-index: 1;
        }

        .divider span {
            background: white;
            padding: 0 15px;
            position: relative;
            z-index: 2;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .runner-list {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .week-stats {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .summary-stats {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }

            /* ç§»åŠ¨ç«¯è¡¨æ ¼ä¼˜åŒ– */
            .records-table {
                font-size: 12px;
            }
            
            .records-table th,
            .records-table td {
                padding: 8px 4px;
            }
            
            /* ç§»åŠ¨ç«¯æŒ‰é’®ä¼˜åŒ– */
            .btn {
                padding: 8px 12px;
                font-size: 14px;
                margin: 2px;
            }
            
            /* ç§»åŠ¨ç«¯è¡¨å•ä¼˜åŒ– */
            .form-group {
                margin-bottom: 15px;
            }
            
            .form-group label {
                font-size: 14px;
                margin-bottom: 5px;
            }
            
            .form-group input,
            .form-group select {
                padding: 10px;
                font-size: 14px;
            }
            
            /* ç§»åŠ¨ç«¯å†å²è®°å½•å¯¼èˆªä¼˜åŒ– */
            .week-history-stats {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
            
            .week-history-card {
                padding: 15px;
            }
            
            /* ç§»åŠ¨ç«¯è·‘å‹å¡ç‰‡ä¼˜åŒ– */
            .runner-card {
                padding: 15px;
                margin-bottom: 10px;
            }
            
            .runner-name {
                font-size: 16px;
            }
            
            .runner-stats {
                font-size: 12px;
            }
            
            /* ç§»åŠ¨ç«¯æ ‡é¢˜ä¼˜åŒ– */
            .header h1 {
                font-size: 24px;
            }
            
            .header p {
                font-size: 14px;
            }
            
            .section h2 {
                font-size: 18px;
                padding: 10px;
                margin: -20px -20px 20px -20px;
            }
            
            /* ç§»åŠ¨ç«¯å‘¨ç»Ÿè®¡ä¼˜åŒ– */
            .day-stat {
                padding: 8px;
                font-size: 12px;
            }
            
            .day-stat .day-name {
                font-size: 10px;
            }
            
            /* ç§»åŠ¨ç«¯å†å²è®°å½•è¯¦æƒ…ä¼˜åŒ– */
            .week-history-details {
                font-size: 14px;
            }
            
            .history-runner-item {
                padding: 10px;
                margin-bottom: 8px;
            }
            
            /* ç§»åŠ¨ç«¯ç»Ÿè®¡å¡ç‰‡ä¼˜åŒ– */
            .stat-card {
                padding: 15px;
            }
            
            .stat-number {
                font-size: 1.5em;
            }
            
            .stat-label {
                font-size: 0.8em;
            }
            
            /* ç§»åŠ¨ç«¯è·‘å‹å¡ç‰‡ä¼˜åŒ– */
            .runner-card {
                padding: 15px;
                margin-bottom: 10px;
            }
            
            .runner-name {
                font-size: 1.1em;
            }
            
            .runner-target {
                font-size: 0.8em;
            }
            
            .progress-bar {
                height: 15px;
            }
            
            .progress-fill {
                font-size: 10px;
            }
            
            /* ç§»åŠ¨ç«¯å¯¼èˆªæŒ‰é’®ç»„ä¼˜åŒ– */
            .section > div[style*="display: flex"] {
                flex-direction: column;
                gap: 10px;
            }
            
            .section > div[style*="display: flex"] > button {
                width: 100%;
                margin: 0;
            }
            
            .section > div[style*="display: flex"] > div {
                width: 100%;
                margin: 10px 0;
            }
            
            /* å·²ç§»é™¤record-sectionå“åº”å¼å¸ƒå±€ - ç•Œé¢ç®€åŒ– */
        }
        
        /* è¶…å°å±å¹•é¢å¤–ä¼˜åŒ– */
        @media (max-width: 480px) {
            .container {
                margin: 5px;
                border-radius: 8px;
            }
            
            .main-content {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            .section h2 {
                font-size: 16px;
                margin: -15px -15px 15px -15px;
            }
            
            .records-table {
                font-size: 11px;
            }
            
            .records-table th,
            .records-table td {
                padding: 6px 2px;
            }
            
            .btn {
                padding: 6px 10px;
                font-size: 12px;
            }
            
            .week-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 5px;
            }
            
            .day-stat {
                padding: 6px;
                font-size: 11px;
            }
            
            /* è¶…å°å±å¹•ä¸‹çš„å¸ƒå±€è°ƒæ•´ */
            .summary-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            
            .week-history-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            
            .stat-card,
            .week-history-card {
                padding: 12px;
            }
            
            .stat-number,
            .week-history-card .stat-value {
                font-size: 18px;
            }
        }
        
        /* è§¦æ‘¸è®¾å¤‡ä¼˜åŒ– */
        @media (hover: none) and (pointer: coarse) {
            .btn {
                min-height: 44px; /* iOSæ¨èçš„æœ€å°è§¦æ‘¸ç›®æ ‡ */
                -webkit-tap-highlight-color: transparent;
            }
            
            .btn:active {
                transform: scale(0.98);
                transition: transform 0.1s ease;
            }
            
            .runner-card {
                -webkit-tap-highlight-color: transparent;
            }
            
            .runner-card:active {
                transform: scale(0.99);
                transition: transform 0.1s ease;
            }
            
            /* ä¼˜åŒ–æ»šåŠ¨æ€§èƒ½ */
            .records-table {
                -webkit-overflow-scrolling: touch;
                overflow-x: auto;
                display: block;
            }
            
            /* é˜²æ­¢åŒå‡»ç¼©æ”¾ */
            .btn, .runner-card, .day-stat {
                touch-action: manipulation;
            }
            
            /* ç§»åŠ¨ç«¯æ›´å¥½çš„è§†è§‰åé¦ˆ */
            .week-history-card {
                transition: all 0.2s ease;
            }
            
            .week-history-card:active {
                transform: translateY(1px);
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
        }
        
        /* æš—è‰²æ¨¡å¼æ”¯æŒ */
        @media (prefers-color-scheme: dark) {
            body {
                background-color: #1a1a1a;
            }
            
            .container {
                background-color: #2d2d2d;
                color: #e0e0e0;
            }
            
            .section {
                background-color: #3d3d3d;
                border-color: #555;
            }
            
            .section h2 {
                background-color: #4a4a4a;
                color: #fff;
            }
            
            .form-group input,
            .form-group select {
                background-color: #4a4a4a;
                color: #e0e0e0;
                border-color: #666;
            }
            
            .records-table {
                background-color: #3d3d2d;
                color: #e0e0e0;
            }
            
            .records-table th {
                background-color: #4a4a4a;
            }
            
            .records-table tr:nth-child(even) {
                background-color: #454545;
            }
            
            .runner-card {
                background-color: #4a4a4a;
                border-color: #666;
            }
            
            .week-history-card {
                background-color: #4a4a4a;
                border-color: #666;
            }
            
            .day-stat {
                background-color: #4a4a4a;
                border-color: #666;
            }
            
            .status-complete {
                color: #4caf50;
            }
            
            .status-incomplete {
                color: #f44336;
            }
        }
        
        /* å¾®ä¿¡æµè§ˆå™¨ä¸“ç”¨ä¼˜åŒ– */
        .wechat-optimized .container {
            border-radius: 0;
            box-shadow: none;
            margin: 0;
            max-width: 100vw;
        }
        
        .wechat-optimized .header {
            border-radius: 0;
            padding: 15px;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .wechat-optimized .header h1 {
            font-size: 1.5em;
            margin-bottom: 5px;
        }
        
        .wechat-optimized .main-content {
            padding: 10px;
            padding-bottom: 20px;
        }
        
        .wechat-optimized .section {
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 8px;
        }
        
        .wechat-optimized .section h2 {
            font-size: 1.2em;
            margin: -15px -15px 10px -15px;
            padding: 10px 15px;
        }
        
        .wechat-optimized .btn {
            padding: 8px 16px;
            font-size: 14px;
            border-radius: 6px;
            min-height: 40px;
        }
        
        .wechat-optimized .runner-card {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .wechat-optimized .runner-name {
            font-size: 1.1em;
        }
        
        .wechat-optimized .stat-card {
            padding: 8px;
            border-radius: 6px;
        }
        
        .wechat-optimized .stat-number {
            font-size: 1.2em;
        }
        
        .wechat-optimized .stat-label {
            font-size: 0.8em;
        }
        
        /* å¾®ä¿¡æµè§ˆå™¨å®‰å…¨åŒºåŸŸé€‚é… */
        .wechat-safe-area {
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
        }
        
        /* å¾®ä¿¡æµè§ˆå™¨æ»šåŠ¨ä¼˜åŒ– */
        .wechat-scroll {
            -webkit-overflow-scrolling: touch;
            overflow-scrolling: touch;
        }
        
        /* å¾®ä¿¡æµè§ˆå™¨ç‚¹å‡»æ•ˆæœä¼˜åŒ– */
        .wechat-tap {
            -webkit-tap-highlight-color: rgba(0,0,0,0);
            tap-highlight-color: rgba(0,0,0,0);
        }
    </style>
    <!-- Tesseract.js OCRåº“å¼•ç”¨å·²ç§»é™¤ - AI/OCRåŠŸèƒ½å·²æ¸…ç† -->
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸƒâ€è·‘æ­¥æ‰“å¡è®°å½•ç³»ç»Ÿ</h1>
            <p>æ¯å‘¨è‡³å°‘3æ¬¡ï¼Œæ¯æ¬¡5å…¬é‡Œï¼ŒåšæŒå°±æ˜¯èƒœåˆ©ï¼</p>
        </div>

        <div class="main-content">
            <!-- æ·»åŠ æ–°æˆå‘˜ -->
            <div class="section">
                <h2>æ·»åŠ æ–°è·‘å‹</h2>
                <div class="form-group">
                    <label for="newRunnerName">è·‘å‹å§“åï¼š</label>
                    <input type="text" id="newRunnerName" placeholder="è¯·è¾“å…¥è·‘å‹å§“å">
                </div>
                <div class="form-group">
                    <label for="newRunnerTarget">å‘¨ç›®æ ‡è·ç¦»ï¼š</label>
                    <select id="newRunnerTarget">
                        <option value="20">20å…¬é‡Œ</option>
                        <option value="25">25å…¬é‡Œ</option>
                    </select>
                </div>
                <button class="btn btn-success" onclick="addRunner()">æ·»åŠ è·‘å‹</button>
            </div>

            <!-- æ·»åŠ è·‘æ­¥è®°å½• -->
            <div class="section">
                <h2>æ·»åŠ è·‘æ­¥è®°å½•</h2>
                <div class="form-group">
                    <label for="runnerSelect">é€‰æ‹©è·‘å‹ï¼š</label>
                    <select id="runnerSelect"></select>
                </div>
                <div class="form-group">
                    <label for="runDate">è·‘æ­¥æ—¥æœŸï¼š</label>
                    <input type="date" id="runDate">
                </div>
                <div class="form-group">
                    <label for="runDistance">è·‘æ­¥è·ç¦»ï¼ˆå…¬é‡Œï¼‰ï¼š</label>
                    <input type="number" id="runDistance" step="0.1" min="0" placeholder="è¯·è¾“å…¥è·‘æ­¥è·ç¦»">
                </div>
                <div class="form-group">
                    <label for="runDuration">è·‘æ­¥æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰ï¼š</label>
                    <input type="number" id="runDuration" step="1" min="0" placeholder="è¯·è¾“å…¥è·‘æ­¥æ—¶é•¿">
                </div>
                <div class="form-group">
                    <label for="runPace">è·‘æ­¥é…é€Ÿï¼ˆåˆ†é’Ÿ/å…¬é‡Œï¼‰ï¼š</label>
                    <input type="text" id="runPace" placeholder="è‡ªåŠ¨è®¡ç®—æˆ–æ‰‹åŠ¨è¾“å…¥ï¼Œå¦‚ï¼š5:30">
                </div>
                <div class="form-group">
                    <label for="runCalories">è·‘æ­¥æ¶ˆè€—ï¼ˆå¡è·¯é‡Œï¼‰ï¼š</label>
                    <input type="number" id="runCalories" step="1" min="0" placeholder="è‡ªåŠ¨ä¼°ç®—æˆ–æ‰‹åŠ¨è¾“å…¥">
                </div>
                <button class="btn" onclick="addRecord()">æ·»åŠ è®°å½•</button>
                <button class="btn btn-warning" onclick="calculatePaceAndCalories()">è®¡ç®—é…é€Ÿå’Œæ¶ˆè€—</button>
            </div>

            <!-- ç»Ÿè®¡æ¦‚è§ˆ -->
            <div class="section">
                <h2>æœ¬å‘¨ç»Ÿè®¡æ¦‚è§ˆ</h2>
                <div class="summary-stats" id="summaryStats"></div>
                <div class="penalty-info" id="penaltyInfo"></div>
            </div>

            <!-- è·‘å‹åˆ—è¡¨ -->
            <div class="section">
                <h2>è·‘å‹å®Œæˆæƒ…å†µ</h2>
                <div class="runner-list" id="runnerList"></div>
            </div>

            <!-- æ¯å‘¨å†å²è®°å½• -->
            <div class="section">
                <h2>æ¯å‘¨å†å²è®°å½•</h2>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <button class="btn" onclick="changeWeek(-1)">â† ä¸Šä¸€å‘¨</button>
                    <div style="text-align: center;">
                        <span id="currentWeekDisplay"></span>
                        <div style="margin-top: 10px;">
                            <button class="btn btn-warning" onclick="goToCurrentWeek()">è¿”å›æœ¬å‘¨</button>
                        </div>
                    </div>
                    <button class="btn" onclick="changeWeek(1)">ä¸‹ä¸€å‘¨ â†’</button>
                </div>
                <div class="week-history-stats" id="weekHistoryStats"></div>
                <div class="week-history-details" id="weekHistoryDetails"></div>
            </div>

            <!-- è¯¦ç»†è®°å½• -->
            <div class="section">
                <h2>è¯¦ç»†è·‘æ­¥è®°å½•</h2>
                <table class="records-table" id="recordsTable">
                    <thead>
                        <tr>
                            <th>è·‘å‹</th>
                            <th>æ—¥æœŸ</th>
                            <th>è·ç¦»(km)</th>
                            <th>æ—¶é•¿(åˆ†)</th>
                            <th>é…é€Ÿ</th>
                            <th>æ¶ˆè€—(å¡)</th>
                            <th>æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="recordsBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // æ•°æ®å­˜å‚¨
        let runners = JSON.parse(localStorage.getItem('runners')) || [];
        let records = JSON.parse(localStorage.getItem('runningRecords')) || [];
        
        // å†å²è®°å½•ç›¸å…³å˜é‡
        let currentWeekOffset = 0; // å½“å‰æŸ¥çœ‹çš„å‘¨åç§»é‡ï¼ˆ0è¡¨ç¤ºæœ¬å‘¨ï¼Œ-1è¡¨ç¤ºä¸Šå‘¨ï¼Œ1è¡¨ç¤ºä¸‹å‘¨ï¼‰

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºä»Šå¤©
            document.getElementById('runDate').valueAsDate = new Date();
            
            // æ›´æ–°ç•Œé¢
            updateRunnerSelect();
            updateRunnerList();
            updateRecordsTable();
            updateSummaryStats();
            updateWeekHistory(); // åˆå§‹åŒ–å†å²è®°å½•æ˜¾ç¤º
        });

        // ç®¡ç†å‘˜å¯†ç ï¼ˆå¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹ï¼‰
        const ADMIN_PASSWORD = 'running2024';

        // æ˜¾ç¤ºå¯†ç è¾“å…¥æ¨¡æ€æ¡†
        function showPasswordModal(callback) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;

            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white;
                padding: 30px;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                text-align: center;
                min-width: 300px;
            `;

            modalContent.innerHTML = `
                <h3 style="margin-bottom: 20px; color: #333;">ğŸ” ç®¡ç†å‘˜éªŒè¯</h3>
                <p style="margin-bottom: 15px; color: #666;">è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ï¼š</p>
                <input type="password" id="adminPassword" placeholder="è¯·è¾“å…¥å¯†ç " 
                       style="width: 100%; padding: 12px; border: 2px solid #ddd; 
                              border-radius: 8px; margin-bottom: 20px; font-size: 16px;">
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button class="btn btn-success" onclick="confirmPassword()">ç¡®è®¤</button>
                    <button class="btn btn-danger" onclick="cancelPassword()">å–æ¶ˆ</button>
                </div>
            `;

            modal.appendChild(modalContent);
            document.body.appendChild(modal);

            // èšç„¦åˆ°å¯†ç è¾“å…¥æ¡†
            setTimeout(() => {
                document.getElementById('adminPassword').focus();
            }, 100);

            // ç¡®è®¤å¯†ç å‡½æ•°
            window.confirmPassword = function() {
                const password = document.getElementById('adminPassword').value;
                if (password === ADMIN_PASSWORD) {
                    document.body.removeChild(modal);
                    delete window.confirmPassword;
                    delete window.cancelPassword;
                    callback(true);
                } else {
                    alert('å¯†ç é”™è¯¯ï¼');
                    document.getElementById('adminPassword').value = '';
                    document.getElementById('adminPassword').focus();
                }
            };

            // å–æ¶ˆå¯†ç å‡½æ•°
            window.cancelPassword = function() {
                document.body.removeChild(modal);
                delete window.confirmPassword;
                delete window.cancelPassword;
                callback(false);
            };

            // å›è½¦ç¡®è®¤
            document.getElementById('adminPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    confirmPassword();
                }
            });
        }

        // æ·»åŠ è·‘å‹ï¼ˆå¸¦æƒé™éªŒè¯ï¼‰
        function addRunner() {
            const name = document.getElementById('newRunnerName').value.trim();
            const target = parseInt(document.getElementById('newRunnerTarget').value);

            if (!name) {
                alert('è¯·è¾“å…¥è·‘å‹å§“åï¼');
                return;
            }

            if (runners.some(runner => runner.name === name)) {
                alert('è¯¥è·‘å‹å·²å­˜åœ¨ï¼');
                return;
            }

            // æ˜¾ç¤ºå¯†ç éªŒè¯æ¨¡æ€æ¡†
            showPasswordModal(function(isAuthenticated) {
                if (isAuthenticated) {
                    const newRunner = {
                        id: Date.now(),
                        name: name,
                        targetDistance: target,
                        joinDate: new Date().toISOString().split('T')[0]
                    };

                    runners.push(newRunner);
                    localStorage.setItem('runners', JSON.stringify(runners));

                    // æ¸…ç©ºè¾“å…¥
                    document.getElementById('newRunnerName').value = '';

                    // æ›´æ–°ç•Œé¢
                    updateRunnerSelect();
                    updateRunnerList();
                    updateSummaryStats();

                    alert('è·‘å‹æ·»åŠ æˆåŠŸï¼');
                } else {
                    alert('æ·»åŠ è·‘å‹å·²å–æ¶ˆ');
                }
            });
        }

        // æ›´æ–°è·‘å‹é€‰æ‹©ä¸‹æ‹‰æ¡†
        function updateRunnerSelect() {
            const select = document.getElementById('runnerSelect');
            select.innerHTML = '<option value="">è¯·é€‰æ‹©è·‘å‹</option>';
            
            runners.forEach(runner => {
                const option = document.createElement('option');
                option.value = runner.id;
                option.textContent = runner.name;
                select.appendChild(option);
            });
        }

        // è®¡ç®—é…é€Ÿå’Œå¡è·¯é‡Œæ¶ˆè€—
        function calculatePaceAndCalories() {
            const distance = parseFloat(document.getElementById('runDistance').value);
            const duration = parseFloat(document.getElementById('runDuration').value);
            const runnerId = document.getElementById('runnerSelect').value;

            if (!runnerId) {
                alert('è¯·å…ˆé€‰æ‹©è·‘å‹ï¼');
                return;
            }

            if (!distance || !duration || distance <= 0 || duration <= 0) {
                alert('è¯·å…ˆå¡«å†™è·‘æ­¥è·ç¦»å’Œæ—¶é•¿ï¼');
                return;
            }

            // è®¡ç®—é…é€Ÿï¼ˆåˆ†é’Ÿ/å…¬é‡Œï¼‰
            const pace = duration / distance;
            const paceMinutes = Math.floor(pace);
            const paceSeconds = Math.round((pace - paceMinutes) * 60);
            const paceString = `${paceMinutes}:${paceSeconds.toString().padStart(2, '0')}`;

            // ä¼°ç®—å¡è·¯é‡Œæ¶ˆè€—ï¼ˆåŸºäºä½“é‡65kgçš„ç²—ç•¥ä¼°ç®—ï¼‰
            const calories = Math.round(distance * duration * 0.1); // ç®€åŒ–çš„è®¡ç®—å…¬å¼

            // å¡«å……è®¡ç®—ç»“æœ
            document.getElementById('runPace').value = paceString;
            document.getElementById('runCalories').value = calories;

            alert(`è®¡ç®—å®Œæˆï¼\né…é€Ÿï¼š${paceString} åˆ†é’Ÿ/å…¬é‡Œ\nä¼°ç®—æ¶ˆè€—ï¼š${calories} å¡è·¯é‡Œ`);
        }

        // è§£æé…é€Ÿå­—ç¬¦ä¸²ï¼ˆå¦‚ï¼š5:30ï¼‰ä¸ºåˆ†é’Ÿæ•°
        function parsePace(paceString) {
            if (!paceString) return 0;
            const parts = paceString.split(':');
            if (parts.length === 2) {
                const minutes = parseInt(parts[0]) || 0;
                const seconds = parseInt(parts[1]) || 0;
                return minutes + seconds / 60;
            }
            return parseFloat(paceString) || 0;
        }

        // æ˜¾ç¤ºæ‰‹åŠ¨è¾“å…¥æç¤ºï¼ˆå·²ç§»é™¤å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½ï¼‰
        function showManualInputHint() {
            alert('ğŸ“‹ è¯·ä½¿ç”¨å·¦ä¾§è¡¨å•æ‰‹åŠ¨æ·»åŠ è·‘æ­¥è®°å½•\n\næ­¥éª¤ï¼š\n1. é€‰æ‹©è·‘å‹\n2. è¾“å…¥æ—¥æœŸ\n3. å¡«å†™è·ç¦»å’Œæ—¶é•¿\n4. ç‚¹å‡»"æ·»åŠ è®°å½•"');
        }

        // å·²ç§»é™¤æ‰€æœ‰OCRå’ŒAIè¯†åˆ«åŠŸèƒ½

        // å·²ç§»é™¤AIè¯†åˆ«åŠŸèƒ½ï¼ˆæ›¿æ¢ä¸ºæç¤ºï¼‰
        function performAIRecognition(imageData) {
            alert('ğŸš« AIæ™ºèƒ½è¯†åˆ«åŠŸèƒ½å·²ç§»é™¤\n\nè¯·ä½¿ç”¨å·¦ä¾§è¡¨å•æ‰‹åŠ¨æ·»åŠ è·‘æ­¥è®°å½•ã€‚\n\næ­¥éª¤ï¼š\n1. é€‰æ‹©è·‘å‹\n2. è¾“å…¥æ—¥æœŸ\n3. å¡«å†™è·ç¦»å’Œæ—¶é•¿\n4. ç‚¹å‡»"æ·»åŠ è®°å½•"');
        }

        // è°ƒç”¨SiliconFlow APIï¼ˆå·²ç§»é™¤ï¼‰
        function callSiliconFlowAPI(base64Image, modal, timeoutId) {
            alert('ğŸš« AIè¯†åˆ«åŠŸèƒ½å·²ç§»é™¤\n\nè¯·ä½¿ç”¨å·¦ä¾§è¡¨å•æ‰‹åŠ¨æ·»åŠ è·‘æ­¥è®°å½•ã€‚');
        }

        // å¤„ç†AIè¯†åˆ«ç»“æœï¼ˆå·²ç§»é™¤ï¼‰
        function processAIResult(aiData) {
            alert('ğŸš« AIè¯†åˆ«åŠŸèƒ½å·²ç§»é™¤\n\nè¯·ä½¿ç”¨å·¦ä¾§è¡¨å•æ‰‹åŠ¨æ·»åŠ è·‘æ­¥è®°å½•ã€‚');
        }

        // æ˜¾ç¤ºAIè¯†åˆ«ç»“æœï¼ˆå·²ç§»é™¤ï¼‰
        function showAIResult(data, rawData) {
            alert('ğŸš« AIè¯†åˆ«åŠŸèƒ½å·²ç§»é™¤\n\nè¯·ä½¿ç”¨å·¦ä¾§è¡¨å•æ‰‹åŠ¨æ·»åŠ è·‘æ­¥è®°å½•ã€‚');
        }

        // ä»AIè¡¨å•åº”ç”¨æ•°æ®ï¼ˆå·²ç§»é™¤ï¼‰
        function applyAIDataFromForm() {
            alert('ğŸš« AIè¯†åˆ«åŠŸèƒ½å·²ç§»é™¤\n\nè¯·ä½¿ç”¨å·¦ä¾§è¡¨å•æ‰‹åŠ¨æ·»åŠ è·‘æ­¥è®°å½•ã€‚');
        }

        // ä»AIç»“æœé‡è¯•ä¼ ç»ŸOCRï¼ˆå·²ç§»é™¤ï¼‰
        function retryWithTraditionalOCR() {
            alert('ğŸš« OCRè¯†åˆ«åŠŸèƒ½å·²ç§»é™¤\n\nè¯·ä½¿ç”¨å·¦ä¾§è¡¨å•æ‰‹åŠ¨æ·»åŠ è·‘æ­¥è®°å½•ã€‚');
        }

        // ä»AIç»“æœåˆ‡æ¢åˆ°æ‰‹åŠ¨è¾“å…¥ï¼ˆå·²ç§»é™¤ï¼‰
        function showManualInputModalFromAI() {
            alert('ğŸš« AIè¯†åˆ«åŠŸèƒ½å·²ç§»é™¤\n\nè¯·ä½¿ç”¨å·¦ä¾§è¡¨å•æ‰‹åŠ¨æ·»åŠ è·‘æ­¥è®°å½•ã€‚');
        }
        
        // ç”Ÿæˆæµ‹è¯•æˆªå›¾ï¼ˆå·²ç§»é™¤ï¼‰
        function generateTestScreenshot() {
            alert('ğŸš« æµ‹è¯•åŠŸèƒ½å·²ç§»é™¤\n\nè¯·ä½¿ç”¨å·¦ä¾§è¡¨å•æ‰‹åŠ¨æ·»åŠ è·‘æ­¥è®°å½•ã€‚');
        }

        // æ‰§è¡ŒAIè¯†åˆ«ï¼ˆå·²ç§»é™¤ï¼‰
        function performAIRecognition(imageData) {
            alert('ğŸš« AIè¯†åˆ«åŠŸèƒ½å·²ç§»é™¤\n\nè¯·ä½¿ç”¨å·¦ä¾§è¡¨å•æ‰‹åŠ¨æ·»åŠ è·‘æ­¥è®°å½•ã€‚');
        }

        // è°ƒç”¨SiliconFlow APIï¼ˆå·²ç§»é™¤ï¼‰
        function callSiliconFlowAPI(base64Image, modal, timeoutId) {
            alert('ğŸš« AIè¯†åˆ«åŠŸèƒ½å·²ç§»é™¤\n\nè¯·ä½¿ç”¨å·¦ä¾§è¡¨å•æ‰‹åŠ¨æ·»åŠ è·‘æ­¥è®°å½•ã€‚');
        }

        // å¤„ç†AIè¯†åˆ«ç»“æœï¼ˆå·²ç§»é™¤ï¼‰
        function processAIResult(aiData) {
            alert('ğŸš« AIè¯†åˆ«åŠŸèƒ½å·²ç§»é™¤\n\nè¯·ä½¿ç”¨å·¦ä¾§è¡¨å•æ‰‹åŠ¨æ·»åŠ è·‘æ­¥è®°å½•ã€‚');
        }

        // æ˜¾ç¤ºAIè¯†åˆ«ç»“æœï¼ˆå·²ç§»é™¤ï¼‰
        function showAIResult(data, rawData) {
            alert('ğŸš« AIè¯†åˆ«åŠŸèƒ½å·²ç§»é™¤\n\nè¯·ä½¿ç”¨å·¦ä¾§è¡¨å•æ‰‹åŠ¨æ·»åŠ è·‘æ­¥è®°å½•ã€‚');
        }

        // ä»AIè¡¨å•åº”ç”¨æ•°æ®ï¼ˆå·²ç§»é™¤ï¼‰
        function applyAIDataFromForm() {
            alert('ğŸš« AIè¯†åˆ«åŠŸèƒ½å·²ç§»é™¤\n\nè¯·ä½¿ç”¨å·¦ä¾§è¡¨å•æ‰‹åŠ¨æ·»åŠ è·‘æ­¥è®°å½•ã€‚');
        }

        // ä»AIç»“æœé‡è¯•ä¼ ç»ŸOCRï¼ˆå·²ç§»é™¤ï¼‰
        function retryWithTraditionalOCR() {
            alert('ğŸš« OCRè¯†åˆ«åŠŸèƒ½å·²ç§»é™¤\n\nè¯·ä½¿ç”¨å·¦ä¾§è¡¨å•æ‰‹åŠ¨æ·»åŠ è·‘æ­¥è®°å½•ã€‚');
        }

        // ä»AIç»“æœåˆ‡æ¢åˆ°æ‰‹åŠ¨è¾“å…¥ï¼ˆå·²ç§»é™¤ï¼‰
        function showManualInputModalFromAI() {
            alert('ğŸš« AIè¯†åˆ«åŠŸèƒ½å·²ç§»é™¤\n\nè¯·ä½¿ç”¨å·¦ä¾§è¡¨å•æ‰‹åŠ¨æ·»åŠ è·‘æ­¥è®°å½•ã€‚');
        }
        
        // ç”Ÿæˆæµ‹è¯•è·‘æ­¥æˆªå›¾ - å·²ç§»é™¤
        function generateTestScreenshot() {
            alert('æµ‹è¯•æˆªå›¾åŠŸèƒ½å·²ç§»é™¤ï¼Œè¯·ä½¿ç”¨å·¦ä¾§è¡¨å•æ‰‹åŠ¨æ·»åŠ è·‘æ­¥è®°å½•');
        }

        // æ˜¾ç¤ºæ‰‹åŠ¨è¾“å…¥æ¨¡æ€æ¡†ï¼ˆOCRå¤±è´¥æ—¶ä½¿ç”¨ï¼‰- å·²ç§»é™¤
        function showManualInputModal() {
            alert('OCRè¯†åˆ«åŠŸèƒ½å·²ç§»é™¤ï¼Œè¯·ä½¿ç”¨å·¦ä¾§è¡¨å•æ‰‹åŠ¨æ·»åŠ è·‘æ­¥è®°å½•');
        }

        // åº”ç”¨æ‰‹åŠ¨è¾“å…¥çš„æ•°æ® - å·²ç§»é™¤
        function applyManualData() {
            alert('OCRè¯†åˆ«åŠŸèƒ½å·²ç§»é™¤ï¼Œè¯·ä½¿ç”¨å·¦ä¾§è¡¨å•æ‰‹åŠ¨æ·»åŠ è·‘æ­¥è®°å½•');
        }

        // ç›´æ¥æ˜¾ç¤ºæ‰‹åŠ¨è¾“å…¥ç•Œé¢ï¼ˆè·³è¿‡OCRï¼‰- å·²ç§»é™¤
        function directManualInput() {
            alert('OCRè¯†åˆ«åŠŸèƒ½å·²ç§»é™¤ï¼Œè¯·ä½¿ç”¨å·¦ä¾§è¡¨å•æ‰‹åŠ¨æ·»åŠ è·‘æ­¥è®°å½•');
        }

        // åˆ›å»ºæ¨¡æ€æ¡†
        function createModal(content) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.cssText = `
                position: fixed;
                top: 0; left: 0;
                width: 100%; height: 100%;
                background: rgba(0,0,0,.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 2000;
            `;
            modal.appendChild(content);
            return modal;
        }

        // å¤„ç†OCRè¯†åˆ«ç»“æœ
        function processOCRResult(text) {
            console.log('OCRè¯†åˆ«ç»“æœï¼š', text);
            
            // æå–è·‘æ­¥æ•°æ®çš„æ­£åˆ™è¡¨è¾¾å¼ - å¢å¼ºç‰ˆæœ¬
            const patterns = {
                // è·ç¦»ï¼šæ”¯æŒå¤šç§æ ¼å¼ï¼ŒåŒ…æ‹¬å°æ•°ç‚¹
                distance: /(\d+\.?\d*)\s*(å…¬é‡Œ|km|åƒç±³|KM|å…¬é‡Œ|km)/gi,
                // æ—¶é•¿ï¼šæ”¯æŒåˆ†é’Ÿã€å°æ—¶åˆ†é’Ÿæ ¼å¼
                duration: /(\d+)\s*(åˆ†é’Ÿ|åˆ†|åˆ†é’Ÿ|min|m)|(\d+):(\d+)\s*(å°æ—¶|æ—¶|h)/gi,
                // é…é€Ÿï¼šæ”¯æŒåˆ†:ç§’æ ¼å¼ï¼Œå¯åŒ…å«åˆ†é’Ÿ/é…é€Ÿç­‰å­—æ ·
                pace: /(\d+):(\d+)(?:\s*(åˆ†é’Ÿ|é…é€Ÿ|pace|min\/km))?/gi,
                // å¡è·¯é‡Œï¼šæ”¯æŒå¤šç§è¡¨è¿°
                calories: /(\d+)\s*(å¡è·¯é‡Œ|å¡|çƒ­é‡|cal|kcal|åƒå¡)/gi,
                // æ—¥æœŸï¼šæ”¯æŒå¤šç§æ—¥æœŸæ ¼å¼
                date: /(\d{4})[å¹´\/-](\d{1,2})[æœˆ\/-](\d{1,2})[æ—¥\s]?|(\d{1,2})[æœˆ\/-](\d{1,2})[æ—¥\s]?|(\d{4})-(\d{2})-(\d{2})/g
            };

            const extractedData = {};
            
            // æå–è·ç¦» - å–ç¬¬ä¸€ä¸ªåŒ¹é…çš„æ•°å­—
            const distanceMatches = [...text.matchAll(patterns.distance)];
            if (distanceMatches.length > 0) {
                extractedData.distance = parseFloat(distanceMatches[0][1]);
            }
            
            // æå–æ—¶é•¿ - ä¼˜å…ˆåŒ¹é…åˆ†é’Ÿæ ¼å¼ï¼Œå…¶æ¬¡åŒ¹é…å°æ—¶:åˆ†é’Ÿæ ¼å¼
            const durationMatches = [...text.matchAll(patterns.duration)];
            if (durationMatches.length > 0) {
                const match = durationMatches[0];
                if (match[1]) {
                    // çº¯åˆ†é’Ÿæ ¼å¼
                    extractedData.duration = parseInt(match[1]);
                } else if (match[3] && match[4]) {
                    // å°æ—¶:åˆ†é’Ÿæ ¼å¼ï¼Œè½¬æ¢ä¸ºæ€»åˆ†é’Ÿæ•°
                    const hours = parseInt(match[3]) || 0;
                    const minutes = parseInt(match[4]) || 0;
                    extractedData.duration = hours * 60 + minutes;
                }
            }
            
            // æå–é…é€Ÿ - å–ç¬¬ä¸€ä¸ªåŒ¹é…çš„é…é€Ÿ
            const paceMatches = [...text.matchAll(patterns.pace)];
            if (paceMatches.length > 0) {
                const match = paceMatches[0];
                extractedData.pace = `${match[1]}:${match[2].padStart(2, '0')}`;
            }
            
            // æå–å¡è·¯é‡Œ - å–ç¬¬ä¸€ä¸ªåŒ¹é…çš„æ•°å­—
            const caloriesMatches = [...text.matchAll(patterns.calories)];
            if (caloriesMatches.length > 0) {
                extractedData.calories = parseInt(caloriesMatches[0][1]);
            }
            
            // æå–æ—¥æœŸ - æ”¯æŒå¤šç§æ ¼å¼
            const dateMatches = [...text.matchAll(patterns.date)];
            if (dateMatches.length > 0) {
                const match = dateMatches[0];
                let year, month, day;
                
                if (match[1] && match[2] && match[3]) {
                    // 2024å¹´1æœˆ15æ—¥ æˆ– 2024-1-15 æ ¼å¼
                    year = match[1];
                    month = match[2].padStart(2, '0');
                    day = match[3].padStart(2, '0');
                } else if (match[4] && match[5]) {
                    // 1æœˆ15æ—¥ æ ¼å¼ï¼Œéœ€è¦è¡¥å…¨å¹´ä»½
                    year = new Date().getFullYear();
                    month = match[4].padStart(2, '0');
                    day = match[5].padStart(2, '0');
                } else if (match[6] && match[7] && match[8]) {
                    // 2024-01-15 æ ¼å¼
                    year = match[6];
                    month = match[7];
                    day = match[8];
                }
                
                if (year && month && day) {
                    extractedData.date = `${year}-${month}-${day}`;
                }
            }

            // å¦‚æœæ²¡æœ‰è¯†åˆ«åˆ°æ—¥æœŸï¼Œä½¿ç”¨å½“å‰æ—¥æœŸä½œä¸ºé»˜è®¤å€¼
            if (!extractedData.date) {
                extractedData.date = new Date().toISOString().split('T')[0];
            }

            showOCRResult(extractedData, text);
        }

        // æ˜¾ç¤ºOCRè¯†åˆ«ç»“æœ - å·²ç§»é™¤
        function showOCRResult(data, rawText) {
            alert('OCRè¯†åˆ«åŠŸèƒ½å·²ç§»é™¤ï¼Œè¯·ä½¿ç”¨å·¦ä¾§è¡¨å•æ‰‹åŠ¨æ·»åŠ è·‘æ­¥è®°å½•');
        }

        // å…³é—­OCRç»“æœå¼¹çª— - å·²ç§»é™¤
        function closeOCRModal() {
            // åŠŸèƒ½å·²ç§»é™¤
        }

        // ä»OCRè¡¨å•åº”ç”¨æ•°æ® - å·²ç§»é™¤
        function applyOCRDataFromForm() {
            alert('OCRè¯†åˆ«åŠŸèƒ½å·²ç§»é™¤ï¼Œè¯·ä½¿ç”¨å·¦ä¾§è¡¨å•æ‰‹åŠ¨æ·»åŠ è·‘æ­¥è®°å½•');
        }

        // æ·»åŠ è·‘æ­¥è®°å½•
        function addRecord() {
            const runnerId = document.getElementById('runnerSelect').value;
            const date = document.getElementById('runDate').value;
            const distance = parseFloat(document.getElementById('runDistance').value);
            const duration = parseFloat(document.getElementById('runDuration').value);
            const pace = document.getElementById('runPace').value;
            const calories = parseInt(document.getElementById('runCalories').value) || 0;

            if (!runnerId || !date || !distance || distance <= 0) {
                alert('è¯·å¡«å†™å®Œæ•´çš„è·‘æ­¥è®°å½•ä¿¡æ¯ï¼ˆè‡³å°‘åŒ…å«è·‘å‹ã€æ—¥æœŸã€è·ç¦»ï¼‰ï¼');
                return;
            }

            // æ£€æŸ¥æ˜¯å¦å·²æœ‰åŒä¸€å¤©çš„è®°å½•
            const existingRecord = records.find(r => 
                r.runnerId == runnerId && r.date === date
            );

            const recordData = {
                id: existingRecord ? existingRecord.id : Date.now(),
                runnerId: parseInt(runnerId),
                date: date,
                distance: distance,
                duration: duration || null,
                pace: pace || null,
                calories: calories || null
            };

            if (existingRecord) {
                if (confirm('è¯¥è·‘å‹ä»Šå¤©å·²æœ‰è·‘æ­¥è®°å½•ï¼Œæ˜¯å¦æ›´æ–°è®°å½•ï¼Ÿ')) {
                    const index = records.findIndex(r => r.id === existingRecord.id);
                    records[index] = recordData;
                } else {
                    return;
                }
            } else {
                records.push(recordData);
            }

            localStorage.setItem('runningRecords', JSON.stringify(records));

            // æ¸…ç©ºè¾“å…¥
            document.getElementById('runDistance').value = '';
            document.getElementById('runDuration').value = '';
            document.getElementById('runPace').value = '';
            document.getElementById('runCalories').value = '';

            // æ›´æ–°ç•Œé¢
            updateRunnerList();
            updateRecordsTable();
            updateSummaryStats();

            alert('è·‘æ­¥è®°å½•æ·»åŠ æˆåŠŸï¼');
        }

        // è·å–å‘¨å¼€å§‹æ—¥æœŸ
        function getWeekStart(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1); // è°ƒæ•´ä¸ºå‘¨ä¸€å¼€å§‹
            return new Date(d.setDate(diff));
        }

        // è·å–å‘¨ç»“æŸæ—¥æœŸ
        function getWeekEnd(date) {
            const weekStart = getWeekStart(date);
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6);
            return weekEnd;
        }

        // è·å–è·‘å‹æœ¬å‘¨ç»Ÿè®¡
        function getRunnerWeekStats(runnerId, weekStart) {
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6);

            const weekRecords = records.filter(r => {
                const recordDate = new Date(r.date);
                return r.runnerId == runnerId && 
                       recordDate >= weekStart && 
                       recordDate <= weekEnd;
            });

            const totalDistance = weekRecords.reduce((sum, r) => sum + r.distance, 0);
            const runDays = weekRecords.length;
            const qualifiedRuns = weekRecords.filter(r => r.distance >= 5).length;
            
            // è®¡ç®—å¹³å‡é…é€Ÿ
            const paceRecords = weekRecords.filter(r => r.pace);
            let avgPace = null;
            if (paceRecords.length > 0) {
                const totalPaceMinutes = paceRecords.reduce((sum, r) => {
                    return sum + parsePace(r.pace);
                }, 0);
                const avgPaceMinutes = totalPaceMinutes / paceRecords.length;
                const avgMinutes = Math.floor(avgPaceMinutes);
                const avgSeconds = Math.round((avgPaceMinutes - avgMinutes) * 60);
                avgPace = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            }
            
            // è®¡ç®—æ€»æ¶ˆè€—å¡è·¯é‡Œ
            const totalCalories = weekRecords.reduce((sum, r) => sum + (r.calories || 0), 0);

            return {
                totalDistance: totalDistance,
                runDays: runDays,
                qualifiedRuns: qualifiedRuns,
                records: weekRecords,
                avgPace: avgPace,
                totalCalories: totalCalories > 0 ? totalCalories : null
            };
        }

        // æ›´æ–°è·‘å‹åˆ—è¡¨
        function updateRunnerList() {
            const container = document.getElementById('runnerList');
            container.innerHTML = '';

            // æ›´æ–°æ‰‹åŠ¨æ·»åŠ åŒºåŸŸçš„è·‘å‹é€‰æ‹©
            const runnerSelect = document.getElementById('runnerSelect');
            runnerSelect.innerHTML = '<option value="">è¯·é€‰æ‹©è·‘å‹</option>';
            
            // OCRåŒºåŸŸçš„è·‘å‹é€‰æ‹©å·²ç§»é™¤
            // const runnerSelectOCR = document.getElementById('runnerSelectOCR');
            // runnerSelectOCR.innerHTML = '<option value="">è¯·é€‰æ‹©è·‘å‹</option>';

            if (runners.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">æš‚æ— è·‘å‹ï¼Œè¯·å…ˆæ·»åŠ è·‘å‹</p>';
                return;
            }

            // å¡«å……è·‘å‹é€‰æ‹©ä¸‹æ‹‰æ¡†
            runners.forEach(runner => {
                const option1 = document.createElement('option');
                option1.value = runner.id;
                option1.textContent = runner.name;
                runnerSelect.appendChild(option1);
                
                // OCRåŒºåŸŸçš„è·‘å‹é€‰æ‹©å·²ç§»é™¤
                // const option2 = document.createElement('option');
                // option2.value = runner.id;
                // option2.textContent = runner.name;
                // runnerSelectOCR.appendChild(option2);
            });

            const weekStart = getWeekStart(new Date());

            runners.forEach(runner => {
                const stats = getRunnerWeekStats(runner.id, weekStart);
                const isComplete = stats.qualifiedRuns >= 3 && stats.totalDistance >= runner.targetDistance;
                const isWarning = stats.qualifiedRuns < 3 || stats.totalDistance < runner.targetDistance;

                const card = document.createElement('div');
                card.className = `runner-card ${isComplete ? '' : 'incomplete'} ${isWarning ? 'warning' : ''}`;

                const progressPercent = Math.min((stats.totalDistance / runner.targetDistance) * 100, 100);

                card.innerHTML = `
                    <div class="runner-name">${runner.name}</div>
                    <div class="runner-target">ç›®æ ‡ï¼š${runner.targetDistance}å…¬é‡Œ/å‘¨ | å·²å®Œæˆï¼š${stats.totalDistance.toFixed(1)}å…¬é‡Œ</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progressPercent}%">
                            ${progressPercent.toFixed(0)}%
                        </div>
                    </div>
                    <div style="font-size: 0.9em; margin-bottom: 10px;">
                        æœ¬å‘¨è·‘æ­¥ï¼š${stats.runDays}æ¬¡ | è¾¾æ ‡ï¼š${stats.qualifiedRuns}æ¬¡
                        ${stats.avgPace ? `| å¹³å‡é…é€Ÿï¼š${stats.avgPace}` : ''}
                        ${stats.totalCalories ? `| æ€»æ¶ˆè€—ï¼š${stats.totalCalories}å¡` : ''}
                    </div>
                    <div class="week-stats">
                        ${getWeekDaysHTML(stats.records, weekStart)}
                    </div>
                `;

                container.appendChild(card);
            });
        }

        // è·å–å‘¨æ˜¾ç¤ºHTML
        function getWeekDaysHTML(records, weekStart) {
            const days = ['ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'æ—¥'];
            let html = '';

            for (let i = 0; i < 7; i++) {
                const currentDate = new Date(weekStart);
                currentDate.setDate(weekStart.getDate() + i);
                const dateStr = currentDate.toISOString().split('T')[0];
                
                const dayRecord = records.find(r => r.date === dateStr);
                const hasRecord = !!dayRecord;
                const isQualified = hasRecord && dayRecord.distance >= 5;

                html += `
                    <div class="day-stat ${hasRecord ? (isQualified ? 'completed' : 'incomplete') : ''}">
                        <div>${days[i]}</div>
                        ${hasRecord ? `<div>${dayRecord.distance}km</div>` : '<div>-</div>'}
                        ${hasRecord && dayRecord.pace ? `<div>${dayRecord.pace}</div>` : ''}
                    </div>
                `;
            }

            return html;
        }

        // æ›´æ–°è®°å½•è¡¨æ ¼
        function updateRecordsTable() {
            const tbody = document.getElementById('recordsBody');
            tbody.innerHTML = '';

            if (records.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #666;">æš‚æ— è·‘æ­¥è®°å½•</td></tr>';
                return;
            }

            // æŒ‰æ—¥æœŸå€’åºæ’åˆ—
            const sortedRecords = [...records].sort((a, b) => new Date(b.date) - new Date(a.date));

            sortedRecords.forEach(record => {
                const runner = runners.find(r => r.id == record.runnerId);
                if (!runner) return;

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${runner.name}</td>
                    <td>${record.date}</td>
                    <td>${record.distance}</td>
                    <td>${record.duration || '-'}</td>
                    <td>${record.pace || '-'}</td>
                    <td>${record.calories || '-'}</td>
                    <td>
                        <button class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;" 
                                onclick="deleteRecord(${record.id})">åˆ é™¤</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // åˆ é™¤è®°å½•
        function deleteRecord(recordId) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
                records = records.filter(r => r.id !== recordId);
                localStorage.setItem('runningRecords', JSON.stringify(records));
                
                updateRunnerList();
                updateRecordsTable();
                updateSummaryStats();
            }
        }

        // æ›´æ–°ç»Ÿè®¡æ¦‚è§ˆ
        function updateSummaryStats() {
            const container = document.getElementById('summaryStats');
            const penaltyContainer = document.getElementById('penaltyInfo');
            
            const weekStart = getWeekStart(new Date());
            let totalRunners = runners.length;
            let completedRunners = 0;
            let totalPenalties = 0;
            let completedDistance = 0;
            let totalDuration = 0;
            let totalCalories = 0;
            let avgPaceRecords = [];

            runners.forEach(runner => {
                const stats = getRunnerWeekStats(runner.id, weekStart);
                const isComplete = stats.qualifiedRuns >= 3 && stats.totalDistance >= runner.targetDistance;
                
                if (isComplete) {
                    completedRunners++;
                } else {
                    totalPenalties += 500;
                }
                
                completedDistance += stats.totalDistance;
                totalDuration += stats.records.reduce((sum, r) => sum + (r.duration || 0), 0);
                totalCalories += stats.totalCalories || 0;
                
                // æ”¶é›†æ‰€æœ‰é…é€Ÿæ•°æ®
                stats.records.forEach(r => {
                    if (r.pace) {
                        avgPaceRecords.push(parsePace(r.pace));
                    }
                });
            });

            const rewardPerPerson = completedRunners > 0 ? totalPenalties / completedRunners : 0;
            
            // è®¡ç®—å¹³å‡é…é€Ÿ
            let avgPace = null;
            if (avgPaceRecords.length > 0) {
                const avgPaceMinutes = avgPaceRecords.reduce((sum, pace) => sum + pace, 0) / avgPaceRecords.length;
                const avgMinutes = Math.floor(avgPaceMinutes);
                const avgSeconds = Math.round((avgPaceMinutes - avgMinutes) * 60);
                avgPace = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            }

            container.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${totalRunners}</div>
                    <div class="stat-label">æ€»è·‘å‹æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${completedRunners}</div>
                    <div class="stat-label">æœ¬å‘¨è¾¾æ ‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${completedDistance.toFixed(1)}</div>
                    <div class="stat-label">æœ¬å‘¨æ€»é‡Œç¨‹(km)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${Math.round(totalDuration)}</div>
                    <div class="stat-label">æœ¬å‘¨æ€»æ—¶é•¿(åˆ†)</div>
                </div>
                ${avgPace ? `
                <div class="stat-card">
                    <div class="stat-number">${avgPace}</div>
                    <div class="stat-label">å¹³å‡é…é€Ÿ</div>
                </div>
                ` : ''}
                ${totalCalories > 0 ? `
                <div class="stat-card">
                    <div class="stat-number">${Math.round(totalCalories)}</div>
                    <div class="stat-label">æ€»æ¶ˆè€—(å¡)</div>
                </div>
                ` : ''}
                <div class="stat-card">
                    <div class="stat-number">${totalPenalties}</div>
                    <div class="stat-label">æœ¬å‘¨ç½šæ¬¾æ€»é¢(å…ƒ)</div>
                </div>
            `;

            if (totalPenalties > 0 && completedRunners > 0) {
                penaltyContainer.innerHTML = `
                    <h3>ğŸ† æœ¬å‘¨å¥–åŠ±åˆ†é…</h3>
                    <p>è¾¾æ ‡è·‘å‹æ¯äººå¯è·å¾—å¥–åŠ±ï¼š${rewardPerPerson.toFixed(2)}å…ƒ</p>
                    <p>æœªè¾¾æ ‡è·‘å‹éœ€è¦ç¼´çº³ç½šæ¬¾ï¼š500å…ƒ</p>
                `;
            } else if (totalPenalties > 0) {
                penaltyContainer.innerHTML = `
                    <h3>âš ï¸ æœ¬å‘¨æ— è¾¾æ ‡è·‘å‹</h3>
                    <p>ç½šæ¬¾æ€»é¢ï¼š${totalPenalties}å…ƒå°†ç´¯ç§¯åˆ°ä¸‹å‘¨</p>
                `;
            } else {
                penaltyContainer.innerHTML = `
                    <h3>ğŸ‰ æœ¬å‘¨å…¨å‘˜è¾¾æ ‡ï¼</h3>
                    <p>æ‰€æœ‰è·‘å‹éƒ½å®Œæˆäº†æœ¬å‘¨ç›®æ ‡ï¼Œå¤ªæ£’äº†ï¼</p>
                `;
            }
        }

        // å¯¼å‡ºæ•°æ®
        function exportData() {
            const data = {
                runners: runners,
                records: records,
                exportDate: new Date().toISOString(),
                version: '1.0',
                appName: 'è·‘æ­¥è®°å½•ç®¡ç†ç³»ç»Ÿ'
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `è·‘æ­¥æ•°æ®_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            alert('æ•°æ®å¯¼å‡ºæˆåŠŸï¼æ–‡ä»¶å·²ä¿å­˜åˆ°ä¸‹è½½æ–‡ä»¶å¤¹ã€‚');
        }

        // å¯¼å…¥æ•°æ®
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        // éªŒè¯æ•°æ®æ ¼å¼
                        if (!data.runners || !data.records) {
                            alert('æ•°æ®æ ¼å¼é”™è¯¯ï¼è¯·ç¡®ä¿å¯¼å…¥çš„æ˜¯æœ‰æ•ˆçš„è·‘æ­¥æ•°æ®æ–‡ä»¶ã€‚');
                            return;
                        }
                        
                        // ç¡®è®¤å¯¼å…¥
                        const confirmMsg = `ç¡®å®šè¦å¯¼å…¥æ•°æ®å—ï¼Ÿ\n\n` +
                                         `è·‘å‹æ•°é‡ï¼š${data.runners.length} äºº\n` +
                                         `è®°å½•æ•°é‡ï¼š${data.records.length} æ¡\n` +
                                         `å¯¼å‡ºæ—¶é—´ï¼š${data.exportDate ? new Date(data.exportDate).toLocaleString() : 'æœªçŸ¥'}\n\n` +
                                         `âš ï¸ å¯¼å…¥å°†è¦†ç›–ç°æœ‰æ•°æ®ï¼Œè¯·è°¨æ…æ“ä½œï¼`;
                        
                        if (confirm(confirmMsg)) {
                            // å¤‡ä»½å½“å‰æ•°æ®
                            const backup = {
                                runners: runners,
                                records: records,
                                backupDate: new Date().toISOString()
                            };
                            localStorage.setItem('runningDataBackup', JSON.stringify(backup));
                            
                            // å¯¼å…¥æ–°æ•°æ®
                            runners = data.runners;
                            records = data.records;
                            
                            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                            localStorage.setItem('runners', JSON.stringify(runners));
                            localStorage.setItem('runningRecords', JSON.stringify(records));
                            
                            // æ›´æ–°ç•Œé¢
                            updateRunnerSelect();
                            updateRunnerList();
                            updateRecordsTable();
                            updateSummaryStats();
                            updateWeekHistory();
                            
                            alert('æ•°æ®å¯¼å…¥æˆåŠŸï¼å·²è‡ªåŠ¨å¤‡ä»½åŸæœ‰æ•°æ®ã€‚');
                        }
                    } catch (error) {
                        alert('æ–‡ä»¶è§£æå¤±è´¥ï¼è¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®ã€‚\né”™è¯¯ä¿¡æ¯ï¼š' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // æ¢å¤å¤‡ä»½æ•°æ®
        function restoreBackup() {
            const backup = localStorage.getItem('runningDataBackup');
            if (!backup) {
                alert('æ²¡æœ‰æ‰¾åˆ°å¤‡ä»½æ•°æ®ï¼');
                return;
            }
            
            try {
                const data = JSON.parse(backup);
                if (confirm('ç¡®å®šè¦æ¢å¤å¤‡ä»½æ•°æ®å—ï¼Ÿå½“å‰æ•°æ®å°†è¢«è¦†ç›–ã€‚')) {
                    runners = data.runners;
                    records = data.records;
                    
                    localStorage.setItem('runners', JSON.stringify(runners));
                    localStorage.setItem('runningRecords', JSON.stringify(records));
                    
                    updateRunnerSelect();
                    updateRunnerList();
                    updateRecordsTable();
                    updateSummaryStats();
                    updateWeekHistory();
                    
                    alert('å¤‡ä»½æ•°æ®æ¢å¤æˆåŠŸï¼');
                }
            } catch (error) {
                alert('å¤‡ä»½æ•°æ®æ¢å¤å¤±è´¥ï¼š' + error.message);
            }
        }

        // GitHub Gist äº‘ç«¯åŒæ­¥åŠŸèƒ½
        class CloudSync {
            constructor() {
                this.gistId = localStorage.getItem('runningGistId');
                this.githubToken = localStorage.getItem('githubToken');
            }
            
            // è®¾ç½®GitHub Token
            setGithubToken(token) {
                this.githubToken = token;
                localStorage.setItem('githubToken', token);
            }
            
            // è®¾ç½®Gist ID
            setGistId(id) {
                this.gistId = id;
                localStorage.setItem('runningGistId', id);
            }
            
            // åˆ›å»ºæ–°çš„Gist
            async createGist() {
                if (!this.githubToken) {
                    throw new Error('è¯·å…ˆè®¾ç½®GitHub Token');
                }
                
                const data = {
                    description: 'è·‘æ­¥è®°å½•æ•°æ®åŒæ­¥',
                    public: false,
                    files: {
                        'running_data.json': {
                            content: JSON.stringify(this.getCurrentData(), null, 2)
                        }
                    }
                };
                
                const response = await fetch('https://api.github.com/gists', {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${this.githubToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) {
                    throw new Error(`åˆ›å»ºGistå¤±è´¥: ${response.status}`);
                }
                
                const result = await response.json();
                this.setGistId(result.id);
                return result.id;
            }
            
            // æ›´æ–°ç°æœ‰çš„Gist
            async updateGist() {
                if (!this.githubToken || !this.gistId) {
                    throw new Error('è¯·å…ˆè®¾ç½®GitHub Tokenå’ŒGist ID');
                }
                
                const data = {
                    description: 'è·‘æ­¥è®°å½•æ•°æ®åŒæ­¥',
                    files: {
                        'running_data.json': {
                            content: JSON.stringify(this.getCurrentData(), null, 2)
                        }
                    }
                };
                
                const response = await fetch(`https://api.github.com/gists/${this.gistId}`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `token ${this.githubToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) {
                    throw new Error(`æ›´æ–°Gistå¤±è´¥: ${response.status}`);
                }
                
                return await response.json();
            }
            
            // ä»Gistè·å–æ•°æ®
            async fetchFromGist() {
                if (!this.gistId) {
                    throw new Error('è¯·å…ˆè®¾ç½®Gist ID');
                }
                
                const response = await fetch(`https://api.github.com/gists/${this.gistId}`);
                if (!response.ok) {
                    throw new Error(`è·å–Gistå¤±è´¥: ${response.status}`);
                }
                
                const result = await response.json();
                const fileContent = result.files['running_data.json']?.content;
                
                if (!fileContent) {
                    throw new Error('Gistä¸­æ²¡æœ‰æ‰¾åˆ°æ•°æ®æ–‡ä»¶');
                }
                
                return JSON.parse(fileContent);
            }
            
            // è·å–å½“å‰æœ¬åœ°æ•°æ®
            getCurrentData() {
                return {
                    runners: runners,
                    records: records,
                    lastSync: new Date().toISOString(),
                    version: '1.0'
                };
            }
            
            // åŒæ­¥åˆ°äº‘ç«¯
            async syncToCloud() {
                try {
                    if (!this.githubToken) {
                        throw new Error('è¯·å…ˆè®¾ç½®GitHub Token');
                    }
                    
                    // è·å–å½“å‰æ•°æ®å¹¶æ·»åŠ ç‰ˆæœ¬ä¿¡æ¯
                    const currentData = this.getCurrentData();
                    currentData.version = versionManager.saveVersion();
                    
                    if (!this.gistId) {
                        await this.createGist(currentData);
                    } else {
                        await this.updateGist(this.gistId, currentData);
                    }
                    
                    localStorage.setItem('lastSyncTime', new Date().toISOString());
                    return true;
                } catch (error) {
                    console.error('åŒæ­¥åˆ°äº‘ç«¯å¤±è´¥:', error);
                    throw error;
                }
            }
            
            // ä»äº‘ç«¯åŒæ­¥ï¼ˆå¸¦å†²çªæ£€æµ‹ï¼‰
            async syncFromCloud() {
                try {
                    const cloudData = await this.fetchFromGist();
                    
                    // æ•°æ®éªŒè¯
                    if (!cloudData.runners || !cloudData.records) {
                        throw new Error('äº‘ç«¯æ•°æ®æ ¼å¼é”™è¯¯');
                    }
                    
                    const localData = this.getCurrentData();
                    
                    // æ£€æµ‹æ•°æ®å†²çª
                    const conflictResult = versionManager.detectConflict(localData, cloudData);
                    
                    if (conflictResult.hasConflict) {
                        console.log('æ£€æµ‹åˆ°æ•°æ®å†²çª:', conflictResult);
                        
                        // è¿”å›å†²çªä¿¡æ¯ï¼Œè®©è°ƒç”¨è€…å¤„ç†
                        return {
                            hasConflict: true,
                            conflictInfo: conflictResult,
                            cloudData: cloudData,
                            localData: localData
                        };
                    }
                    
                    // æ— å†²çªï¼Œç›´æ¥è¿”å›äº‘ç«¯æ•°æ®
                    return {
                        hasConflict: false,
                        cloudData: cloudData
                    };
                } catch (error) {
                    console.error('ä»äº‘ç«¯åŒæ­¥å¤±è´¥:', error);
                    throw error;
                }
            }
        }
        
        // åˆ›å»ºäº‘ç«¯åŒæ­¥å®ä¾‹
        const cloudSync = new CloudSync();

        // è‡ªåŠ¨åŒæ­¥ç®¡ç†å™¨
        class AutoSyncManager {
            constructor(cloudSync) {
                this.cloudSync = cloudSync;
                this.syncInterval = null;
                this.lastSyncTime = localStorage.getItem('lastSyncTime');
                this.syncEnabled = localStorage.getItem('autoSyncEnabled') === 'true';
                this.syncFrequency = parseInt(localStorage.getItem('syncFrequency') || '5'); // é»˜è®¤5åˆ†é’Ÿ
            }

            // å¯åŠ¨è‡ªåŠ¨åŒæ­¥
            startAutoSync() {
                if (!this.syncEnabled) {
                    console.log('è‡ªåŠ¨åŒæ­¥å·²ç¦ç”¨');
                    return;
                }

                if (!this.cloudSync.githubToken || !this.cloudSync.gistId) {
                    console.log('äº‘ç«¯åŒæ­¥æœªé…ç½®ï¼Œæ— æ³•å¯åŠ¨è‡ªåŠ¨åŒæ­¥');
                    return;
                }

                console.log(`å¯åŠ¨è‡ªåŠ¨åŒæ­¥ï¼Œæ¯${this.syncFrequency}åˆ†é’ŸåŒæ­¥ä¸€æ¬¡`);
                
                // ç«‹å³æ‰§è¡Œä¸€æ¬¡åŒæ­¥
                this.performAutoSync();

                // è®¾ç½®å®šæ—¶åŒæ­¥
                this.syncInterval = setInterval(() => {
                    this.performAutoSync();
                }, this.syncFrequency * 60 * 1000);
            }

            // åœæ­¢è‡ªåŠ¨åŒæ­¥
            stopAutoSync() {
                if (this.syncInterval) {
                    clearInterval(this.syncInterval);
                    this.syncInterval = null;
                    console.log('è‡ªåŠ¨åŒæ­¥å·²åœæ­¢');
                }
            }

            // æ‰§è¡Œè‡ªåŠ¨åŒæ­¥ï¼ˆå¸¦å†²çªæ£€æµ‹ï¼‰
            async performAutoSync() {
                try {
                    console.log('å¼€å§‹è‡ªåŠ¨åŒæ­¥...');
                    
                    // è·å–äº‘ç«¯æ•°æ®å¹¶æ£€æµ‹å†²çª
                    const syncResult = await this.cloudSync.syncFromCloud();
                    
                    if (syncResult.hasConflict) {
                        console.log('è‡ªåŠ¨åŒæ­¥æ£€æµ‹åˆ°æ•°æ®å†²çª');
                        
                        // è‡ªåŠ¨ä½¿ç”¨æ™ºèƒ½åˆå¹¶ç­–ç•¥è§£å†³å†²çª
                        const resolvedData = versionManager.resolveConflict(syncResult.localData, syncResult.cloudData, 'merge');
                        
                        // å¤‡ä»½æœ¬åœ°æ•°æ®
                        const backup = {
                            runners: runners,
                            records: records,
                            backupDate: new Date().toISOString()
                        };
                        localStorage.setItem('runningDataBackup', JSON.stringify(backup));
                        
                        // æ›´æ–°æœ¬åœ°æ•°æ®
                        runners = resolvedData.runners;
                        records = resolvedData.records;
                        
                        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                        localStorage.setItem('runners', JSON.stringify(runners));
                        localStorage.setItem('runningRecords', JSON.stringify(records));
                        
                        // æ›´æ–°ç•Œé¢
                        updateRunnerSelect();
                        updateRunnerList();
                        updateRecordsTable();
                        updateSummaryStats();
                        updateWeekHistory();
                        
                        console.log('è‡ªåŠ¨åŒæ­¥å®Œæˆï¼šæ•°æ®å†²çªå·²æ™ºèƒ½åˆå¹¶');
                        
                        // æ˜¾ç¤ºåŒæ­¥æˆåŠŸæç¤º
                        this.showSyncNotification('æ•°æ®å·²è‡ªåŠ¨åŒæ­¥æ›´æ–°ï¼ˆæ™ºèƒ½åˆå¹¶ï¼‰', 'success');
                    } else if (syncResult.cloudData) {
                        // æ— å†²çªï¼Œæ£€æŸ¥æ˜¯å¦éœ€è¦åŒæ­¥
                        const cloudData = syncResult.cloudData;
                        const localData = this.cloudSync.getCurrentData();
                        const localTimestamp = new Date(localData.lastSync || 0).getTime();
                        const cloudTimestamp = new Date(cloudData.lastSync || 0).getTime();

                        // å¦‚æœäº‘ç«¯æ•°æ®æ›´æ–°ï¼Œåˆ™åŒæ­¥åˆ°æœ¬åœ°
                        if (cloudTimestamp > localTimestamp) {
                            console.log('æ£€æµ‹åˆ°äº‘ç«¯æ•°æ®æ›´æ–°ï¼Œæ­£åœ¨åŒæ­¥åˆ°æœ¬åœ°...');
                            
                            // å¤‡ä»½æœ¬åœ°æ•°æ®
                            const backup = {
                                runners: runners,
                                records: records,
                                backupDate: new Date().toISOString()
                            };
                            localStorage.setItem('runningDataBackup', JSON.stringify(backup));
                            
                            // æ›´æ–°æœ¬åœ°æ•°æ®
                            runners = cloudData.runners;
                            records = cloudData.records;
                            
                            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                            localStorage.setItem('runners', JSON.stringify(runners));
                            localStorage.setItem('runningRecords', JSON.stringify(records));
                            
                            // æ›´æ–°ç•Œé¢
                            updateRunnerSelect();
                            updateRunnerList();
                            updateRecordsTable();
                            updateSummaryStats();
                            updateWeekHistory();
                            
                            console.log('è‡ªåŠ¨åŒæ­¥å®Œæˆï¼šäº‘ç«¯æ•°æ®å·²åŒæ­¥åˆ°æœ¬åœ°');
                            
                            // æ˜¾ç¤ºåŒæ­¥æˆåŠŸæç¤º
                            this.showSyncNotification('æ•°æ®å·²è‡ªåŠ¨åŒæ­¥æ›´æ–°', 'success');
                        } else {
                            console.log('æœ¬åœ°æ•°æ®ä¸ºæœ€æ–°ï¼Œæ— éœ€åŒæ­¥');
                        }
                    } else {
                        console.log('äº‘ç«¯æ²¡æœ‰æ•°æ®ï¼Œè·³è¿‡åŒæ­¥');
                    }
                    
                    // æ›´æ–°æœ€ååŒæ­¥æ—¶é—´
                    localStorage.setItem('lastSyncTime', new Date().toISOString());
                    
                } catch (error) {
                    console.error('è‡ªåŠ¨åŒæ­¥å¤±è´¥:', error);
                    this.showSyncNotification('è‡ªåŠ¨åŒæ­¥å¤±è´¥', 'error');
                }
            }

            // æ˜¾ç¤ºåŒæ­¥é€šçŸ¥
            showSyncNotification(message, type = 'info') {
                // åˆ›å»ºé€šçŸ¥å…ƒç´ 
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 15px 20px;
                    border-radius: 8px;
                    color: white;
                    font-size: 14px;
                    z-index: 10000;
                    opacity: 0;
                    transition: opacity 0.3s ease;
                    background: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#17a2b8'};
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                `;
                notification.textContent = message;

                document.body.appendChild(notification);

                // æ˜¾ç¤ºåŠ¨ç”»
                setTimeout(() => {
                    notification.style.opacity = '1';
                }, 100);

                // è‡ªåŠ¨éšè—
                setTimeout(() => {
                    notification.style.opacity = '0';
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 3000);
            }

            // å¯ç”¨è‡ªåŠ¨åŒæ­¥
            enableAutoSync() {
                this.syncEnabled = true;
                localStorage.setItem('autoSyncEnabled', 'true');
                this.startAutoSync();
                this.showSyncNotification('è‡ªåŠ¨åŒæ­¥å·²å¯ç”¨', 'success');
            }

            // ç¦ç”¨è‡ªåŠ¨åŒæ­¥
            disableAutoSync() {
                this.syncEnabled = false;
                localStorage.setItem('autoSyncEnabled', 'false');
                this.stopAutoSync();
                this.showSyncNotification('è‡ªåŠ¨åŒæ­¥å·²ç¦ç”¨', 'info');
            }

            // è®¾ç½®åŒæ­¥é¢‘ç‡
            setSyncFrequency(minutes) {
                this.syncFrequency = minutes;
                localStorage.setItem('syncFrequency', minutes.toString());
                
                // å¦‚æœè‡ªåŠ¨åŒæ­¥æ­£åœ¨è¿è¡Œï¼Œé‡å¯ä»¥åº”ç”¨æ–°é¢‘ç‡
                if (this.syncEnabled) {
                    this.stopAutoSync();
                    this.startAutoSync();
                }
            }

            // è·å–åŒæ­¥çŠ¶æ€
            getSyncStatus() {
                return {
                    enabled: this.syncEnabled,
                    frequency: this.syncFrequency,
                    lastSync: this.lastSyncTime,
                    isRunning: this.syncInterval !== null,
                    hasValidConfig: !!(this.cloudSync.githubToken && this.cloudSync.gistId)
                };
            }
        }

        // åˆ›å»ºè‡ªåŠ¨åŒæ­¥ç®¡ç†å™¨å®ä¾‹
        const autoSyncManager = new AutoSyncManager(cloudSync);

        // æ•°æ®ç‰ˆæœ¬æ§åˆ¶å’Œå†²çªè§£å†³ç®¡ç†å™¨
        class DataVersionManager {
            constructor() {
                this.versionKey = 'dataVersion';
                this.conflictResolutionKey = 'conflictResolution';
                this.defaultResolution = 'merge'; // merge, local, cloud
            }

            // ç”Ÿæˆæ•°æ®ç‰ˆæœ¬å·
            generateVersion() {
                return {
                    version: Date.now(),
                    timestamp: new Date().toISOString(),
                    runnersCount: runners.length,
                    recordsCount: records.length
                };
            }

            // è·å–å½“å‰ç‰ˆæœ¬ä¿¡æ¯
            getCurrentVersion() {
                const version = localStorage.getItem(this.versionKey);
                return version ? JSON.parse(version) : this.generateVersion();
            }

            // ä¿å­˜ç‰ˆæœ¬ä¿¡æ¯
            saveVersion() {
                const version = this.generateVersion();
                localStorage.setItem(this.versionKey, JSON.stringify(version));
                return version;
            }

            // æ£€æµ‹æ•°æ®å†²çª
            detectConflict(localData, cloudData) {
                if (!localData.version || !cloudData.version) {
                    return { hasConflict: false, reason: 'missing_version' };
                }

                const localVersion = localData.version;
                const cloudVersion = cloudData.version;

                // æ£€æŸ¥ç‰ˆæœ¬å·å’Œæ—¶é—´æˆ³
                if (localVersion.version === cloudVersion.version) {
                    return { hasConflict: false, reason: 'same_version' };
                }

                // æ£€æŸ¥æ•°æ®å·®å¼‚
                const localTimestamp = new Date(localVersion.timestamp).getTime();
                const cloudTimestamp = new Date(cloudVersion.timestamp).getTime();

                // å¦‚æœæ—¶é—´æˆ³ç›¸å·®å°äº1åˆ†é’Ÿï¼Œè®¤ä¸ºæ²¡æœ‰å†²çª
                if (Math.abs(localTimestamp - cloudTimestamp) < 60000) {
                    return { hasConflict: false, reason: 'recent_sync' };
                }

                // æ£€æŸ¥æ•°æ®å†…å®¹å·®å¼‚
                const localRunnersChanged = localData.runners.length !== localVersion.runnersCount;
                const localRecordsChanged = localData.records.length !== localVersion.recordsCount;
                const cloudRunnersChanged = cloudData.runners.length !== cloudVersion.runnersCount;
                const cloudRecordsChanged = cloudData.records.length !== cloudVersion.recordsCount;

                const hasConflict = (localRunnersChanged || localRecordsChanged) && (cloudRunnersChanged || cloudRecordsChanged);

                return {
                    hasConflict,
                    reason: hasConflict ? 'both_modified' : 'single_modified',
                    details: {
                        localModified: localRunnersChanged || localRecordsChanged,
                        cloudModified: cloudRunnersChanged || cloudRecordsChanged,
                        localChanges: {
                            runners: localData.runners.length - localVersion.runnersCount,
                            records: localData.records.length - localVersion.recordsCount
                        },
                        cloudChanges: {
                            runners: cloudData.runners.length - cloudVersion.runnersCount,
                            records: cloudData.records.length - cloudVersion.recordsCount
                        }
                    }
                };
            }

            // åˆå¹¶æ•°æ®ï¼ˆæ™ºèƒ½åˆå¹¶ç­–ç•¥ï¼‰
            mergeData(localData, cloudData) {
                console.log('å¼€å§‹æ™ºèƒ½æ•°æ®åˆå¹¶...');
                
                // åˆ›å»ºåˆå¹¶ç»“æœ
                const mergedData = {
                    runners: [],
                    records: [],
                    version: this.generateVersion(),
                    mergeLog: []
                };

                // åˆå¹¶è·‘å‹æ•°æ®
                const runnerMap = new Map();
                
                // æ·»åŠ æœ¬åœ°è·‘å‹
                localData.runners.forEach(runner => {
                    runnerMap.set(runner.id, { ...runner, source: 'local' });
                });

                // åˆå¹¶äº‘ç«¯è·‘å‹ï¼ˆå¤„ç†å†²çªï¼‰
                cloudData.runners.forEach(cloudRunner => {
                    const existingRunner = runnerMap.get(cloudRunner.id);
                    
                    if (existingRunner) {
                        // è·‘å‹å·²å­˜åœ¨ï¼Œæ¯”è¾ƒä¿®æ”¹æ—¶é—´
                        const localTime = new Date(existingRunner.updatedAt || existingRunner.createdAt).getTime();
                        const cloudTime = new Date(cloudRunner.updatedAt || cloudRunner.createdAt).getTime();
                        
                        if (cloudTime > localTime) {
                            // äº‘ç«¯æ•°æ®æ›´æ–°ï¼Œä½¿ç”¨äº‘ç«¯æ•°æ®
                            runnerMap.set(cloudRunner.id, { ...cloudRunner, source: 'cloud' });
                            mergedData.mergeLog.push(`è·‘å‹ "${cloudRunner.name}" ä½¿ç”¨äº‘ç«¯æ•°æ®ï¼ˆäº‘ç«¯æ›´æ–°ï¼‰`);
                        } else {
                            // æœ¬åœ°æ•°æ®æ›´æ–°ï¼Œä¿ç•™æœ¬åœ°æ•°æ®
                            mergedData.mergeLog.push(`è·‘å‹ "${existingRunner.name}" ä¿ç•™æœ¬åœ°æ•°æ®ï¼ˆæœ¬åœ°æ›´æ–°ï¼‰`);
                        }
                    } else {
                        // æ–°è·‘å‹ï¼Œæ·»åŠ åˆ°åˆå¹¶ç»“æœ
                        runnerMap.set(cloudRunner.id, { ...cloudRunner, source: 'cloud' });
                        mergedData.mergeLog.push(`æ·»åŠ æ–°è·‘å‹ "${cloudRunner.name}"`);
                    }
                });

                mergedData.runners = Array.from(runnerMap.values());

                // åˆå¹¶è·‘æ­¥è®°å½•
                const recordMap = new Map();
                
                // æ·»åŠ æœ¬åœ°è®°å½•
                localData.records.forEach(record => {
                    const key = `${record.runnerId}_${record.date}_${record.distance}`;
                    recordMap.set(key, { ...record, source: 'local' });
                });

                // åˆå¹¶äº‘ç«¯è®°å½•
                cloudData.records.forEach(cloudRecord => {
                    const key = `${cloudRecord.runnerId}_${cloudRecord.date}_${cloudRecord.distance}`;
                    const existingRecord = recordMap.get(key);
                    
                    if (!existingRecord) {
                        // æ–°è®°å½•ï¼Œæ·»åŠ åˆ°åˆå¹¶ç»“æœ
                        recordMap.set(key, { ...cloudRecord, source: 'cloud' });
                        mergedData.mergeLog.push(`æ·»åŠ æ–°è·‘æ­¥è®°å½•ï¼š${cloudRecord.distance}km`);
                    }
                });

                mergedData.records = Array.from(recordMap.values());

                console.log('æ•°æ®åˆå¹¶å®Œæˆï¼š', mergedData.mergeLog);
                return mergedData;
            }

            // è§£å†³å†²çª
            resolveConflict(localData, cloudData, resolution = null) {
                resolution = resolution || localStorage.getItem(this.conflictResolutionKey) || this.defaultResolution;

                console.log(`ä½¿ç”¨å†²çªè§£å†³ç­–ç•¥: ${resolution}`);

                switch (resolution) {
                    case 'merge':
                        return this.mergeData(localData, cloudData);
                    
                    case 'local':
                        return {
                            ...localData,
                            version: this.generateVersion(),
                            mergeLog: ['ä½¿ç”¨æœ¬åœ°æ•°æ®ï¼ˆå†²çªè§£å†³ç­–ç•¥ï¼‰']
                        };
                    
                    case 'cloud':
                        return {
                            ...cloudData,
                            version: this.generateVersion(),
                            mergeLog: ['ä½¿ç”¨äº‘ç«¯æ•°æ®ï¼ˆå†²çªè§£å†³ç­–ç•¥ï¼‰']
                        };
                    
                    default:
                        return this.mergeData(localData, cloudData);
                }
            }

            // æ˜¾ç¤ºå†²çªè§£å†³å¯¹è¯æ¡†
            showConflictResolutionDialog(conflictInfo, onResolve) {
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.5);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 2000;
                `;

                const modalContent = document.createElement('div');
                modalContent.style.cssText = `
                    background: white;
                    padding: 30px;
                    border-radius: 15px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    text-align: center;
                    min-width: 400px;
                    max-width: 500px;
                `;

                const { details } = conflictInfo;
                
                modalContent.innerHTML = `
                    <h3 style="margin-bottom: 20px; color: #dc3545;">âš ï¸ æ£€æµ‹åˆ°æ•°æ®å†²çª</h3>
                    <div style="text-align: left; margin-bottom: 20px;">
                        <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
                            æœ¬åœ°å’Œäº‘ç«¯æ•°æ®éƒ½æœ‰æ›´æ–°ï¼Œéœ€è¦é€‰æ‹©å†²çªè§£å†³æ–¹å¼ï¼š
                        </p>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h5 style="margin-bottom: 10px;">æ•°æ®å˜åŒ–å¯¹æ¯”ï¼š</h5>
                            <div style="display: flex; justify-content: space-between;">
                                <div style="text-align: center;">
                                    <strong>æœ¬åœ°æ•°æ®</strong><br>
                                    <small>è·‘å‹: ${details.localChanges.runners > 0 ? '+' : ''}${details.localChanges.runners}<br>
                                    è®°å½•: ${details.localChanges.records > 0 ? '+' : ''}${details.localChanges.records}</small>
                                </div>
                                <div style="text-align: center;">
                                    <strong>äº‘ç«¯æ•°æ®</strong><br>
                                    <small>è·‘å‹: ${details.cloudChanges.runners > 0 ? '+' : ''}${details.cloudChanges.runners}<br>
                                    è®°å½•: ${details.cloudChanges.records > 0 ? '+' : ''}${details.cloudChanges.records}</small>
                                </div>
                            </div>
                        </div>
                        <div style="font-size: 12px; color: #999;">
                            <strong>æ™ºèƒ½åˆå¹¶</strong>ï¼šè‡ªåŠ¨åˆå¹¶æ•°æ®ï¼Œä¿ç•™æœ€æ–°çš„ä¿®æ”¹<br>
                            <strong>ä½¿ç”¨æœ¬åœ°æ•°æ®</strong>ï¼šå®Œå…¨è¦†ç›–äº‘ç«¯æ•°æ®<br>
                            <strong>ä½¿ç”¨äº‘ç«¯æ•°æ®</strong>ï¼šå®Œå…¨è¦†ç›–æœ¬åœ°æ•°æ®
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="resolveConflict('merge')">ğŸ”„ æ™ºèƒ½åˆå¹¶</button>
                        <button class="btn btn-warning" onclick="resolveConflict('local')">ğŸ’¾ ä½¿ç”¨æœ¬åœ°æ•°æ®</button>
                        <button class="btn btn-info" onclick="resolveConflict('cloud')">â˜ï¸ ä½¿ç”¨äº‘ç«¯æ•°æ®</button>
                        <button class="btn btn-secondary" onclick="cancelConflictResolution()">å–æ¶ˆ</button>
                    </div>
                `;

                modal.appendChild(modalContent);
                document.body.appendChild(modal);

                // å†²çªè§£å†³å‡½æ•°
                window.resolveConflict = function(resolution) {
                    localStorage.setItem('conflictResolution', resolution);
                    document.body.removeChild(modal);
                    delete window.resolveConflict;
                    delete window.cancelConflictResolution;
                    onResolve(resolution);
                };

                // å–æ¶ˆå†²çªè§£å†³å‡½æ•°
                window.cancelConflictResolution = function() {
                    document.body.removeChild(modal);
                    delete window.resolveConflict;
                    delete window.cancelConflictResolution;
                };
            }
        }

        // åˆ›å»ºæ•°æ®ç‰ˆæœ¬ç®¡ç†å™¨å®ä¾‹
        const versionManager = new DataVersionManager();

        // æ˜¾ç¤ºäº‘ç«¯åŒæ­¥é…ç½®æ¨¡æ€æ¡†
        function showCloudSyncModal() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;

            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white;
                padding: 30px;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                text-align: center;
                min-width: 400px;
                max-width: 500px;
            `;

            const currentToken = localStorage.getItem('githubToken') || '';
            const currentGistId = localStorage.getItem('runningGistId') || '';
            const lastSync = localStorage.getItem('lastSyncTime');
            const lastSyncText = lastSync ? new Date(lastSync).toLocaleString() : 'ä»æœªåŒæ­¥';

            const syncStatus = autoSyncManager.getSyncStatus();
            const autoSyncEnabled = syncStatus.enabled;
            const syncFrequency = syncStatus.frequency;

            modalContent.innerHTML = `
                <h3 style="margin-bottom: 20px; color: #333;">â˜ï¸ äº‘ç«¯åŒæ­¥é…ç½®</h3>
                <div style="text-align: left; margin-bottom: 20px;">
                    <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
                        ä½¿ç”¨GitHub Gistè¿›è¡Œæ•°æ®åŒæ­¥ï¼Œéœ€è¦åœ¨GitHubè®¾ç½®ä¸­åˆ›å»ºPersonal Access Tokenã€‚
                    </p>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">GitHub Token:</label>
                        <input type="password" id="githubToken" placeholder="è¾“å…¥GitHub Personal Access Token" 
                               value="${currentToken}" 
                               style="width: 100%; padding: 12px; border: 2px solid #ddd; 
                                      border-radius: 8px; font-size: 14px;">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Gist ID (å¯é€‰):</label>
                        <input type="text" id="gistId" placeholder="ç•™ç©ºå°†åˆ›å»ºæ–°çš„Gist" 
                               value="${currentGistId}" 
                               style="width: 100%; padding: 12px; border: 2px solid #ddd; 
                                      border-radius: 8px; font-size: 14px;">
                    </div>
                    <div style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #dee2e6;">
                        <h5 style="margin-bottom: 10px; color: #495057;">ğŸ”„ è‡ªåŠ¨åŒæ­¥è®¾ç½®</h5>
                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                            <input type="checkbox" id="autoSyncEnabled" ${autoSyncEnabled ? 'checked' : ''} 
                                   style="margin-right: 8px; transform: scale(1.2);">
                            <label for="autoSyncEnabled" style="margin: 0; font-weight: normal;">å¯ç”¨è‡ªåŠ¨åŒæ­¥</label>
                        </div>
                        <div style="display: flex; align-items: center;">
                            <label style="margin-right: 10px; font-weight: normal;">åŒæ­¥é¢‘ç‡:</label>
                            <select id="syncFrequency" style="padding: 5px 10px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="1" ${syncFrequency === 1 ? 'selected' : ''}>1åˆ†é’Ÿ</option>
                                <option value="5" ${syncFrequency === 5 ? 'selected' : ''}>5åˆ†é’Ÿ</option>
                                <option value="10" ${syncFrequency === 10 ? 'selected' : ''}>10åˆ†é’Ÿ</option>
                                <option value="30" ${syncFrequency === 30 ? 'selected' : ''}>30åˆ†é’Ÿ</option>
                            </select>
                        </div>
                    </div>
                    <div style="margin-bottom: 20px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        <small style="color: #666;">
                            <strong>æœ€ååŒæ­¥:</strong> ${lastSyncText}<br>
                            <strong>è·‘å‹æ•°é‡:</strong> ${runners.length} | <strong>è®°å½•æ•°é‡:</strong> ${records.length}<br>
                            <strong>è‡ªåŠ¨åŒæ­¥:</strong> ${autoSyncEnabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨'} | 
                            <strong>åŒæ­¥é¢‘ç‡:</strong> ${syncFrequency}åˆ†é’Ÿ
                        </small>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                    <button class="btn btn-success" onclick="saveCloudConfig()">ä¿å­˜é…ç½®</button>
                    <button class="btn btn-primary" onclick="syncToCloud()">åŒæ­¥åˆ°äº‘ç«¯</button>
                    <button class="btn btn-info" onclick="syncFromCloud()">ä»äº‘ç«¯åŒæ­¥</button>
                    <button class="btn btn-danger" onclick="closeCloudModal()">å…³é—­</button>
                </div>
                <div style="margin-top: 15px; font-size: 12px; color: #999;">
                    ğŸ’¡ æç¤ºï¼šTokenåªéœ€è¦åˆ›å»ºä¸€æ¬¡ï¼ŒGist IDä¼šåœ¨ç¬¬ä¸€æ¬¡åŒæ­¥æ—¶è‡ªåŠ¨ç”Ÿæˆã€‚å¯ç”¨è‡ªåŠ¨åŒæ­¥åï¼Œç³»ç»Ÿä¼šå®šæœŸæ£€æŸ¥äº‘ç«¯æ›´æ–°ã€‚
                </div>
            `;

            modal.appendChild(modalContent);
            document.body.appendChild(modal);

            // ä¿å­˜é…ç½®å‡½æ•°
            window.saveCloudConfig = function() {
                const token = document.getElementById('githubToken').value.trim();
                const gistId = document.getElementById('gistId').value.trim();
                const autoSyncEnabled = document.getElementById('autoSyncEnabled').checked;
                const syncFrequency = parseInt(document.getElementById('syncFrequency').value);
                
                if (!token) {
                    alert('è¯·è¾“å…¥GitHub Tokenï¼');
                    return;
                }
                
                cloudSync.setGithubToken(token);
                if (gistId) {
                    cloudSync.setGistId(gistId);
                }
                
                // ä¿å­˜è‡ªåŠ¨åŒæ­¥è®¾ç½®
                if (autoSyncEnabled) {
                    autoSyncManager.enableAutoSync();
                } else {
                    autoSyncManager.disableAutoSync();
                }
                autoSyncManager.setSyncFrequency(syncFrequency);
                
                alert('é…ç½®ä¿å­˜æˆåŠŸï¼');
                closeCloudModal();
            };

            // åŒæ­¥åˆ°äº‘ç«¯å‡½æ•°
            window.syncToCloud = async function() {
                try {
                    if (!cloudSync.githubToken) {
                        alert('è¯·å…ˆä¿å­˜GitHub Tokené…ç½®ï¼');
                        return;
                    }
                    
                    const btn = event.target;
                    btn.disabled = true;
                    btn.textContent = 'åŒæ­¥ä¸­...';
                    
                    await cloudSync.syncToCloud();
                    
                    alert('æ•°æ®åŒæ­¥åˆ°äº‘ç«¯æˆåŠŸï¼');
                    closeCloudModal();
                } catch (error) {
                    alert('åŒæ­¥å¤±è´¥ï¼š' + error.message);
                } finally {
                    const btn = event.target;
                    btn.disabled = false;
                    btn.textContent = 'åŒæ­¥åˆ°äº‘ç«¯';
                }
            };

            // ä»äº‘ç«¯åŒæ­¥å‡½æ•°ï¼ˆå¸¦å†²çªå¤„ç†ï¼‰
            window.syncFromCloud = async function() {
                try {
                    if (!cloudSync.gistId) {
                        alert('è¯·å…ˆè®¾ç½®Gist IDï¼');
                        return;
                    }
                    
                    const btn = event.target;
                    btn.disabled = true;
                    btn.textContent = 'åŒæ­¥ä¸­...';
                    
                    const result = await cloudSync.syncFromCloud();
                    
                    // æ£€æŸ¥æ˜¯å¦æœ‰å†²çª
                    if (result.hasConflict) {
                        console.log('æ£€æµ‹åˆ°æ•°æ®å†²çªï¼Œæ˜¾ç¤ºå†²çªè§£å†³å¯¹è¯æ¡†');
                        
                        // æ˜¾ç¤ºå†²çªè§£å†³å¯¹è¯æ¡†
                        return new Promise((resolve) => {
                            versionManager.showConflictResolutionDialog(result.conflictInfo, async (resolution) => {
                                try {
                                    // è§£å†³å†²çª
                                    const resolvedData = versionManager.resolveConflict(result.localData, result.cloudData, resolution);
                                    
                                    // å¤‡ä»½å½“å‰æ•°æ®
                                    const backup = {
                                        runners: runners,
                                        records: records,
                                        backupDate: new Date().toISOString()
                                    };
                                    localStorage.setItem('runningDataBackup', JSON.stringify(backup));
                                    
                                    // æ›´æ–°æœ¬åœ°æ•°æ®
                                    runners = resolvedData.runners;
                                    records = resolvedData.records;
                                    
                                    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                                    localStorage.setItem('runners', JSON.stringify(runners));
                                    localStorage.setItem('runningRecords', JSON.stringify(records));
                                    
                                    // æ›´æ–°ç•Œé¢
                                    updateRunnerSelect();
                                    updateRunnerList();
                                    updateRecordsTable();
                                    updateSummaryStats();
                                    updateWeekHistory();
                                    
                                    // æ˜¾ç¤ºåˆå¹¶æ—¥å¿—
                                    if (resolvedData.mergeLog && resolvedData.mergeLog.length > 0) {
                                        alert(`æ•°æ®åˆå¹¶å®Œæˆï¼\n\n${resolvedData.mergeLog.join('\n')}`);
                                    } else {
                                        alert('ä»äº‘ç«¯åŒæ­¥æˆåŠŸï¼å·²è‡ªåŠ¨å¤‡ä»½åŸæœ‰æ•°æ®ã€‚');
                                    }
                                    
                                    closeCloudModal();
                                    resolve();
                                } catch (error) {
                                    alert('å†²çªè§£å†³å¤±è´¥ï¼š' + error.message);
                                    resolve();
                                }
                            });
                        });
                    } else {
                        // æ— å†²çªï¼Œç›´æ¥åŒæ­¥
                        const cloudData = result.cloudData;
                        
                        // ç¡®è®¤å¯¼å…¥
                        const confirmMsg = `ç¡®å®šè¦ä»äº‘ç«¯åŒæ­¥æ•°æ®å—ï¼Ÿ\n\n` +
                                         `è·‘å‹æ•°é‡ï¼š${cloudData.runners.length} äºº\n` +
                                         `è®°å½•æ•°é‡ï¼š${cloudData.records.length} æ¡\n` +
                                         `æœ€åæ›´æ–°ï¼š${cloudData.lastSync ? new Date(cloudData.lastSync).toLocaleString() : 'æœªçŸ¥'}\n\n` +
                                         `âš ï¸ åŒæ­¥å°†è¦†ç›–æœ¬åœ°æ•°æ®ï¼Œè¯·è°¨æ…æ“ä½œï¼`;
                        
                        if (confirm(confirmMsg)) {
                            // å¤‡ä»½å½“å‰æ•°æ®
                            const backup = {
                                runners: runners,
                                records: records,
                                backupDate: new Date().toISOString()
                            };
                            localStorage.setItem('runningDataBackup', JSON.stringify(backup));
                            
                            // å¯¼å…¥äº‘ç«¯æ•°æ®
                            runners = cloudData.runners;
                            records = cloudData.records;
                            
                            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                            localStorage.setItem('runners', JSON.stringify(runners));
                            localStorage.setItem('runningRecords', JSON.stringify(records));
                            
                            // æ›´æ–°ç‰ˆæœ¬ä¿¡æ¯
                            versionManager.saveVersion();
                            
                            // æ›´æ–°ç•Œé¢
                            updateRunnerSelect();
                            updateRunnerList();
                            updateRecordsTable();
                            updateSummaryStats();
                            updateWeekHistory();
                            
                            alert('ä»äº‘ç«¯åŒæ­¥æˆåŠŸï¼å·²è‡ªåŠ¨å¤‡ä»½åŸæœ‰æ•°æ®ã€‚');
                            closeCloudModal();
                        }
                    }
                } catch (error) {
                    alert('åŒæ­¥å¤±è´¥ï¼š' + error.message);
                } finally {
                    const btn = event.target;
                    btn.disabled = false;
                    btn.textContent = 'ä»äº‘ç«¯åŒæ­¥';
                }
            };

            // å…³é—­æ¨¡æ€æ¡†å‡½æ•°
            window.closeCloudModal = function() {
                document.body.removeChild(modal);
                delete window.saveCloudConfig;
                delete window.syncToCloud;
                delete window.syncFromCloud;
                delete window.closeCloudModal;
            };
        }

        // æ›´æ–°å†å²è®°å½•æ˜¾ç¤º
        function updateWeekHistory() {
            const weekStart = getWeekStart(new Date());
            weekStart.setDate(weekStart.getDate() + (currentWeekOffset * 7));
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6);
            
            // æ›´æ–°å‘¨æ˜¾ç¤º
            const weekDisplay = document.getElementById('currentWeekDisplay');
            const weekRange = `${weekStart.getMonth() + 1}æœˆ${weekStart.getDate()}æ—¥ - ${weekEnd.getMonth() + 1}æœˆ${weekEnd.getDate()}æ—¥`;
            const yearDisplay = weekStart.getFullYear() !== new Date().getFullYear() ? `${weekStart.getFullYear()}å¹´` : '';
            weekDisplay.innerHTML = `<strong>${yearDisplay}${weekRange}</strong>`;
            
            // è·å–æœ¬å‘¨ç»Ÿè®¡
            const weekStats = [];
            let totalDistance = 0;
            let totalRuns = 0;
            let qualifiedRunners = 0;
            
            runners.forEach(runner => {
                const stats = getRunnerWeekStats(runner.id, weekStart);
                const isComplete = stats.qualifiedRuns >= 3 && stats.totalDistance >= runner.targetDistance;
                
                weekStats.push({
                    runner: runner,
                    stats: stats,
                    isComplete: isComplete
                });
                
                totalDistance += stats.totalDistance;
                totalRuns += stats.records.length;
                if (isComplete) qualifiedRunners++;
            });
            
            // æ›´æ–°ç»Ÿè®¡æ¦‚è§ˆ
            updateWeekHistoryStats(totalDistance, totalRuns, qualifiedRunners, runners.length);
            
            // æ›´æ–°è¯¦ç»†è®°å½•
            updateWeekHistoryDetails(weekStats);
        }
        
        // æ›´æ–°å†å²è®°å½•ç»Ÿè®¡æ¦‚è§ˆ
        function updateWeekHistoryStats(totalDistance, totalRuns, qualifiedRunners, totalRunners) {
            const container = document.getElementById('weekHistoryStats');
            
            container.innerHTML = `
                <div class="week-history-card">
                    <h4>æ€»è·‘å‹æ•°</h4>
                    <div class="stat-value">${totalRunners}</div>
                    <div class="stat-label">ä½è·‘å‹</div>
                </div>
                <div class="week-history-card">
                    <h4>è¾¾æ ‡äººæ•°</h4>
                    <div class="stat-value">${qualifiedRunners}</div>
                    <div class="stat-label">ä½è¾¾æ ‡</div>
                </div>
                <div class="week-history-card">
                    <h4>æ€»è·‘æ­¥æ¬¡æ•°</h4>
                    <div class="stat-value">${totalRuns}</div>
                    <div class="stat-label">æ¬¡è·‘æ­¥</div>
                </div>
                <div class="week-history-card">
                    <h4>æ€»è·‘æ­¥è·ç¦»</h4>
                    <div class="stat-value">${totalDistance.toFixed(1)}</div>
                    <div class="stat-label">å…¬é‡Œ</div>
                </div>
            `;
        }
        
        // æ›´æ–°å†å²è®°å½•è¯¦ç»†ä¿¡æ¯
        function updateWeekHistoryDetails(weekStats) {
            const container = document.getElementById('weekHistoryDetails');
            
            if (weekStats.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">æš‚æ— è·‘å‹æ•°æ®</div>';
                return;
            }
            
            // æŒ‰è¾¾æ ‡æƒ…å†µæ’åº
            weekStats.sort((a, b) => {
                if (a.isComplete && !b.isComplete) return -1;
                if (!a.isComplete && b.isComplete) return 1;
                return b.stats.totalDistance - a.stats.totalDistance;
            });
            
            container.innerHTML = weekStats.map(item => {
                const statusClass = item.isComplete ? 'status-complete' : 'status-incomplete';
                const statusText = item.isComplete ? 'âœ… è¾¾æ ‡' : 'âŒ æœªè¾¾æ ‡';
                const completionRate = Math.min((item.stats.totalDistance / item.runner.targetDistance * 100), 100).toFixed(1);
                
                return `
                    <div class="week-history-runner">
                        <div class="week-history-runner-name">
                            ${item.runner.name}
                            <span class="${statusClass}" style="margin-left: 10px;">${statusText}</span>
                        </div>
                        <div class="week-history-runner-stats">
                            <div class="week-history-runner-stat">
                                <div class="value">${item.stats.totalDistance.toFixed(1)}</div>
                                <div class="label">æ€»è·ç¦»(km)</div>
                            </div>
                            <div class="week-history-runner-stat">
                                <div class="value">${item.stats.runDays}</div>
                                <div class="label">è·‘æ­¥å¤©æ•°</div>
                            </div>
                            <div class="week-history-runner-stat">
                                <div class="value">${item.stats.qualifiedRuns}</div>
                                <div class="label">è¾¾æ ‡æ¬¡æ•°</div>
                            </div>
                            <div class="week-history-runner-stat">
                                <div class="value">${completionRate}%</div>
                                <div class="label">å®Œæˆç‡</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // åˆ‡æ¢å‘¨
        function changeWeek(direction) {
            currentWeekOffset += direction;
            updateWeekHistory();
        }
        
        // è¿”å›æœ¬å‘¨
        function goToCurrentWeek() {
            currentWeekOffset = 0;
            updateWeekHistory();
        }

        // æ·»åŠ å¯¼å‡ºæŒ‰é’®
        document.addEventListener('DOMContentLoaded', function() {
            const header = document.querySelector('.header');
            
            // åˆ›å»ºæ•°æ®ç®¡ç†æŒ‰é’®ç»„
            const dataMgmtGroup = document.createElement('div');
            dataMgmtGroup.style.cssText = 'position: absolute; top: 20px; right: 20px; display: flex; gap: 10px;';
            
            // å¯¼å‡ºæŒ‰é’®
            const exportBtn = document.createElement('button');
            exportBtn.className = 'btn btn-warning';
            exportBtn.textContent = 'å¯¼å‡ºæ•°æ®';
            exportBtn.onclick = exportData;
            exportBtn.title = 'å¯¼å‡ºæ‰€æœ‰è·‘æ­¥æ•°æ®åˆ°æ–‡ä»¶';
            
            // å¯¼å…¥æŒ‰é’®
            const importBtn = document.createElement('button');
            importBtn.className = 'btn btn-info';
            importBtn.textContent = 'å¯¼å…¥æ•°æ®';
            importBtn.onclick = importData;
            importBtn.title = 'ä»æ–‡ä»¶å¯¼å…¥è·‘æ­¥æ•°æ®';
            
            // æ¢å¤å¤‡ä»½æŒ‰é’®
            const restoreBtn = document.createElement('button');
            restoreBtn.className = 'btn btn-secondary';
            restoreBtn.textContent = 'æ¢å¤å¤‡ä»½';
            restoreBtn.onclick = restoreBackup;
            restoreBtn.title = 'æ¢å¤åˆ°ä¸Šä¸€æ¬¡çš„æ•°æ®å¤‡ä»½';
            
            // äº‘ç«¯åŒæ­¥æŒ‰é’®
            const cloudSyncBtn = document.createElement('button');
            cloudSyncBtn.className = 'btn btn-success';
            cloudSyncBtn.textContent = 'â˜ï¸ äº‘ç«¯åŒæ­¥';
            cloudSyncBtn.onclick = showCloudSyncModal;
            cloudSyncBtn.title = 'é…ç½®GitHub Gistäº‘ç«¯åŒæ­¥';
            
            dataMgmtGroup.appendChild(exportBtn);
            dataMgmtGroup.appendChild(importBtn);
            dataMgmtGroup.appendChild(restoreBtn);
            dataMgmtGroup.appendChild(cloudSyncBtn);
            header.appendChild(dataMgmtGroup);
        });

        // å¾®ä¿¡æµè§ˆå™¨æ£€æµ‹å’Œé€‚é…
        function detectWeChatBrowser() {
            const ua = navigator.userAgent.toLowerCase();
            const isWeChat = /micromessenger/i.test(ua);
            
            if (isWeChat) {
                console.log('æ£€æµ‹åˆ°å¾®ä¿¡æµè§ˆå™¨ï¼Œåº”ç”¨å¾®ä¿¡ä¸“ç”¨ä¼˜åŒ–');
                
                // æ·»åŠ å¾®ä¿¡ä¼˜åŒ–ç±»
                document.body.classList.add('wechat-optimized');
                document.documentElement.classList.add('wechat-safe-area');
                
                // å¾®ä¿¡æµè§ˆå™¨æ»šåŠ¨ä¼˜åŒ–
                document.querySelector('.container').classList.add('wechat-scroll');
                
                // ä¸ºæ‰€æœ‰æŒ‰é’®å’Œå¯ç‚¹å‡»å…ƒç´ æ·»åŠ å¾®ä¿¡ç‚¹å‡»ä¼˜åŒ–
                const clickableElements = document.querySelectorAll('.btn, .runner-card, .day-stat, .week-history-card');
                clickableElements.forEach(element => {
                    element.classList.add('wechat-tap');
                });
                
                // å¾®ä¿¡æµè§ˆå™¨å­—ä½“ä¼˜åŒ–
                document.body.style.fontFamily = '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"';
                
                // å¾®ä¿¡æµè§ˆå™¨è§†å£é€‚é…
                const viewport = document.querySelector('meta[name="viewport"]');
                if (viewport) {
                    viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover');
                }
                
                // å¾®ä¿¡æµè§ˆå™¨å®‰å…¨åŒºåŸŸé€‚é…
                const safeAreaStyle = document.createElement('style');
                safeAreaStyle.textContent = `
                    .wechat-safe-area {
                        padding-top: constant(safe-area-inset-top);
                        padding-top: env(safe-area-inset-top);
                        padding-bottom: constant(safe-area-inset-bottom);
                        padding-bottom: env(safe-area-inset-bottom);
                        padding-left: constant(safe-area-inset-left);
                        padding-left: env(safe-area-inset-left);
                        padding-right: constant(safe-area-inset-right);
                        padding-right: env(safe-area-inset-right);
                    }
                `;
                document.head.appendChild(safeAreaStyle);
                
                // å¾®ä¿¡æµè§ˆå™¨è¾“å…¥æ¡†ä¼˜åŒ–
                const inputs = document.querySelectorAll('input, select');
                inputs.forEach(input => {
                    input.style.fontSize = '16px'; // é˜²æ­¢å¾®ä¿¡æµè§ˆå™¨ç¼©æ”¾
                    input.addEventListener('focus', function() {
                        document.body.style.position = 'fixed';
                        document.body.style.width = '100%';
                    });
                    input.addEventListener('blur', function() {
                        document.body.style.position = '';
                        document.body.style.width = '';
                    });
                });
                
                console.log('å¾®ä¿¡æµè§ˆå™¨ä¼˜åŒ–å·²å®Œæˆ');
            }
            
            return isWeChat;
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œå¾®ä¿¡æ£€æµ‹
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(detectWeChatBrowser, 100);
            
            // å¯åŠ¨è‡ªåŠ¨åŒæ­¥ï¼ˆå¦‚æœå·²é…ç½®ï¼‰
            setTimeout(() => {
                const syncStatus = autoSyncManager.getSyncStatus();
                if (syncStatus.enabled && syncStatus.hasValidConfig) {
                    console.log('å¯åŠ¨è‡ªåŠ¨åŒæ­¥...');
                    autoSyncManager.startAutoSync();
                }
            }, 2000); // å»¶è¿Ÿ2ç§’å¯åŠ¨ï¼Œç¡®ä¿é¡µé¢å®Œå…¨åŠ è½½
        });
        
        // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°é€‚é…
        window.addEventListener('resize', function() {
            if (document.body.classList.contains('wechat-optimized')) {
                detectWeChatBrowser();
            }
        });
    </script>
</body>
</html>
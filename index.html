<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="email=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="x5-orientation" content="portrait">
    <meta name="x5-fullscreen" content="true">
    <meta name="x5-page-mode" content="app">
    <title>Ë∑ëÊ≠•ÊâìÂç°ËÆ∞ÂΩïÁ≥ªÁªü</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* ÂæÆ‰ø°ÊµèËßàÂô®ÈÄÇÈÖçÊ†∑Âºè */
        .weui-fix {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        /* ÂæÆ‰ø°ÊµèËßàÂô®Â≠ó‰Ωì‰ºòÂåñ */
        body.wechat {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        /* AIËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§ - Áõ∏ÂÖ≥Ê†∑ÂºèÂ∑≤Ê∏ÖÁêÜ */

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #ff6b6b, #ffa726);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
            padding: 25px;
            border-radius: 10px;
            background: #f8f9fa;
            border-left: 5px solid #007bff;
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
        }

        .section h2::before {
            content: "üèÉ‚Äç";
            margin-right: 10px;
            font-size: 1.2em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        .btn {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,123,255,0.3);
        }

        .btn-success {
            background: linear-gradient(45deg, #28a745, #1e7e34);
        }

        .btn-danger {
            background: linear-gradient(45deg, #dc3545, #c82333);
        }

        .btn-warning {
            background: linear-gradient(45deg, #ffc107, #e0a800);
            color: #333;
        }

        .runner-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .runner-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 4px solid #28a745;
            transition: transform 0.3s;
        }

        .runner-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .runner-card.incomplete {
            border-left-color: #dc3545;
        }

        .runner-card.warning {
            border-left-color: #ffc107;
        }

        .runner-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .runner-target {
            color: #666;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #28a745, #20c997);
            border-radius: 10px;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .week-stats {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 15px;
        }

        .day-stat {
            text-align: center;
            padding: 8px 4px;
            border-radius: 5px;
            font-size: 0.8em;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
        }

        .day-stat.completed {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .day-stat.incomplete {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .records-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .records-table th,
        .records-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .records-table th {
            background: #007bff;
            color: white;
            font-weight: bold;
        }

        .records-table tr:hover {
            background: #f8f9fa;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-top: 4px solid #007bff;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
        }

        .penalty-info {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .penalty-info h3 {
            margin-bottom: 10px;
        }

        .hidden {
            display: none;
        }

        /* Â∑≤ÁßªÈô§Â∑¶Âè≥ÂàÜÊ†èÂ∏ÉÂ±Ä - ÁïåÈù¢ÁÆÄÂåñ */

        /* ÊØèÂë®ÂéÜÂè≤ËÆ∞ÂΩïÊ†∑Âºè */
        .week-history-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .week-history-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            text-align: center;
            border-left: 4px solid #007bff;
        }

        .week-history-card h4 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 16px;
        }

        .week-history-card .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 5px;
        }

        .week-history-card .stat-label {
            color: #666;
            font-size: 14px;
        }

        .week-history-details {
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .week-history-runner {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .week-history-runner:last-child {
            border-bottom: none;
        }

        .week-history-runner-name {
            font-weight: bold;
            color: #333;
            font-size: 16px;
        }

        .week-history-runner-stats {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .week-history-runner-stat {
            text-align: center;
        }

        .week-history-runner-stat .value {
            font-weight: bold;
            color: #007bff;
            font-size: 14px;
        }

        .week-history-runner-stat .label {
            font-size: 12px;
            color: #666;
        }

        .status-complete {
            color: #28a745;
        }

        .status-incomplete {
            color: #dc3545;
        }

        .divider {
            text-align: center;
            margin: 20px 0;
            color: #666;
            font-weight: bold;
            position: relative;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #ddd;
            z-index: 1;
        }

        .divider span {
            background: white;
            padding: 0 15px;
            position: relative;
            z-index: 2;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .runner-list {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .week-stats {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .summary-stats {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }

            /* ÁßªÂä®Á´ØË°®Ê†º‰ºòÂåñ */
            .records-table {
                font-size: 12px;
            }
            
            .records-table th,
            .records-table td {
                padding: 8px 4px;
            }
            
            /* ÁßªÂä®Á´ØÊåâÈíÆ‰ºòÂåñ */
            .btn {
                padding: 8px 12px;
                font-size: 14px;
                margin: 2px;
            }
            
            /* ÁßªÂä®Á´ØË°®Âçï‰ºòÂåñ */
            .form-group {
                margin-bottom: 15px;
            }
            
            .form-group label {
                font-size: 14px;
                margin-bottom: 5px;
            }
            
            .form-group input,
            .form-group select {
                padding: 10px;
                font-size: 14px;
            }
            
            /* ÁßªÂä®Á´ØÂéÜÂè≤ËÆ∞ÂΩïÂØºËà™‰ºòÂåñ */
            .week-history-stats {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
            
            .week-history-card {
                padding: 15px;
            }
            
            /* ÁßªÂä®Á´ØË∑ëÂèãÂç°Áâá‰ºòÂåñ */
            .runner-card {
                padding: 15px;
                margin-bottom: 10px;
            }
            
            .runner-name {
                font-size: 16px;
            }
            
            .runner-stats {
                font-size: 12px;
            }
            
            /* ÁßªÂä®Á´ØÊ†áÈ¢ò‰ºòÂåñ */
            .header h1 {
                font-size: 24px;
            }
            
            .header p {
                font-size: 14px;
            }
            
            .section h2 {
                font-size: 18px;
                padding: 10px;
                margin: -20px -20px 20px -20px;
            }
            
            /* ÁßªÂä®Á´ØÂë®ÁªüËÆ°‰ºòÂåñ */
            .day-stat {
                padding: 8px;
                font-size: 12px;
            }
            
            .day-stat .day-name {
                font-size: 10px;
            }
            
            /* ÁßªÂä®Á´ØÂéÜÂè≤ËÆ∞ÂΩïËØ¶ÊÉÖ‰ºòÂåñ */
            .week-history-details {
                font-size: 14px;
            }
            
            .history-runner-item {
                padding: 10px;
                margin-bottom: 8px;
            }
            
            /* ÁßªÂä®Á´ØÁªüËÆ°Âç°Áâá‰ºòÂåñ */
            .stat-card {
                padding: 15px;
            }
            
            .stat-number {
                font-size: 1.5em;
            }
            
            .stat-label {
                font-size: 0.8em;
            }
            
            /* ÁßªÂä®Á´ØË∑ëÂèãÂç°Áâá‰ºòÂåñ */
            .runner-card {
                padding: 15px;
                margin-bottom: 10px;
            }
            
            .runner-name {
                font-size: 1.1em;
            }
            
            .runner-target {
                font-size: 0.8em;
            }
            
            .progress-bar {
                height: 15px;
            }
            
            .progress-fill {
                font-size: 10px;
            }
            
            /* ÁßªÂä®Á´ØÂØºËà™ÊåâÈíÆÁªÑ‰ºòÂåñ */
            .section > div[style*="display: flex"] {
                flex-direction: column;
                gap: 10px;
            }
            
            .section > div[style*="display: flex"] > button {
                width: 100%;
                margin: 0;
            }
            
            .section > div[style*="display: flex"] > div {
                width: 100%;
                margin: 10px 0;
            }
            
            /* Â∑≤ÁßªÈô§record-sectionÂìçÂ∫îÂºèÂ∏ÉÂ±Ä - ÁïåÈù¢ÁÆÄÂåñ */
        }
        
        /* Ë∂ÖÂ∞èÂ±èÂπïÈ¢ùÂ§ñ‰ºòÂåñ */
        @media (max-width: 480px) {
            .container {
                margin: 5px;
                border-radius: 8px;
            }
            
            .main-content {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            .section h2 {
                font-size: 16px;
                margin: -15px -15px 15px -15px;
            }
            
            .records-table {
                font-size: 11px;
            }
            
            .records-table th,
            .records-table td {
                padding: 6px 2px;
            }
            
            .btn {
                padding: 6px 10px;
                font-size: 12px;
            }
            
            .week-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 5px;
            }
            
            .day-stat {
                padding: 6px;
                font-size: 11px;
            }
            
            /* Ë∂ÖÂ∞èÂ±èÂπï‰∏ãÁöÑÂ∏ÉÂ±ÄË∞ÉÊï¥ */
            .summary-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            
            .week-history-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            
            .stat-card,
            .week-history-card {
                padding: 12px;
            }
            
            .stat-number,
            .week-history-card .stat-value {
                font-size: 18px;
            }
        }
        
        /* Ëß¶Êë∏ËÆæÂ§á‰ºòÂåñ */
        @media (hover: none) and (pointer: coarse) {
            .btn {
                min-height: 44px; /* iOSÊé®ËçêÁöÑÊúÄÂ∞èËß¶Êë∏ÁõÆÊ†á */
                -webkit-tap-highlight-color: transparent;
            }
            
            .btn:active {
                transform: scale(0.98);
                transition: transform 0.1s ease;
            }
            
            .runner-card {
                -webkit-tap-highlight-color: transparent;
            }
            
            .runner-card:active {
                transform: scale(0.99);
                transition: transform 0.1s ease;
            }
            
            /* ‰ºòÂåñÊªöÂä®ÊÄßËÉΩ */
            .records-table {
                -webkit-overflow-scrolling: touch;
                overflow-x: auto;
                display: block;
            }
            
            /* Èò≤Ê≠¢ÂèåÂáªÁº©Êîæ */
            .btn, .runner-card, .day-stat {
                touch-action: manipulation;
            }
            
            /* ÁßªÂä®Á´ØÊõ¥Â•ΩÁöÑËßÜËßâÂèçÈ¶à */
            .week-history-card {
                transition: all 0.2s ease;
            }
            
            .week-history-card:active {
                transform: translateY(1px);
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
        }
        
        /* ÊöóËâ≤Ê®°ÂºèÊîØÊåÅ */
        @media (prefers-color-scheme: dark) {
            body {
                background-color: #1a1a1a;
            }
            
            .container {
                background-color: #2d2d2d;
                color: #e0e0e0;
            }
            
            .section {
                background-color: #3d3d3d;
                border-color: #555;
            }
            
            .section h2 {
                background-color: #4a4a4a;
                color: #fff;
            }
            
            .form-group input,
            .form-group select {
                background-color: #4a4a4a;
                color: #e0e0e0;
                border-color: #666;
            }
            
            .records-table {
                background-color: #3d3d2d;
                color: #e0e0e0;
            }
            
            .records-table th {
                background-color: #4a4a4a;
            }
            
            .records-table tr:nth-child(even) {
                background-color: #454545;
            }
            
            .runner-card {
                background-color: #4a4a4a;
                border-color: #666;
            }
            
            .week-history-card {
                background-color: #4a4a4a;
                border-color: #666;
            }
            
            .day-stat {
                background-color: #4a4a4a;
                border-color: #666;
            }
            
            .status-complete {
                color: #4caf50;
            }
            
            .status-incomplete {
                color: #f44336;
            }
        }
        
        /* ÂæÆ‰ø°ÊµèËßàÂô®‰∏ìÁî®‰ºòÂåñ */
        .wechat-optimized .container {
            border-radius: 0;
            box-shadow: none;
            margin: 0;
            max-width: 100vw;
        }
        
        .wechat-optimized .header {
            border-radius: 0;
            padding: 15px;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .wechat-optimized .header h1 {
            font-size: 1.5em;
            margin-bottom: 5px;
        }
        
        .wechat-optimized .main-content {
            padding: 10px;
            padding-bottom: 20px;
        }
        
        .wechat-optimized .section {
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 8px;
        }
        
        .wechat-optimized .section h2 {
            font-size: 1.2em;
            margin: -15px -15px 10px -15px;
            padding: 10px 15px;
        }
        
        .wechat-optimized .btn {
            padding: 8px 16px;
            font-size: 14px;
            border-radius: 6px;
            min-height: 40px;
        }
        
        .wechat-optimized .runner-card {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .wechat-optimized .runner-name {
            font-size: 1.1em;
        }
        
        .wechat-optimized .stat-card {
            padding: 8px;
            border-radius: 6px;
        }
        
        .wechat-optimized .stat-number {
            font-size: 1.2em;
        }
        
        .wechat-optimized .stat-label {
            font-size: 0.8em;
        }
        
        /* ÂæÆ‰ø°ÊµèËßàÂô®ÂÆâÂÖ®Âå∫ÂüüÈÄÇÈÖç */
        .wechat-safe-area {
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
        }
        
        /* ÂæÆ‰ø°ÊµèËßàÂô®ÊªöÂä®‰ºòÂåñ */
        .wechat-scroll {
            -webkit-overflow-scrolling: touch;
            overflow-scrolling: touch;
        }
        
        /* ÂæÆ‰ø°ÊµèËßàÂô®ÁÇπÂáªÊïàÊûú‰ºòÂåñ */
        .wechat-tap {
            -webkit-tap-highlight-color: rgba(0,0,0,0);
            tap-highlight-color: rgba(0,0,0,0);
        }
    </style>
    <!-- Tesseract.js OCRÂ∫ìÂºïÁî®Â∑≤ÁßªÈô§ - AI/OCRÂäüËÉΩÂ∑≤Ê∏ÖÁêÜ -->
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèÉ‚ÄçË∑ëÊ≠•ÊâìÂç°ËÆ∞ÂΩïÁ≥ªÁªü</h1>
            <p>ÊØèÂë®Ëá≥Â∞ë3Ê¨°ÔºåÊØèÊ¨°5ÂÖ¨ÈáåÔºåÂùöÊåÅÂ∞±ÊòØËÉúÂà©ÔºÅ</p>
        </div>

        <div class="main-content">
            <!-- Ê∑ªÂä†Êñ∞ÊàêÂëò -->
            <div class="section">
                <h2>Ê∑ªÂä†Êñ∞Ë∑ëÂèã</h2>
                <div class="form-group">
                    <label for="newRunnerName">Ë∑ëÂèãÂßìÂêçÔºö</label>
                    <input type="text" id="newRunnerName" placeholder="ËØ∑ËæìÂÖ•Ë∑ëÂèãÂßìÂêç">
                </div>
                <div class="form-group">
                    <label for="newRunnerTarget">Âë®ÁõÆÊ†áË∑ùÁ¶ªÔºö</label>
                    <select id="newRunnerTarget">
                        <option value="20">20ÂÖ¨Èáå</option>
                        <option value="25">25ÂÖ¨Èáå</option>
                    </select>
                </div>
                <button class="btn btn-success" onclick="addRunner()">Ê∑ªÂä†Ë∑ëÂèã</button>
            </div>

            <!-- Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï -->
            <div class="section">
                <h2>Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï</h2>
                <div class="form-group">
                    <label for="runnerSelect">ÈÄâÊã©Ë∑ëÂèãÔºö</label>
                    <select id="runnerSelect"></select>
                </div>
                <div class="form-group">
                    <label for="runDate">Ë∑ëÊ≠•Êó•ÊúüÔºö</label>
                    <input type="date" id="runDate">
                </div>
                <div class="form-group">
                    <label for="runDistance">Ë∑ëÊ≠•Ë∑ùÁ¶ªÔºàÂÖ¨ÈáåÔºâÔºö</label>
                    <input type="number" id="runDistance" step="0.1" min="0" placeholder="ËØ∑ËæìÂÖ•Ë∑ëÊ≠•Ë∑ùÁ¶ª">
                </div>
                <div class="form-group">
                    <label for="runDuration">Ë∑ëÊ≠•Êó∂ÈïøÔºàÂàÜÈíüÔºâÔºö</label>
                    <input type="number" id="runDuration" step="1" min="0" placeholder="ËØ∑ËæìÂÖ•Ë∑ëÊ≠•Êó∂Èïø">
                </div>
                <div class="form-group">
                    <label for="runPace">Ë∑ëÊ≠•ÈÖçÈÄüÔºàÂàÜÈíü/ÂÖ¨ÈáåÔºâÔºö</label>
                    <input type="text" id="runPace" placeholder="Ëá™Âä®ËÆ°ÁÆóÊàñÊâãÂä®ËæìÂÖ•ÔºåÂ¶ÇÔºö5:30">
                </div>
                <div class="form-group">
                    <label for="runCalories">Ë∑ëÊ≠•Ê∂àËÄóÔºàÂç°Ë∑ØÈáåÔºâÔºö</label>
                    <input type="number" id="runCalories" step="1" min="0" placeholder="Ëá™Âä®‰º∞ÁÆóÊàñÊâãÂä®ËæìÂÖ•">
                </div>
                <button class="btn" onclick="addRecord()">Ê∑ªÂä†ËÆ∞ÂΩï</button>
                <button class="btn btn-warning" onclick="calculatePaceAndCalories()">ËÆ°ÁÆóÈÖçÈÄüÂíåÊ∂àËÄó</button>
            </div>

            <!-- ÁªüËÆ°Ê¶ÇËßà -->
            <div class="section">
                <h2>Êú¨Âë®ÁªüËÆ°Ê¶ÇËßà</h2>
                <div class="summary-stats" id="summaryStats"></div>
                <div class="penalty-info" id="penaltyInfo"></div>
            </div>

            <!-- Ë∑ëÂèãÂàóË°® -->
            <div class="section">
                <h2>Ë∑ëÂèãÂÆåÊàêÊÉÖÂÜµ</h2>
                <div class="runner-list" id="runnerList"></div>
            </div>

            <!-- ÊØèÂë®ÂéÜÂè≤ËÆ∞ÂΩï -->
            <div class="section">
                <h2>ÊØèÂë®ÂéÜÂè≤ËÆ∞ÂΩï</h2>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <button class="btn" onclick="changeWeek(-1)">‚Üê ‰∏ä‰∏ÄÂë®</button>
                    <div style="text-align: center;">
                        <span id="currentWeekDisplay"></span>
                        <div style="margin-top: 10px;">
                            <button class="btn btn-warning" onclick="goToCurrentWeek()">ËøîÂõûÊú¨Âë®</button>
                        </div>
                    </div>
                    <button class="btn" onclick="changeWeek(1)">‰∏ã‰∏ÄÂë® ‚Üí</button>
                </div>
                <div class="week-history-stats" id="weekHistoryStats"></div>
                <div class="week-history-details" id="weekHistoryDetails"></div>
            </div>

            <!-- ËØ¶ÁªÜËÆ∞ÂΩï -->
            <div class="section">
                <h2>ËØ¶ÁªÜË∑ëÊ≠•ËÆ∞ÂΩï</h2>
                <table class="records-table" id="recordsTable">
                    <thead>
                        <tr>
                            <th>Ë∑ëÂèã</th>
                            <th>Êó•Êúü</th>
                            <th>Ë∑ùÁ¶ª(km)</th>
                            <th>Êó∂Èïø(ÂàÜ)</th>
                            <th>ÈÖçÈÄü</th>
                            <th>Ê∂àËÄó(Âç°)</th>
                            <th>Êìç‰Ωú</th>
                        </tr>
                    </thead>
                    <tbody id="recordsBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Êï∞ÊçÆÂ≠òÂÇ®
        let runners = JSON.parse(localStorage.getItem('runners')) || [];
        let records = JSON.parse(localStorage.getItem('runningRecords')) || [];
        
        // ÂéÜÂè≤ËÆ∞ÂΩïÁõ∏ÂÖ≥ÂèòÈáè
        let currentWeekOffset = 0; // ÂΩìÂâçÊü•ÁúãÁöÑÂë®ÂÅèÁßªÈáèÔºà0Ë°®Á§∫Êú¨Âë®Ôºå-1Ë°®Á§∫‰∏äÂë®Ôºå1Ë°®Á§∫‰∏ãÂë®Ôºâ

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // ËÆæÁΩÆÈªòËÆ§Êó•Êúü‰∏∫‰ªäÂ§©
            document.getElementById('runDate').valueAsDate = new Date();
            
            // Êõ¥Êñ∞ÁïåÈù¢
            updateRunnerSelect();
            updateRunnerList();
            updateRecordsTable();
            updateSummaryStats();
            updateWeekHistory(); // ÂàùÂßãÂåñÂéÜÂè≤ËÆ∞ÂΩïÊòæÁ§∫
        });

        // ÁÆ°ÁêÜÂëòÂØÜÁ†ÅÔºàÂèØ‰ª•Ê†πÊçÆÈúÄË¶Å‰øÆÊîπÔºâ
        const ADMIN_PASSWORD = 'running2024';

        // ÊòæÁ§∫ÂØÜÁ†ÅËæìÂÖ•Ê®°ÊÄÅÊ°Ü
        function showPasswordModal(callback) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;

            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white;
                padding: 30px;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                text-align: center;
                min-width: 300px;
            `;

            modalContent.innerHTML = `
                <h3 style="margin-bottom: 20px; color: #333;">üîê ÁÆ°ÁêÜÂëòÈ™åËØÅ</h3>
                <p style="margin-bottom: 15px; color: #666;">ËØ∑ËæìÂÖ•ÁÆ°ÁêÜÂëòÂØÜÁ†ÅÔºö</p>
                <input type="password" id="adminPassword" placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å" 
                       style="width: 100%; padding: 12px; border: 2px solid #ddd; 
                              border-radius: 8px; margin-bottom: 20px; font-size: 16px;">
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button class="btn btn-success" onclick="confirmPassword()">Á°ÆËÆ§</button>
                    <button class="btn btn-danger" onclick="cancelPassword()">ÂèñÊ∂à</button>
                </div>
            `;

            modal.appendChild(modalContent);
            document.body.appendChild(modal);

            // ËÅöÁÑ¶Âà∞ÂØÜÁ†ÅËæìÂÖ•Ê°Ü
            setTimeout(() => {
                document.getElementById('adminPassword').focus();
            }, 100);

            // Á°ÆËÆ§ÂØÜÁ†ÅÂáΩÊï∞
            window.confirmPassword = function() {
                const password = document.getElementById('adminPassword').value;
                if (password === ADMIN_PASSWORD) {
                    document.body.removeChild(modal);
                    delete window.confirmPassword;
                    delete window.cancelPassword;
                    callback(true);
                } else {
                    alert('ÂØÜÁ†ÅÈîôËØØÔºÅ');
                    document.getElementById('adminPassword').value = '';
                    document.getElementById('adminPassword').focus();
                }
            };

            // ÂèñÊ∂àÂØÜÁ†ÅÂáΩÊï∞
            window.cancelPassword = function() {
                document.body.removeChild(modal);
                delete window.confirmPassword;
                delete window.cancelPassword;
                callback(false);
            };

            // ÂõûËΩ¶Á°ÆËÆ§
            document.getElementById('adminPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    confirmPassword();
                }
            });
        }

        // Ê∑ªÂä†Ë∑ëÂèãÔºàÂ∏¶ÊùÉÈôêÈ™åËØÅÔºâ
        function addRunner() {
            const name = document.getElementById('newRunnerName').value.trim();
            const target = parseInt(document.getElementById('newRunnerTarget').value);

            if (!name) {
                alert('ËØ∑ËæìÂÖ•Ë∑ëÂèãÂßìÂêçÔºÅ');
                return;
            }

            if (runners.some(runner => runner.name === name)) {
                alert('ËØ•Ë∑ëÂèãÂ∑≤Â≠òÂú®ÔºÅ');
                return;
            }

            // ÊòæÁ§∫ÂØÜÁ†ÅÈ™åËØÅÊ®°ÊÄÅÊ°Ü
            showPasswordModal(function(isAuthenticated) {
                if (isAuthenticated) {
                    const newRunner = {
                        id: Date.now(),
                        name: name,
                        targetDistance: target,
                        joinDate: new Date().toISOString().split('T')[0]
                    };

                    runners.push(newRunner);
                    localStorage.setItem('runners', JSON.stringify(runners));

                    // Ê∏ÖÁ©∫ËæìÂÖ•
                    document.getElementById('newRunnerName').value = '';

                    // Êõ¥Êñ∞ÁïåÈù¢
                    updateRunnerSelect();
                    updateRunnerList();
                    updateSummaryStats();

                    alert('Ë∑ëÂèãÊ∑ªÂä†ÊàêÂäüÔºÅ');
                } else {
                    alert('Ê∑ªÂä†Ë∑ëÂèãÂ∑≤ÂèñÊ∂à');
                }
            });
        }

        // Êõ¥Êñ∞Ë∑ëÂèãÈÄâÊã©‰∏ãÊãâÊ°Ü
        function updateRunnerSelect() {
            const select = document.getElementById('runnerSelect');
            select.innerHTML = '<option value="">ËØ∑ÈÄâÊã©Ë∑ëÂèã</option>';
            
            runners.forEach(runner => {
                const option = document.createElement('option');
                option.value = runner.id;
                option.textContent = runner.name;
                select.appendChild(option);
            });
        }

        // ËÆ°ÁÆóÈÖçÈÄüÂíåÂç°Ë∑ØÈáåÊ∂àËÄó
        function calculatePaceAndCalories() {
            const distance = parseFloat(document.getElementById('runDistance').value);
            const duration = parseFloat(document.getElementById('runDuration').value);
            const runnerId = document.getElementById('runnerSelect').value;

            if (!runnerId) {
                alert('ËØ∑ÂÖàÈÄâÊã©Ë∑ëÂèãÔºÅ');
                return;
            }

            if (!distance || !duration || distance <= 0 || duration <= 0) {
                alert('ËØ∑ÂÖàÂ°´ÂÜôË∑ëÊ≠•Ë∑ùÁ¶ªÂíåÊó∂ÈïøÔºÅ');
                return;
            }

            // ËÆ°ÁÆóÈÖçÈÄüÔºàÂàÜÈíü/ÂÖ¨ÈáåÔºâ
            const pace = duration / distance;
            const paceMinutes = Math.floor(pace);
            const paceSeconds = Math.round((pace - paceMinutes) * 60);
            const paceString = `${paceMinutes}:${paceSeconds.toString().padStart(2, '0')}`;

            // ‰º∞ÁÆóÂç°Ë∑ØÈáåÊ∂àËÄóÔºàÂü∫‰∫é‰ΩìÈáç65kgÁöÑÁ≤óÁï•‰º∞ÁÆóÔºâ
            const calories = Math.round(distance * duration * 0.1); // ÁÆÄÂåñÁöÑËÆ°ÁÆóÂÖ¨Âºè

            // Â°´ÂÖÖËÆ°ÁÆóÁªìÊûú
            document.getElementById('runPace').value = paceString;
            document.getElementById('runCalories').value = calories;

            alert(`ËÆ°ÁÆóÂÆåÊàêÔºÅ\nÈÖçÈÄüÔºö${paceString} ÂàÜÈíü/ÂÖ¨Èáå\n‰º∞ÁÆóÊ∂àËÄóÔºö${calories} Âç°Ë∑ØÈáå`);
        }

        // Ëß£ÊûêÈÖçÈÄüÂ≠óÁ¨¶‰∏≤ÔºàÂ¶ÇÔºö5:30Ôºâ‰∏∫ÂàÜÈíüÊï∞
        function parsePace(paceString) {
            if (!paceString) return 0;
            const parts = paceString.split(':');
            if (parts.length === 2) {
                const minutes = parseInt(parts[0]) || 0;
                const seconds = parseInt(parts[1]) || 0;
                return minutes + seconds / 60;
            }
            return parseFloat(paceString) || 0;
        }

        // ÊòæÁ§∫ÊâãÂä®ËæìÂÖ•ÊèêÁ§∫ÔºàÂ∑≤ÁßªÈô§ÂõæÁâá‰∏ä‰º†ÂäüËÉΩÔºâ
        function showManualInputHint() {
            alert('üìã ËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï\n\nÊ≠•È™§Ôºö\n1. ÈÄâÊã©Ë∑ëÂèã\n2. ËæìÂÖ•Êó•Êúü\n3. Â°´ÂÜôË∑ùÁ¶ªÂíåÊó∂Èïø\n4. ÁÇπÂáª"Ê∑ªÂä†ËÆ∞ÂΩï"');
        }

        // Â∑≤ÁßªÈô§ÊâÄÊúâOCRÂíåAIËØÜÂà´ÂäüËÉΩ

        // Â∑≤ÁßªÈô§AIËØÜÂà´ÂäüËÉΩÔºàÊõøÊç¢‰∏∫ÊèêÁ§∫Ôºâ
        function performAIRecognition(imageData) {
            alert('üö´ AIÊô∫ËÉΩËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ\n\nÊ≠•È™§Ôºö\n1. ÈÄâÊã©Ë∑ëÂèã\n2. ËæìÂÖ•Êó•Êúü\n3. Â°´ÂÜôË∑ùÁ¶ªÂíåÊó∂Èïø\n4. ÁÇπÂáª"Ê∑ªÂä†ËÆ∞ÂΩï"');
        }

        // Ë∞ÉÁî®SiliconFlow APIÔºàÂ∑≤ÁßªÈô§Ôºâ
        function callSiliconFlowAPI(base64Image, modal, timeoutId) {
            alert('üö´ AIËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ');
        }

        // Â§ÑÁêÜAIËØÜÂà´ÁªìÊûúÔºàÂ∑≤ÁßªÈô§Ôºâ
        function processAIResult(aiData) {
            alert('üö´ AIËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ');
        }

        // ÊòæÁ§∫AIËØÜÂà´ÁªìÊûúÔºàÂ∑≤ÁßªÈô§Ôºâ
        function showAIResult(data, rawData) {
            alert('üö´ AIËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ');
        }

        // ‰ªéAIË°®ÂçïÂ∫îÁî®Êï∞ÊçÆÔºàÂ∑≤ÁßªÈô§Ôºâ
        function applyAIDataFromForm() {
            alert('üö´ AIËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ');
        }

        // ‰ªéAIÁªìÊûúÈáçËØï‰º†ÁªüOCRÔºàÂ∑≤ÁßªÈô§Ôºâ
        function retryWithTraditionalOCR() {
            alert('üö´ OCRËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ');
        }

        // ‰ªéAIÁªìÊûúÂàáÊç¢Âà∞ÊâãÂä®ËæìÂÖ•ÔºàÂ∑≤ÁßªÈô§Ôºâ
        function showManualInputModalFromAI() {
            alert('üö´ AIËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ');
        }
        
        // ÁîüÊàêÊµãËØïÊà™ÂõæÔºàÂ∑≤ÁßªÈô§Ôºâ
        function generateTestScreenshot() {
            alert('üö´ ÊµãËØïÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ');
        }

        // ÊâßË°åAIËØÜÂà´ÔºàÂ∑≤ÁßªÈô§Ôºâ
        function performAIRecognition(imageData) {
            alert('üö´ AIËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ');
        }

        // Ë∞ÉÁî®SiliconFlow APIÔºàÂ∑≤ÁßªÈô§Ôºâ
        function callSiliconFlowAPI(base64Image, modal, timeoutId) {
            alert('üö´ AIËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ');
        }

        // Â§ÑÁêÜAIËØÜÂà´ÁªìÊûúÔºàÂ∑≤ÁßªÈô§Ôºâ
        function processAIResult(aiData) {
            alert('üö´ AIËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ');
        }

        // ÊòæÁ§∫AIËØÜÂà´ÁªìÊûúÔºàÂ∑≤ÁßªÈô§Ôºâ
        function showAIResult(data, rawData) {
            alert('üö´ AIËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ');
        }

        // ‰ªéAIË°®ÂçïÂ∫îÁî®Êï∞ÊçÆÔºàÂ∑≤ÁßªÈô§Ôºâ
        function applyAIDataFromForm() {
            alert('üö´ AIËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ');
        }

        // ‰ªéAIÁªìÊûúÈáçËØï‰º†ÁªüOCRÔºàÂ∑≤ÁßªÈô§Ôºâ
        function retryWithTraditionalOCR() {
            alert('üö´ OCRËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ');
        }

        // ‰ªéAIÁªìÊûúÂàáÊç¢Âà∞ÊâãÂä®ËæìÂÖ•ÔºàÂ∑≤ÁßªÈô§Ôºâ
        function showManualInputModalFromAI() {
            alert('üö´ AIËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ');
        }
        
        // ÁîüÊàêÊµãËØïË∑ëÊ≠•Êà™Âõæ - Â∑≤ÁßªÈô§
        function generateTestScreenshot() {
            alert('ÊµãËØïÊà™ÂõæÂäüËÉΩÂ∑≤ÁßªÈô§ÔºåËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï');
        }

        // ÊòæÁ§∫ÊâãÂä®ËæìÂÖ•Ê®°ÊÄÅÊ°ÜÔºàOCRÂ§±Ë¥•Êó∂‰ΩøÁî®Ôºâ- Â∑≤ÁßªÈô§
        function showManualInputModal() {
            alert('OCRËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§ÔºåËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï');
        }

        // Â∫îÁî®ÊâãÂä®ËæìÂÖ•ÁöÑÊï∞ÊçÆ - Â∑≤ÁßªÈô§
        function applyManualData() {
            alert('OCRËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§ÔºåËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï');
        }

        // Áõ¥Êé•ÊòæÁ§∫ÊâãÂä®ËæìÂÖ•ÁïåÈù¢ÔºàË∑≥ËøáOCRÔºâ- Â∑≤ÁßªÈô§
        function directManualInput() {
            alert('OCRËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§ÔºåËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï');
        }

        // ÂàõÂª∫Ê®°ÊÄÅÊ°Ü
        function createModal(content) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.cssText = `
                position: fixed;
                top: 0; left: 0;
                width: 100%; height: 100%;
                background: rgba(0,0,0,.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 2000;
            `;
            modal.appendChild(content);
            return modal;
        }

        // Â§ÑÁêÜOCRËØÜÂà´ÁªìÊûú
        function processOCRResult(text) {
            console.log('OCRËØÜÂà´ÁªìÊûúÔºö', text);
            
            // ÊèêÂèñË∑ëÊ≠•Êï∞ÊçÆÁöÑÊ≠£ÂàôË°®ËææÂºè - Â¢ûÂº∫ÁâàÊú¨
            const patterns = {
                // Ë∑ùÁ¶ªÔºöÊîØÊåÅÂ§öÁßçÊ†ºÂºèÔºåÂåÖÊã¨Â∞èÊï∞ÁÇπ
                distance: /(\d+\.?\d*)\s*(ÂÖ¨Èáå|km|ÂçÉÁ±≥|KM|ÂÖ¨Èáå|km)/gi,
                // Êó∂ÈïøÔºöÊîØÊåÅÂàÜÈíü„ÄÅÂ∞èÊó∂ÂàÜÈíüÊ†ºÂºè
                duration: /(\d+)\s*(ÂàÜÈíü|ÂàÜ|ÂàÜÈíü|min|m)|(\d+):(\d+)\s*(Â∞èÊó∂|Êó∂|h)/gi,
                // ÈÖçÈÄüÔºöÊîØÊåÅÂàÜ:ÁßíÊ†ºÂºèÔºåÂèØÂåÖÂê´ÂàÜÈíü/ÈÖçÈÄüÁ≠âÂ≠óÊ†∑
                pace: /(\d+):(\d+)(?:\s*(ÂàÜÈíü|ÈÖçÈÄü|pace|min\/km))?/gi,
                // Âç°Ë∑ØÈáåÔºöÊîØÊåÅÂ§öÁßçË°®Ëø∞
                calories: /(\d+)\s*(Âç°Ë∑ØÈáå|Âç°|ÁÉ≠Èáè|cal|kcal|ÂçÉÂç°)/gi,
                // Êó•ÊúüÔºöÊîØÊåÅÂ§öÁßçÊó•ÊúüÊ†ºÂºè
                date: /(\d{4})[Âπ¥\/-](\d{1,2})[Êúà\/-](\d{1,2})[Êó•\s]?|(\d{1,2})[Êúà\/-](\d{1,2})[Êó•\s]?|(\d{4})-(\d{2})-(\d{2})/g
            };

            const extractedData = {};
            
            // ÊèêÂèñË∑ùÁ¶ª - ÂèñÁ¨¨‰∏Ä‰∏™ÂåπÈÖçÁöÑÊï∞Â≠ó
            const distanceMatches = [...text.matchAll(patterns.distance)];
            if (distanceMatches.length > 0) {
                extractedData.distance = parseFloat(distanceMatches[0][1]);
            }
            
            // ÊèêÂèñÊó∂Èïø - ‰ºòÂÖàÂåπÈÖçÂàÜÈíüÊ†ºÂºèÔºåÂÖ∂Ê¨°ÂåπÈÖçÂ∞èÊó∂:ÂàÜÈíüÊ†ºÂºè
            const durationMatches = [...text.matchAll(patterns.duration)];
            if (durationMatches.length > 0) {
                const match = durationMatches[0];
                if (match[1]) {
                    // Á∫ØÂàÜÈíüÊ†ºÂºè
                    extractedData.duration = parseInt(match[1]);
                } else if (match[3] && match[4]) {
                    // Â∞èÊó∂:ÂàÜÈíüÊ†ºÂºèÔºåËΩ¨Êç¢‰∏∫ÊÄªÂàÜÈíüÊï∞
                    const hours = parseInt(match[3]) || 0;
                    const minutes = parseInt(match[4]) || 0;
                    extractedData.duration = hours * 60 + minutes;
                }
            }
            
            // ÊèêÂèñÈÖçÈÄü - ÂèñÁ¨¨‰∏Ä‰∏™ÂåπÈÖçÁöÑÈÖçÈÄü
            const paceMatches = [...text.matchAll(patterns.pace)];
            if (paceMatches.length > 0) {
                const match = paceMatches[0];
                extractedData.pace = `${match[1]}:${match[2].padStart(2, '0')}`;
            }
            
            // ÊèêÂèñÂç°Ë∑ØÈáå - ÂèñÁ¨¨‰∏Ä‰∏™ÂåπÈÖçÁöÑÊï∞Â≠ó
            const caloriesMatches = [...text.matchAll(patterns.calories)];
            if (caloriesMatches.length > 0) {
                extractedData.calories = parseInt(caloriesMatches[0][1]);
            }
            
            // ÊèêÂèñÊó•Êúü - ÊîØÊåÅÂ§öÁßçÊ†ºÂºè
            const dateMatches = [...text.matchAll(patterns.date)];
            if (dateMatches.length > 0) {
                const match = dateMatches[0];
                let year, month, day;
                
                if (match[1] && match[2] && match[3]) {
                    // 2024Âπ¥1Êúà15Êó• Êàñ 2024-1-15 Ê†ºÂºè
                    year = match[1];
                    month = match[2].padStart(2, '0');
                    day = match[3].padStart(2, '0');
                } else if (match[4] && match[5]) {
                    // 1Êúà15Êó• Ê†ºÂºèÔºåÈúÄË¶ÅË°•ÂÖ®Âπ¥‰ªΩ
                    year = new Date().getFullYear();
                    month = match[4].padStart(2, '0');
                    day = match[5].padStart(2, '0');
                } else if (match[6] && match[7] && match[8]) {
                    // 2024-01-15 Ê†ºÂºè
                    year = match[6];
                    month = match[7];
                    day = match[8];
                }
                
                if (year && month && day) {
                    extractedData.date = `${year}-${month}-${day}`;
                }
            }

            // Â¶ÇÊûúÊ≤°ÊúâËØÜÂà´Âà∞Êó•ÊúüÔºå‰ΩøÁî®ÂΩìÂâçÊó•Êúü‰Ωú‰∏∫ÈªòËÆ§ÂÄº
            if (!extractedData.date) {
                extractedData.date = new Date().toISOString().split('T')[0];
            }

            showOCRResult(extractedData, text);
        }

        // ÊòæÁ§∫OCRËØÜÂà´ÁªìÊûú - Â∑≤ÁßªÈô§
        function showOCRResult(data, rawText) {
            alert('OCRËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§ÔºåËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï');
        }

        // ÂÖ≥Èó≠OCRÁªìÊûúÂºπÁ™ó - Â∑≤ÁßªÈô§
        function closeOCRModal() {
            // ÂäüËÉΩÂ∑≤ÁßªÈô§
        }

        // ‰ªéOCRË°®ÂçïÂ∫îÁî®Êï∞ÊçÆ - Â∑≤ÁßªÈô§
        function applyOCRDataFromForm() {
            alert('OCRËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§ÔºåËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï');
        }

        // Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï
        function addRecord() {
            const runnerId = document.getElementById('runnerSelect').value;
            const date = document.getElementById('runDate').value;
            const distance = parseFloat(document.getElementById('runDistance').value);
            const duration = parseFloat(document.getElementById('runDuration').value);
            const pace = document.getElementById('runPace').value;
            const calories = parseInt(document.getElementById('runCalories').value) || 0;

            if (!runnerId || !date || !distance || distance <= 0) {
                alert('ËØ∑Â°´ÂÜôÂÆåÊï¥ÁöÑË∑ëÊ≠•ËÆ∞ÂΩï‰ø°ÊÅØÔºàËá≥Â∞ëÂåÖÂê´Ë∑ëÂèã„ÄÅÊó•Êúü„ÄÅË∑ùÁ¶ªÔºâÔºÅ');
                return;
            }

            // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÊúâÂêå‰∏ÄÂ§©ÁöÑËÆ∞ÂΩï
            const existingRecord = records.find(r => 
                r.runnerId == runnerId && r.date === date
            );

            const recordData = {
                id: existingRecord ? existingRecord.id : Date.now(),
                runnerId: parseInt(runnerId),
                date: date,
                distance: distance,
                duration: duration || null,
                pace: pace || null,
                calories: calories || null
            };

            if (existingRecord) {
                if (confirm('ËØ•Ë∑ëÂèã‰ªäÂ§©Â∑≤ÊúâË∑ëÊ≠•ËÆ∞ÂΩïÔºåÊòØÂê¶Êõ¥Êñ∞ËÆ∞ÂΩïÔºü')) {
                    const index = records.findIndex(r => r.id === existingRecord.id);
                    records[index] = recordData;
                } else {
                    return;
                }
            } else {
                records.push(recordData);
            }

            localStorage.setItem('runningRecords', JSON.stringify(records));

            // Ê∏ÖÁ©∫ËæìÂÖ•
            document.getElementById('runDistance').value = '';
            document.getElementById('runDuration').value = '';
            document.getElementById('runPace').value = '';
            document.getElementById('runCalories').value = '';

            // Êõ¥Êñ∞ÁïåÈù¢
            updateRunnerList();
            updateRecordsTable();
            updateSummaryStats();

            alert('Ë∑ëÊ≠•ËÆ∞ÂΩïÊ∑ªÂä†ÊàêÂäüÔºÅ');
        }

        // Ëé∑ÂèñÂë®ÂºÄÂßãÊó•Êúü
        function getWeekStart(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1); // Ë∞ÉÊï¥‰∏∫Âë®‰∏ÄÂºÄÂßã
            return new Date(d.setDate(diff));
        }

        // Ëé∑ÂèñÂë®ÁªìÊùüÊó•Êúü
        function getWeekEnd(date) {
            const weekStart = getWeekStart(date);
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6);
            return weekEnd;
        }

        // Ëé∑ÂèñË∑ëÂèãÊú¨Âë®ÁªüËÆ°
        function getRunnerWeekStats(runnerId, weekStart) {
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6);

            const weekRecords = records.filter(r => {
                const recordDate = new Date(r.date);
                return r.runnerId == runnerId && 
                       recordDate >= weekStart && 
                       recordDate <= weekEnd;
            });

            const totalDistance = weekRecords.reduce((sum, r) => sum + r.distance, 0);
            const runDays = weekRecords.length;
            const qualifiedRuns = weekRecords.filter(r => r.distance >= 5).length;
            
            // ËÆ°ÁÆóÂπ≥ÂùáÈÖçÈÄü
            const paceRecords = weekRecords.filter(r => r.pace);
            let avgPace = null;
            if (paceRecords.length > 0) {
                const totalPaceMinutes = paceRecords.reduce((sum, r) => {
                    return sum + parsePace(r.pace);
                }, 0);
                const avgPaceMinutes = totalPaceMinutes / paceRecords.length;
                const avgMinutes = Math.floor(avgPaceMinutes);
                const avgSeconds = Math.round((avgPaceMinutes - avgMinutes) * 60);
                avgPace = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            }
            
            // ËÆ°ÁÆóÊÄªÊ∂àËÄóÂç°Ë∑ØÈáå
            const totalCalories = weekRecords.reduce((sum, r) => sum + (r.calories || 0), 0);

            return {
                totalDistance: totalDistance,
                runDays: runDays,
                qualifiedRuns: qualifiedRuns,
                records: weekRecords,
                avgPace: avgPace,
                totalCalories: totalCalories > 0 ? totalCalories : null
            };
        }

        // Êõ¥Êñ∞Ë∑ëÂèãÂàóË°®
        function updateRunnerList() {
            const container = document.getElementById('runnerList');
            container.innerHTML = '';

            // Êõ¥Êñ∞ÊâãÂä®Ê∑ªÂä†Âå∫ÂüüÁöÑË∑ëÂèãÈÄâÊã©
            const runnerSelect = document.getElementById('runnerSelect');
            runnerSelect.innerHTML = '<option value="">ËØ∑ÈÄâÊã©Ë∑ëÂèã</option>';
            
            // OCRÂå∫ÂüüÁöÑË∑ëÂèãÈÄâÊã©Â∑≤ÁßªÈô§
            // const runnerSelectOCR = document.getElementById('runnerSelectOCR');
            // runnerSelectOCR.innerHTML = '<option value="">ËØ∑ÈÄâÊã©Ë∑ëÂèã</option>';

            if (runners.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">ÊöÇÊó†Ë∑ëÂèãÔºåËØ∑ÂÖàÊ∑ªÂä†Ë∑ëÂèã</p>';
                return;
            }

            // Â°´ÂÖÖË∑ëÂèãÈÄâÊã©‰∏ãÊãâÊ°Ü
            runners.forEach(runner => {
                const option1 = document.createElement('option');
                option1.value = runner.id;
                option1.textContent = runner.name;
                runnerSelect.appendChild(option1);
                
                // OCRÂå∫ÂüüÁöÑË∑ëÂèãÈÄâÊã©Â∑≤ÁßªÈô§
                // const option2 = document.createElement('option');
                // option2.value = runner.id;
                // option2.textContent = runner.name;
                // runnerSelectOCR.appendChild(option2);
            });

            const weekStart = getWeekStart(new Date());

            runners.forEach(runner => {
                const stats = getRunnerWeekStats(runner.id, weekStart);
                const isComplete = stats.qualifiedRuns >= 3 && stats.totalDistance >= runner.targetDistance;
                const isWarning = stats.qualifiedRuns < 3 || stats.totalDistance < runner.targetDistance;

                const card = document.createElement('div');
                card.className = `runner-card ${isComplete ? '' : 'incomplete'} ${isWarning ? 'warning' : ''}`;

                const progressPercent = Math.min((stats.totalDistance / runner.targetDistance) * 100, 100);

                card.innerHTML = `
                    <div class="runner-name">${runner.name}</div>
                    <div class="runner-target">ÁõÆÊ†áÔºö${runner.targetDistance}ÂÖ¨Èáå/Âë® | Â∑≤ÂÆåÊàêÔºö${stats.totalDistance.toFixed(1)}ÂÖ¨Èáå</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progressPercent}%">
                            ${progressPercent.toFixed(0)}%
                        </div>
                    </div>
                    <div style="font-size: 0.9em; margin-bottom: 10px;">
                        Êú¨Âë®Ë∑ëÊ≠•Ôºö${stats.runDays}Ê¨° | ËææÊ†áÔºö${stats.qualifiedRuns}Ê¨°
                        ${stats.avgPace ? `| Âπ≥ÂùáÈÖçÈÄüÔºö${stats.avgPace}` : ''}
                        ${stats.totalCalories ? `| ÊÄªÊ∂àËÄóÔºö${stats.totalCalories}Âç°` : ''}
                    </div>
                    <div class="week-stats">
                        ${getWeekDaysHTML(stats.records, weekStart)}
                    </div>
                `;

                container.appendChild(card);
            });
        }

        // Ëé∑ÂèñÂë®ÊòæÁ§∫HTML
        function getWeekDaysHTML(records, weekStart) {
            const days = ['‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠', 'Êó•'];
            let html = '';

            for (let i = 0; i < 7; i++) {
                const currentDate = new Date(weekStart);
                currentDate.setDate(weekStart.getDate() + i);
                const dateStr = currentDate.toISOString().split('T')[0];
                
                const dayRecord = records.find(r => r.date === dateStr);
                const hasRecord = !!dayRecord;
                const isQualified = hasRecord && dayRecord.distance >= 5;

                html += `
                    <div class="day-stat ${hasRecord ? (isQualified ? 'completed' : 'incomplete') : ''}">
                        <div>${days[i]}</div>
                        ${hasRecord ? `<div>${dayRecord.distance}km</div>` : '<div>-</div>'}
                        ${hasRecord && dayRecord.pace ? `<div>${dayRecord.pace}</div>` : ''}
                    </div>
                `;
            }

            return html;
        }

        // Êõ¥Êñ∞ËÆ∞ÂΩïË°®Ê†º
        function updateRecordsTable() {
            const tbody = document.getElementById('recordsBody');
            tbody.innerHTML = '';

            if (records.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #666;">ÊöÇÊó†Ë∑ëÊ≠•ËÆ∞ÂΩï</td></tr>';
                return;
            }

            // ÊåâÊó•ÊúüÂÄíÂ∫èÊéíÂàó
            const sortedRecords = [...records].sort((a, b) => new Date(b.date) - new Date(a.date));

            sortedRecords.forEach(record => {
                const runner = runners.find(r => r.id == record.runnerId);
                if (!runner) return;

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${runner.name}</td>
                    <td>${record.date}</td>
                    <td>${record.distance}</td>
                    <td>${record.duration || '-'}</td>
                    <td>${record.pace || '-'}</td>
                    <td>${record.calories || '-'}</td>
                    <td>
                        <button class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;" 
                                onclick="deleteRecord(${record.id})">Âà†Èô§</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Âà†Èô§ËÆ∞ÂΩï
        function deleteRecord(recordId) {
            if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÊù°ËÆ∞ÂΩïÂêóÔºü')) {
                records = records.filter(r => r.id !== recordId);
                localStorage.setItem('runningRecords', JSON.stringify(records));
                
                updateRunnerList();
                updateRecordsTable();
                updateSummaryStats();
            }
        }

        // Êõ¥Êñ∞ÁªüËÆ°Ê¶ÇËßà
        function updateSummaryStats() {
            const container = document.getElementById('summaryStats');
            const penaltyContainer = document.getElementById('penaltyInfo');
            
            const weekStart = getWeekStart(new Date());
            let totalRunners = runners.length;
            let completedRunners = 0;
            let totalPenalties = 0;
            let completedDistance = 0;
            let totalDuration = 0;
            let totalCalories = 0;
            let avgPaceRecords = [];

            runners.forEach(runner => {
                const stats = getRunnerWeekStats(runner.id, weekStart);
                const isComplete = stats.qualifiedRuns >= 3 && stats.totalDistance >= runner.targetDistance;
                
                if (isComplete) {
                    completedRunners++;
                } else {
                    totalPenalties += 500;
                }
                
                completedDistance += stats.totalDistance;
                totalDuration += stats.records.reduce((sum, r) => sum + (r.duration || 0), 0);
                totalCalories += stats.totalCalories || 0;
                
                // Êî∂ÈõÜÊâÄÊúâÈÖçÈÄüÊï∞ÊçÆ
                stats.records.forEach(r => {
                    if (r.pace) {
                        avgPaceRecords.push(parsePace(r.pace));
                    }
                });
            });

            const rewardPerPerson = completedRunners > 0 ? totalPenalties / completedRunners : 0;
            
            // ËÆ°ÁÆóÂπ≥ÂùáÈÖçÈÄü
            let avgPace = null;
            if (avgPaceRecords.length > 0) {
                const avgPaceMinutes = avgPaceRecords.reduce((sum, pace) => sum + pace, 0) / avgPaceRecords.length;
                const avgMinutes = Math.floor(avgPaceMinutes);
                const avgSeconds = Math.round((avgPaceMinutes - avgMinutes) * 60);
                avgPace = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            }

            container.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${totalRunners}</div>
                    <div class="stat-label">ÊÄªË∑ëÂèãÊï∞</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${completedRunners}</div>
                    <div class="stat-label">Êú¨Âë®ËææÊ†á</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${completedDistance.toFixed(1)}</div>
                    <div class="stat-label">Êú¨Âë®ÊÄªÈáåÁ®ã(km)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${Math.round(totalDuration)}</div>
                    <div class="stat-label">Êú¨Âë®ÊÄªÊó∂Èïø(ÂàÜ)</div>
                </div>
                ${avgPace ? `
                <div class="stat-card">
                    <div class="stat-number">${avgPace}</div>
                    <div class="stat-label">Âπ≥ÂùáÈÖçÈÄü</div>
                </div>
                ` : ''}
                ${totalCalories > 0 ? `
                <div class="stat-card">
                    <div class="stat-number">${Math.round(totalCalories)}</div>
                    <div class="stat-label">ÊÄªÊ∂àËÄó(Âç°)</div>
                </div>
                ` : ''}
                <div class="stat-card">
                    <div class="stat-number">${totalPenalties}</div>
                    <div class="stat-label">Êú¨Âë®ÁΩöÊ¨æÊÄªÈ¢ù(ÂÖÉ)</div>
                </div>
            `;

            if (totalPenalties > 0 && completedRunners > 0) {
                penaltyContainer.innerHTML = `
                    <h3>üèÜ Êú¨Âë®Â•ñÂä±ÂàÜÈÖç</h3>
                    <p>ËææÊ†áË∑ëÂèãÊØè‰∫∫ÂèØËé∑ÂæóÂ•ñÂä±Ôºö${rewardPerPerson.toFixed(2)}ÂÖÉ</p>
                    <p>Êú™ËææÊ†áË∑ëÂèãÈúÄË¶ÅÁº¥Á∫≥ÁΩöÊ¨æÔºö500ÂÖÉ</p>
                `;
            } else if (totalPenalties > 0) {
                penaltyContainer.innerHTML = `
                    <h3>‚ö†Ô∏è Êú¨Âë®Êó†ËææÊ†áË∑ëÂèã</h3>
                    <p>ÁΩöÊ¨æÊÄªÈ¢ùÔºö${totalPenalties}ÂÖÉÂ∞ÜÁ¥ØÁßØÂà∞‰∏ãÂë®</p>
                `;
            } else {
                penaltyContainer.innerHTML = `
                    <h3>üéâ Êú¨Âë®ÂÖ®ÂëòËææÊ†áÔºÅ</h3>
                    <p>ÊâÄÊúâË∑ëÂèãÈÉΩÂÆåÊàê‰∫ÜÊú¨Âë®ÁõÆÊ†áÔºåÂ§™Ê£í‰∫ÜÔºÅ</p>
                `;
            }
        }

        // ÂØºÂá∫Êï∞ÊçÆ
        function exportData() {
            const data = {
                runners: runners,
                records: records,
                exportDate: new Date().toISOString(),
                version: '1.0',
                appName: 'Ë∑ëÊ≠•ËÆ∞ÂΩïÁÆ°ÁêÜÁ≥ªÁªü'
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Ë∑ëÊ≠•Êï∞ÊçÆ_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            alert('Êï∞ÊçÆÂØºÂá∫ÊàêÂäüÔºÅÊñá‰ª∂Â∑≤‰øùÂ≠òÂà∞‰∏ãËΩΩÊñá‰ª∂Â§π„ÄÇ');
        }

        // ÂØºÂÖ•Êï∞ÊçÆ
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        // È™åËØÅÊï∞ÊçÆÊ†ºÂºè
                        if (!data.runners || !data.records) {
                            alert('Êï∞ÊçÆÊ†ºÂºèÈîôËØØÔºÅËØ∑Á°Æ‰øùÂØºÂÖ•ÁöÑÊòØÊúâÊïàÁöÑË∑ëÊ≠•Êï∞ÊçÆÊñá‰ª∂„ÄÇ');
                            return;
                        }
                        
                        // Á°ÆËÆ§ÂØºÂÖ•
                        const confirmMsg = `Á°ÆÂÆöË¶ÅÂØºÂÖ•Êï∞ÊçÆÂêóÔºü\n\n` +
                                         `Ë∑ëÂèãÊï∞ÈáèÔºö${data.runners.length} ‰∫∫\n` +
                                         `ËÆ∞ÂΩïÊï∞ÈáèÔºö${data.records.length} Êù°\n` +
                                         `ÂØºÂá∫Êó∂Èó¥Ôºö${data.exportDate ? new Date(data.exportDate).toLocaleString() : 'Êú™Áü•'}\n\n` +
                                         `‚ö†Ô∏è ÂØºÂÖ•Â∞ÜË¶ÜÁõñÁé∞ÊúâÊï∞ÊçÆÔºåËØ∑Ë∞®ÊÖéÊìç‰ΩúÔºÅ`;
                        
                        if (confirm(confirmMsg)) {
                            // Â§á‰ªΩÂΩìÂâçÊï∞ÊçÆ
                            const backup = {
                                runners: runners,
                                records: records,
                                backupDate: new Date().toISOString()
                            };
                            localStorage.setItem('runningDataBackup', JSON.stringify(backup));
                            
                            // ÂØºÂÖ•Êñ∞Êï∞ÊçÆ
                            runners = data.runners;
                            records = data.records;
                            
                            // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
                            localStorage.setItem('runners', JSON.stringify(runners));
                            localStorage.setItem('runningRecords', JSON.stringify(records));
                            
                            // Êõ¥Êñ∞ÁïåÈù¢
                            updateRunnerSelect();
                            updateRunnerList();
                            updateRecordsTable();
                            updateSummaryStats();
                            updateWeekHistory();
                            
                            alert('Êï∞ÊçÆÂØºÂÖ•ÊàêÂäüÔºÅÂ∑≤Ëá™Âä®Â§á‰ªΩÂéüÊúâÊï∞ÊçÆ„ÄÇ');
                        }
                    } catch (error) {
                        alert('Êñá‰ª∂Ëß£ÊûêÂ§±Ë¥•ÔºÅËØ∑Ê£ÄÊü•Êñá‰ª∂Ê†ºÂºèÊòØÂê¶Ê≠£Á°Æ„ÄÇ\nÈîôËØØ‰ø°ÊÅØÔºö' + error.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // ÊÅ¢Â§çÂ§á‰ªΩÊï∞ÊçÆ
        function restoreBackup() {
            const backup = localStorage.getItem('runningDataBackup');
            if (!backup) {
                alert('Ê≤°ÊúâÊâæÂà∞Â§á‰ªΩÊï∞ÊçÆÔºÅ');
                return;
            }
            
            try {
                const data = JSON.parse(backup);
                if (confirm('Á°ÆÂÆöË¶ÅÊÅ¢Â§çÂ§á‰ªΩÊï∞ÊçÆÂêóÔºüÂΩìÂâçÊï∞ÊçÆÂ∞ÜË¢´Ë¶ÜÁõñ„ÄÇ')) {
                    runners = data.runners;
                    records = data.records;
                    
                    localStorage.setItem('runners', JSON.stringify(runners));
                    localStorage.setItem('runningRecords', JSON.stringify(records));
                    
                    updateRunnerSelect();
                    updateRunnerList();
                    updateRecordsTable();
                    updateSummaryStats();
                    updateWeekHistory();
                    
                    alert('Â§á‰ªΩÊï∞ÊçÆÊÅ¢Â§çÊàêÂäüÔºÅ');
                }
            } catch (error) {
                alert('Â§á‰ªΩÊï∞ÊçÆÊÅ¢Â§çÂ§±Ë¥•Ôºö' + error.message);
            }
        }

        // GitHub Gist ‰∫ëÁ´ØÂêåÊ≠•ÂäüËÉΩ
        class CloudSync {
            constructor() {
                this.gistId = localStorage.getItem('runningGistId');
                this.githubToken = localStorage.getItem('githubToken');
            }
            
            // ËÆæÁΩÆGitHub Token
            setGithubToken(token) {
                this.githubToken = token;
                localStorage.setItem('githubToken', token);
            }
            
            // ËÆæÁΩÆGist ID
            setGistId(id) {
                this.gistId = id;
                localStorage.setItem('runningGistId', id);
            }
            
            // ÂàõÂª∫Êñ∞ÁöÑGist
            async createGist() {
                if (!this.githubToken) {
                    throw new Error('ËØ∑ÂÖàËÆæÁΩÆGitHub Token');
                }
                
                const data = {
                    description: 'Ë∑ëÊ≠•ËÆ∞ÂΩïÊï∞ÊçÆÂêåÊ≠•',
                    public: false,
                    files: {
                        'running_data.json': {
                            content: JSON.stringify(this.getCurrentData(), null, 2)
                        }
                    }
                };
                
                const response = await fetch('https://api.github.com/gists', {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${this.githubToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) {
                    throw new Error(`ÂàõÂª∫GistÂ§±Ë¥•: ${response.status}`);
                }
                
                const result = await response.json();
                this.setGistId(result.id);
                return result.id;
            }
            
            // Êõ¥Êñ∞Áé∞ÊúâÁöÑGist
            async updateGist() {
                if (!this.githubToken || !this.gistId) {
                    throw new Error('ËØ∑ÂÖàËÆæÁΩÆGitHub TokenÂíåGist ID');
                }
                
                const data = {
                    description: 'Ë∑ëÊ≠•ËÆ∞ÂΩïÊï∞ÊçÆÂêåÊ≠•',
                    files: {
                        'running_data.json': {
                            content: JSON.stringify(this.getCurrentData(), null, 2)
                        }
                    }
                };
                
                const response = await fetch(`https://api.github.com/gists/${this.gistId}`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `token ${this.githubToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) {
                    throw new Error(`Êõ¥Êñ∞GistÂ§±Ë¥•: ${response.status}`);
                }
                
                return await response.json();
            }
            
            // ‰ªéGistËé∑ÂèñÊï∞ÊçÆ
            async fetchFromGist() {
                if (!this.gistId) {
                    throw new Error('ËØ∑ÂÖàËÆæÁΩÆGist ID');
                }
                
                const response = await fetch(`https://api.github.com/gists/${this.gistId}`);
                if (!response.ok) {
                    throw new Error(`Ëé∑ÂèñGistÂ§±Ë¥•: ${response.status}`);
                }
                
                const result = await response.json();
                const fileContent = result.files['running_data.json']?.content;
                
                if (!fileContent) {
                    throw new Error('Gist‰∏≠Ê≤°ÊúâÊâæÂà∞Êï∞ÊçÆÊñá‰ª∂');
                }
                
                return JSON.parse(fileContent);
            }
            
            // Ëé∑ÂèñÂΩìÂâçÊú¨Âú∞Êï∞ÊçÆ
            getCurrentData() {
                return {
                    runners: runners,
                    records: records,
                    lastSync: new Date().toISOString(),
                    version: '1.0'
                };
            }
            
            // ÂêåÊ≠•Âà∞‰∫ëÁ´Ø
            async syncToCloud() {
                try {
                    if (!this.githubToken) {
                        throw new Error('ËØ∑ÂÖàËÆæÁΩÆGitHub Token');
                    }
                    
                    // Ëé∑ÂèñÂΩìÂâçÊï∞ÊçÆÂπ∂Ê∑ªÂä†ÁâàÊú¨‰ø°ÊÅØ
                    const currentData = this.getCurrentData();
                    currentData.version = versionManager.saveVersion();
                    
                    if (!this.gistId) {
                        await this.createGist(currentData);
                    } else {
                        await this.updateGist(this.gistId, currentData);
                    }
                    
                    localStorage.setItem('lastSyncTime', new Date().toISOString());
                    return true;
                } catch (error) {
                    console.error('ÂêåÊ≠•Âà∞‰∫ëÁ´ØÂ§±Ë¥•:', error);
                    throw error;
                }
            }
            
            // ‰ªé‰∫ëÁ´ØÂêåÊ≠•ÔºàÂ∏¶ÂÜ≤Á™ÅÊ£ÄÊµãÔºâ
            async syncFromCloud() {
                try {
                    const cloudData = await this.fetchFromGist();
                    
                    // Êï∞ÊçÆÈ™åËØÅ
                    if (!cloudData.runners || !cloudData.records) {
                        throw new Error('‰∫ëÁ´ØÊï∞ÊçÆÊ†ºÂºèÈîôËØØ');
                    }
                    
                    const localData = this.getCurrentData();
                    
                    // Ê£ÄÊµãÊï∞ÊçÆÂÜ≤Á™Å
                    const conflictResult = versionManager.detectConflict(localData, cloudData);
                    
                    if (conflictResult.hasConflict) {
                        console.log('Ê£ÄÊµãÂà∞Êï∞ÊçÆÂÜ≤Á™Å:', conflictResult);
                        
                        // ËøîÂõûÂÜ≤Á™Å‰ø°ÊÅØÔºåËÆ©Ë∞ÉÁî®ËÄÖÂ§ÑÁêÜ
                        return {
                            hasConflict: true,
                            conflictInfo: conflictResult,
                            cloudData: cloudData,
                            localData: localData
                        };
                    }
                    
                    // Êó†ÂÜ≤Á™ÅÔºåÁõ¥Êé•ËøîÂõû‰∫ëÁ´ØÊï∞ÊçÆ
                    return {
                        hasConflict: false,
                        cloudData: cloudData
                    };
                } catch (error) {
                    console.error('‰ªé‰∫ëÁ´ØÂêåÊ≠•Â§±Ë¥•:', error);
                    throw error;
                }
            }
        }
        
        // ÂàõÂª∫‰∫ëÁ´ØÂêåÊ≠•ÂÆû‰æã
        const cloudSync = new CloudSync();

        // Ëá™Âä®ÂêåÊ≠•ÁÆ°ÁêÜÂô®
        class AutoSyncManager {
            constructor(cloudSync) {
                this.cloudSync = cloudSync;
                this.syncInterval = null;
                this.lastSyncTime = localStorage.getItem('lastSyncTime');
                this.syncEnabled = localStorage.getItem('autoSyncEnabled') === 'true';
                this.syncFrequency = parseInt(localStorage.getItem('syncFrequency') || '5'); // ÈªòËÆ§5ÂàÜÈíü
            }

            // ÂêØÂä®Ëá™Âä®ÂêåÊ≠•
            startAutoSync() {
                if (!this.syncEnabled) {
                    console.log('Ëá™Âä®ÂêåÊ≠•Â∑≤Á¶ÅÁî®');
                    return;
                }

                if (!this.cloudSync.githubToken || !this.cloudSync.gistId) {
                    console.log('‰∫ëÁ´ØÂêåÊ≠•Êú™ÈÖçÁΩÆÔºåÊó†Ê≥ïÂêØÂä®Ëá™Âä®ÂêåÊ≠•');
                    return;
                }

                console.log(`ÂêØÂä®Ëá™Âä®ÂêåÊ≠•ÔºåÊØè${this.syncFrequency}ÂàÜÈíüÂêåÊ≠•‰∏ÄÊ¨°`);
                
                // Á´ãÂç≥ÊâßË°å‰∏ÄÊ¨°ÂêåÊ≠•
                this.performAutoSync();

                // ËÆæÁΩÆÂÆöÊó∂ÂêåÊ≠•
                this.syncInterval = setInterval(() => {
                    this.performAutoSync();
                }, this.syncFrequency * 60 * 1000);
            }

            // ÂÅúÊ≠¢Ëá™Âä®ÂêåÊ≠•
            stopAutoSync() {
                if (this.syncInterval) {
                    clearInterval(this.syncInterval);
                    this.syncInterval = null;
                    console.log('Ëá™Âä®ÂêåÊ≠•Â∑≤ÂÅúÊ≠¢');
                }
            }

            // ÊâßË°åËá™Âä®ÂêåÊ≠•ÔºàÂ∏¶ÂÜ≤Á™ÅÊ£ÄÊµãÔºâ
            async performAutoSync() {
                try {
                    console.log('ÂºÄÂßãËá™Âä®ÂêåÊ≠•...');
                    
                    // Ëé∑Âèñ‰∫ëÁ´ØÊï∞ÊçÆÂπ∂Ê£ÄÊµãÂÜ≤Á™Å
                    const syncResult = await this.cloudSync.syncFromCloud();
                    
                    if (syncResult.hasConflict) {
                        console.log('Ëá™Âä®ÂêåÊ≠•Ê£ÄÊµãÂà∞Êï∞ÊçÆÂÜ≤Á™Å');
                        
                        // Ëá™Âä®‰ΩøÁî®Êô∫ËÉΩÂêàÂπ∂Á≠ñÁï•Ëß£ÂÜ≥ÂÜ≤Á™Å
                        const resolvedData = versionManager.resolveConflict(syncResult.localData, syncResult.cloudData, 'merge');
                        
                        // Â§á‰ªΩÊú¨Âú∞Êï∞ÊçÆ
                        const backup = {
                            runners: runners,
                            records: records,
                            backupDate: new Date().toISOString()
                        };
                        localStorage.setItem('runningDataBackup', JSON.stringify(backup));
                        
                        // Êõ¥Êñ∞Êú¨Âú∞Êï∞ÊçÆ
                        runners = resolvedData.runners;
                        records = resolvedData.records;
                        
                        // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
                        localStorage.setItem('runners', JSON.stringify(runners));
                        localStorage.setItem('runningRecords', JSON.stringify(records));
                        
                        // Êõ¥Êñ∞ÁïåÈù¢
                        updateRunnerSelect();
                        updateRunnerList();
                        updateRecordsTable();
                        updateSummaryStats();
                        updateWeekHistory();
                        
                        console.log('Ëá™Âä®ÂêåÊ≠•ÂÆåÊàêÔºöÊï∞ÊçÆÂÜ≤Á™ÅÂ∑≤Êô∫ËÉΩÂêàÂπ∂');
                        
                        // ÊòæÁ§∫ÂêåÊ≠•ÊàêÂäüÊèêÁ§∫
                        this.showSyncNotification('Êï∞ÊçÆÂ∑≤Ëá™Âä®ÂêåÊ≠•Êõ¥Êñ∞ÔºàÊô∫ËÉΩÂêàÂπ∂Ôºâ', 'success');
                    } else if (syncResult.cloudData) {
                        // Êó†ÂÜ≤Á™ÅÔºåÊ£ÄÊü•ÊòØÂê¶ÈúÄË¶ÅÂêåÊ≠•
                        const cloudData = syncResult.cloudData;
                        const localData = this.cloudSync.getCurrentData();
                        const localTimestamp = new Date(localData.lastSync || 0).getTime();
                        const cloudTimestamp = new Date(cloudData.lastSync || 0).getTime();

                        // Â¶ÇÊûú‰∫ëÁ´ØÊï∞ÊçÆÊõ¥Êñ∞ÔºåÂàôÂêåÊ≠•Âà∞Êú¨Âú∞
                        if (cloudTimestamp > localTimestamp) {
                            console.log('Ê£ÄÊµãÂà∞‰∫ëÁ´ØÊï∞ÊçÆÊõ¥Êñ∞ÔºåÊ≠£Âú®ÂêåÊ≠•Âà∞Êú¨Âú∞...');
                            
                            // Â§á‰ªΩÊú¨Âú∞Êï∞ÊçÆ
                            const backup = {
                                runners: runners,
                                records: records,
                                backupDate: new Date().toISOString()
                            };
                            localStorage.setItem('runningDataBackup', JSON.stringify(backup));
                            
                            // Êõ¥Êñ∞Êú¨Âú∞Êï∞ÊçÆ
                            runners = cloudData.runners;
                            records = cloudData.records;
                            
                            // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
                            localStorage.setItem('runners', JSON.stringify(runners));
                            localStorage.setItem('runningRecords', JSON.stringify(records));
                            
                            // Êõ¥Êñ∞ÁïåÈù¢
                            updateRunnerSelect();
                            updateRunnerList();
                            updateRecordsTable();
                            updateSummaryStats();
                            updateWeekHistory();
                            
                            console.log('Ëá™Âä®ÂêåÊ≠•ÂÆåÊàêÔºö‰∫ëÁ´ØÊï∞ÊçÆÂ∑≤ÂêåÊ≠•Âà∞Êú¨Âú∞');
                            
                            // ÊòæÁ§∫ÂêåÊ≠•ÊàêÂäüÊèêÁ§∫
                            this.showSyncNotification('Êï∞ÊçÆÂ∑≤Ëá™Âä®ÂêåÊ≠•Êõ¥Êñ∞', 'success');
                        } else {
                            console.log('Êú¨Âú∞Êï∞ÊçÆ‰∏∫ÊúÄÊñ∞ÔºåÊó†ÈúÄÂêåÊ≠•');
                        }
                    } else {
                        console.log('‰∫ëÁ´ØÊ≤°ÊúâÊï∞ÊçÆÔºåË∑≥ËøáÂêåÊ≠•');
                    }
                    
                    // Êõ¥Êñ∞ÊúÄÂêéÂêåÊ≠•Êó∂Èó¥
                    localStorage.setItem('lastSyncTime', new Date().toISOString());
                    
                } catch (error) {
                    console.error('Ëá™Âä®ÂêåÊ≠•Â§±Ë¥•:', error);
                    this.showSyncNotification('Ëá™Âä®ÂêåÊ≠•Â§±Ë¥•', 'error');
                }
            }

            // ÊòæÁ§∫ÂêåÊ≠•ÈÄöÁü•
            showSyncNotification(message, type = 'info') {
                // ÂàõÂª∫ÈÄöÁü•ÂÖÉÁ¥†
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 15px 20px;
                    border-radius: 8px;
                    color: white;
                    font-size: 14px;
                    z-index: 10000;
                    opacity: 0;
                    transition: opacity 0.3s ease;
                    background: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#17a2b8'};
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                `;
                notification.textContent = message;

                document.body.appendChild(notification);

                // ÊòæÁ§∫Âä®Áîª
                setTimeout(() => {
                    notification.style.opacity = '1';
                }, 100);

                // Ëá™Âä®ÈöêËóè
                setTimeout(() => {
                    notification.style.opacity = '0';
                    setTimeout(() => {
                        document.body.removeChild(notification);
                    }, 300);
                }, 3000);
            }

            // ÂêØÁî®Ëá™Âä®ÂêåÊ≠•
            enableAutoSync() {
                this.syncEnabled = true;
                localStorage.setItem('autoSyncEnabled', 'true');
                this.startAutoSync();
                this.showSyncNotification('Ëá™Âä®ÂêåÊ≠•Â∑≤ÂêØÁî®', 'success');
            }

            // Á¶ÅÁî®Ëá™Âä®ÂêåÊ≠•
            disableAutoSync() {
                this.syncEnabled = false;
                localStorage.setItem('autoSyncEnabled', 'false');
                this.stopAutoSync();
                this.showSyncNotification('Ëá™Âä®ÂêåÊ≠•Â∑≤Á¶ÅÁî®', 'info');
            }

            // ËÆæÁΩÆÂêåÊ≠•È¢ëÁéá
            setSyncFrequency(minutes) {
                this.syncFrequency = minutes;
                localStorage.setItem('syncFrequency', minutes.toString());
                
                // Â¶ÇÊûúËá™Âä®ÂêåÊ≠•Ê≠£Âú®ËøêË°åÔºåÈáçÂêØ‰ª•Â∫îÁî®Êñ∞È¢ëÁéá
                if (this.syncEnabled) {
                    this.stopAutoSync();
                    this.startAutoSync();
                }
            }

            // Ëé∑ÂèñÂêåÊ≠•Áä∂ÊÄÅ
            getSyncStatus() {
                return {
                    enabled: this.syncEnabled,
                    frequency: this.syncFrequency,
                    lastSync: this.lastSyncTime,
                    isRunning: this.syncInterval !== null,
                    hasValidConfig: !!(this.cloudSync.githubToken && this.cloudSync.gistId)
                };
            }
        }

        // ÂàõÂª∫Ëá™Âä®ÂêåÊ≠•ÁÆ°ÁêÜÂô®ÂÆû‰æã
        const autoSyncManager = new AutoSyncManager(cloudSync);

        // Êï∞ÊçÆÁâàÊú¨ÊéßÂà∂ÂíåÂÜ≤Á™ÅËß£ÂÜ≥ÁÆ°ÁêÜÂô®
        class DataVersionManager {
            constructor() {
                this.versionKey = 'dataVersion';
                this.conflictResolutionKey = 'conflictResolution';
                this.defaultResolution = 'merge'; // merge, local, cloud
            }

            // ÁîüÊàêÊï∞ÊçÆÁâàÊú¨Âè∑
            generateVersion() {
                return {
                    version: Date.now(),
                    timestamp: new Date().toISOString(),
                    runnersCount: runners.length,
                    recordsCount: records.length
                };
            }

            // Ëé∑ÂèñÂΩìÂâçÁâàÊú¨‰ø°ÊÅØ
            getCurrentVersion() {
                const version = localStorage.getItem(this.versionKey);
                return version ? JSON.parse(version) : this.generateVersion();
            }

            // ‰øùÂ≠òÁâàÊú¨‰ø°ÊÅØ
            saveVersion() {
                const version = this.generateVersion();
                localStorage.setItem(this.versionKey, JSON.stringify(version));
                return version;
            }

            // Ê£ÄÊµãÊï∞ÊçÆÂÜ≤Á™Å
            detectConflict(localData, cloudData) {
                if (!localData.version || !cloudData.version) {
                    return { hasConflict: false, reason: 'missing_version' };
                }

                const localVersion = localData.version;
                const cloudVersion = cloudData.version;

                // Ê£ÄÊü•ÁâàÊú¨Âè∑ÂíåÊó∂Èó¥Êà≥
                if (localVersion.version === cloudVersion.version) {
                    return { hasConflict: false, reason: 'same_version' };
                }

                // Ê£ÄÊü•Êï∞ÊçÆÂ∑ÆÂºÇ
                const localTimestamp = new Date(localVersion.timestamp).getTime();
                const cloudTimestamp = new Date(cloudVersion.timestamp).getTime();

                // Â¶ÇÊûúÊó∂Èó¥Êà≥Áõ∏Â∑ÆÂ∞è‰∫é1ÂàÜÈíüÔºåËÆ§‰∏∫Ê≤°ÊúâÂÜ≤Á™Å
                if (Math.abs(localTimestamp - cloudTimestamp) < 60000) {
                    return { hasConflict: false, reason: 'recent_sync' };
                }

                // Ê£ÄÊü•Êï∞ÊçÆÂÜÖÂÆπÂ∑ÆÂºÇ
                const localRunnersChanged = localData.runners.length !== localVersion.runnersCount;
                const localRecordsChanged = localData.records.length !== localVersion.recordsCount;
                const cloudRunnersChanged = cloudData.runners.length !== cloudVersion.runnersCount;
                const cloudRecordsChanged = cloudData.records.length !== cloudVersion.recordsCount;

                const hasConflict = (localRunnersChanged || localRecordsChanged) && (cloudRunnersChanged || cloudRecordsChanged);

                return {
                    hasConflict,
                    reason: hasConflict ? 'both_modified' : 'single_modified',
                    details: {
                        localModified: localRunnersChanged || localRecordsChanged,
                        cloudModified: cloudRunnersChanged || cloudRecordsChanged,
                        localChanges: {
                            runners: localData.runners.length - localVersion.runnersCount,
                            records: localData.records.length - localVersion.recordsCount
                        },
                        cloudChanges: {
                            runners: cloudData.runners.length - cloudVersion.runnersCount,
                            records: cloudData.records.length - cloudVersion.recordsCount
                        }
                    }
                };
            }

            // ÂêàÂπ∂Êï∞ÊçÆÔºàÊô∫ËÉΩÂêàÂπ∂Á≠ñÁï•Ôºâ
            mergeData(localData, cloudData) {
                console.log('ÂºÄÂßãÊô∫ËÉΩÊï∞ÊçÆÂêàÂπ∂...');
                
                // ÂàõÂª∫ÂêàÂπ∂ÁªìÊûú
                const mergedData = {
                    runners: [],
                    records: [],
                    version: this.generateVersion(),
                    mergeLog: []
                };

                // ÂêàÂπ∂Ë∑ëÂèãÊï∞ÊçÆ
                const runnerMap = new Map();
                
                // Ê∑ªÂä†Êú¨Âú∞Ë∑ëÂèã
                localData.runners.forEach(runner => {
                    runnerMap.set(runner.id, { ...runner, source: 'local' });
                });

                // ÂêàÂπ∂‰∫ëÁ´ØË∑ëÂèãÔºàÂ§ÑÁêÜÂÜ≤Á™ÅÔºâ
                cloudData.runners.forEach(cloudRunner => {
                    const existingRunner = runnerMap.get(cloudRunner.id);
                    
                    if (existingRunner) {
                        // Ë∑ëÂèãÂ∑≤Â≠òÂú®ÔºåÊØîËæÉ‰øÆÊîπÊó∂Èó¥
                        const localTime = new Date(existingRunner.updatedAt || existingRunner.createdAt).getTime();
                        const cloudTime = new Date(cloudRunner.updatedAt || cloudRunner.createdAt).getTime();
                        
                        if (cloudTime > localTime) {
                            // ‰∫ëÁ´ØÊï∞ÊçÆÊõ¥Êñ∞Ôºå‰ΩøÁî®‰∫ëÁ´ØÊï∞ÊçÆ
                            runnerMap.set(cloudRunner.id, { ...cloudRunner, source: 'cloud' });
                            mergedData.mergeLog.push(`Ë∑ëÂèã "${cloudRunner.name}" ‰ΩøÁî®‰∫ëÁ´ØÊï∞ÊçÆÔºà‰∫ëÁ´ØÊõ¥Êñ∞Ôºâ`);
                        } else {
                            // Êú¨Âú∞Êï∞ÊçÆÊõ¥Êñ∞Ôºå‰øùÁïôÊú¨Âú∞Êï∞ÊçÆ
                            mergedData.mergeLog.push(`Ë∑ëÂèã "${existingRunner.name}" ‰øùÁïôÊú¨Âú∞Êï∞ÊçÆÔºàÊú¨Âú∞Êõ¥Êñ∞Ôºâ`);
                        }
                    } else {
                        // Êñ∞Ë∑ëÂèãÔºåÊ∑ªÂä†Âà∞ÂêàÂπ∂ÁªìÊûú
                        runnerMap.set(cloudRunner.id, { ...cloudRunner, source: 'cloud' });
                        mergedData.mergeLog.push(`Ê∑ªÂä†Êñ∞Ë∑ëÂèã "${cloudRunner.name}"`);
                    }
                });

                mergedData.runners = Array.from(runnerMap.values());

                // ÂêàÂπ∂Ë∑ëÊ≠•ËÆ∞ÂΩï
                const recordMap = new Map();
                
                // Ê∑ªÂä†Êú¨Âú∞ËÆ∞ÂΩï
                localData.records.forEach(record => {
                    const key = `${record.runnerId}_${record.date}_${record.distance}`;
                    recordMap.set(key, { ...record, source: 'local' });
                });

                // ÂêàÂπ∂‰∫ëÁ´ØËÆ∞ÂΩï
                cloudData.records.forEach(cloudRecord => {
                    const key = `${cloudRecord.runnerId}_${cloudRecord.date}_${cloudRecord.distance}`;
                    const existingRecord = recordMap.get(key);
                    
                    if (!existingRecord) {
                        // Êñ∞ËÆ∞ÂΩïÔºåÊ∑ªÂä†Âà∞ÂêàÂπ∂ÁªìÊûú
                        recordMap.set(key, { ...cloudRecord, source: 'cloud' });
                        mergedData.mergeLog.push(`Ê∑ªÂä†Êñ∞Ë∑ëÊ≠•ËÆ∞ÂΩïÔºö${cloudRecord.distance}km`);
                    }
                });

                mergedData.records = Array.from(recordMap.values());

                console.log('Êï∞ÊçÆÂêàÂπ∂ÂÆåÊàêÔºö', mergedData.mergeLog);
                return mergedData;
            }

            // Ëß£ÂÜ≥ÂÜ≤Á™Å
            resolveConflict(localData, cloudData, resolution = null) {
                resolution = resolution || localStorage.getItem(this.conflictResolutionKey) || this.defaultResolution;

                console.log(`‰ΩøÁî®ÂÜ≤Á™ÅËß£ÂÜ≥Á≠ñÁï•: ${resolution}`);

                switch (resolution) {
                    case 'merge':
                        return this.mergeData(localData, cloudData);
                    
                    case 'local':
                        return {
                            ...localData,
                            version: this.generateVersion(),
                            mergeLog: ['‰ΩøÁî®Êú¨Âú∞Êï∞ÊçÆÔºàÂÜ≤Á™ÅËß£ÂÜ≥Á≠ñÁï•Ôºâ']
                        };
                    
                    case 'cloud':
                        return {
                            ...cloudData,
                            version: this.generateVersion(),
                            mergeLog: ['‰ΩøÁî®‰∫ëÁ´ØÊï∞ÊçÆÔºàÂÜ≤Á™ÅËß£ÂÜ≥Á≠ñÁï•Ôºâ']
                        };
                    
                    default:
                        return this.mergeData(localData, cloudData);
                }
            }

            // ÊòæÁ§∫ÂÜ≤Á™ÅËß£ÂÜ≥ÂØπËØùÊ°Ü
            showConflictResolutionDialog(conflictInfo, onResolve) {
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.5);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 2000;
                `;

                const modalContent = document.createElement('div');
                modalContent.style.cssText = `
                    background: white;
                    padding: 30px;
                    border-radius: 15px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    text-align: center;
                    min-width: 400px;
                    max-width: 500px;
                `;

                const { details } = conflictInfo;
                
                modalContent.innerHTML = `
                    <h3 style="margin-bottom: 20px; color: #dc3545;">‚ö†Ô∏è Ê£ÄÊµãÂà∞Êï∞ÊçÆÂÜ≤Á™Å</h3>
                    <div style="text-align: left; margin-bottom: 20px;">
                        <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
                            Êú¨Âú∞Âíå‰∫ëÁ´ØÊï∞ÊçÆÈÉΩÊúâÊõ¥Êñ∞ÔºåÈúÄË¶ÅÈÄâÊã©ÂÜ≤Á™ÅËß£ÂÜ≥ÊñπÂºèÔºö
                        </p>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h5 style="margin-bottom: 10px;">Êï∞ÊçÆÂèòÂåñÂØπÊØîÔºö</h5>
                            <div style="display: flex; justify-content: space-between;">
                                <div style="text-align: center;">
                                    <strong>Êú¨Âú∞Êï∞ÊçÆ</strong><br>
                                    <small>Ë∑ëÂèã: ${details.localChanges.runners > 0 ? '+' : ''}${details.localChanges.runners}<br>
                                    ËÆ∞ÂΩï: ${details.localChanges.records > 0 ? '+' : ''}${details.localChanges.records}</small>
                                </div>
                                <div style="text-align: center;">
                                    <strong>‰∫ëÁ´ØÊï∞ÊçÆ</strong><br>
                                    <small>Ë∑ëÂèã: ${details.cloudChanges.runners > 0 ? '+' : ''}${details.cloudChanges.runners}<br>
                                    ËÆ∞ÂΩï: ${details.cloudChanges.records > 0 ? '+' : ''}${details.cloudChanges.records}</small>
                                </div>
                            </div>
                        </div>
                        <div style="font-size: 12px; color: #999;">
                            <strong>Êô∫ËÉΩÂêàÂπ∂</strong>ÔºöËá™Âä®ÂêàÂπ∂Êï∞ÊçÆÔºå‰øùÁïôÊúÄÊñ∞ÁöÑ‰øÆÊîπ<br>
                            <strong>‰ΩøÁî®Êú¨Âú∞Êï∞ÊçÆ</strong>ÔºöÂÆåÂÖ®Ë¶ÜÁõñ‰∫ëÁ´ØÊï∞ÊçÆ<br>
                            <strong>‰ΩøÁî®‰∫ëÁ´ØÊï∞ÊçÆ</strong>ÔºöÂÆåÂÖ®Ë¶ÜÁõñÊú¨Âú∞Êï∞ÊçÆ
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="resolveConflict('merge')">üîÑ Êô∫ËÉΩÂêàÂπ∂</button>
                        <button class="btn btn-warning" onclick="resolveConflict('local')">üíæ ‰ΩøÁî®Êú¨Âú∞Êï∞ÊçÆ</button>
                        <button class="btn btn-info" onclick="resolveConflict('cloud')">‚òÅÔ∏è ‰ΩøÁî®‰∫ëÁ´ØÊï∞ÊçÆ</button>
                        <button class="btn btn-secondary" onclick="cancelConflictResolution()">ÂèñÊ∂à</button>
                    </div>
                `;

                modal.appendChild(modalContent);
                document.body.appendChild(modal);

                // ÂÜ≤Á™ÅËß£ÂÜ≥ÂáΩÊï∞
                window.resolveConflict = function(resolution) {
                    localStorage.setItem('conflictResolution', resolution);
                    document.body.removeChild(modal);
                    delete window.resolveConflict;
                    delete window.cancelConflictResolution;
                    onResolve(resolution);
                };

                // ÂèñÊ∂àÂÜ≤Á™ÅËß£ÂÜ≥ÂáΩÊï∞
                window.cancelConflictResolution = function() {
                    document.body.removeChild(modal);
                    delete window.resolveConflict;
                    delete window.cancelConflictResolution;
                };
            }
        }

        // ÂàõÂª∫Êï∞ÊçÆÁâàÊú¨ÁÆ°ÁêÜÂô®ÂÆû‰æã
        const versionManager = new DataVersionManager();

        // ÊòæÁ§∫‰∫ëÁ´ØÂêåÊ≠•ÈÖçÁΩÆÊ®°ÊÄÅÊ°Ü
        function showCloudSyncModal() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;

            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white;
                padding: 30px;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                text-align: center;
                min-width: 400px;
                max-width: 500px;
            `;

            const currentToken = localStorage.getItem('githubToken') || '';
            const currentGistId = localStorage.getItem('runningGistId') || '';
            const lastSync = localStorage.getItem('lastSyncTime');
            const lastSyncText = lastSync ? new Date(lastSync).toLocaleString() : '‰ªéÊú™ÂêåÊ≠•';

            const syncStatus = autoSyncManager.getSyncStatus();
            const autoSyncEnabled = syncStatus.enabled;
            const syncFrequency = syncStatus.frequency;

            modalContent.innerHTML = `
                <h3 style="margin-bottom: 20px; color: #333;">‚òÅÔ∏è ‰∫ëÁ´ØÂêåÊ≠•ÈÖçÁΩÆ</h3>
                <div style="text-align: left; margin-bottom: 20px;">
                    <p style="color: #666; font-size: 14px; margin-bottom: 15px;">
                        ‰ΩøÁî®GitHub GistËøõË°åÊï∞ÊçÆÂêåÊ≠•ÔºåÈúÄË¶ÅÂú®GitHubËÆæÁΩÆ‰∏≠ÂàõÂª∫Personal Access Token„ÄÇ
                    </p>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">GitHub Token:</label>
                        <input type="password" id="githubToken" placeholder="ËæìÂÖ•GitHub Personal Access Token" 
                               value="${currentToken}" 
                               style="width: 100%; padding: 12px; border: 2px solid #ddd; 
                                      border-radius: 8px; font-size: 14px;">
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Gist ID (ÂèØÈÄâ):</label>
                        <input type="text" id="gistId" placeholder="ÁïôÁ©∫Â∞ÜÂàõÂª∫Êñ∞ÁöÑGist" 
                               value="${currentGistId}" 
                               style="width: 100%; padding: 12px; border: 2px solid #ddd; 
                                      border-radius: 8px; font-size: 14px;">
                    </div>
                    <div style="margin-bottom: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #dee2e6;">
                        <h5 style="margin-bottom: 10px; color: #495057;">üîÑ Ëá™Âä®ÂêåÊ≠•ËÆæÁΩÆ</h5>
                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                            <input type="checkbox" id="autoSyncEnabled" ${autoSyncEnabled ? 'checked' : ''} 
                                   style="margin-right: 8px; transform: scale(1.2);">
                            <label for="autoSyncEnabled" style="margin: 0; font-weight: normal;">ÂêØÁî®Ëá™Âä®ÂêåÊ≠•</label>
                        </div>
                        <div style="display: flex; align-items: center;">
                            <label style="margin-right: 10px; font-weight: normal;">ÂêåÊ≠•È¢ëÁéá:</label>
                            <select id="syncFrequency" style="padding: 5px 10px; border: 1px solid #ddd; border-radius: 4px;">
                                <option value="1" ${syncFrequency === 1 ? 'selected' : ''}>1ÂàÜÈíü</option>
                                <option value="5" ${syncFrequency === 5 ? 'selected' : ''}>5ÂàÜÈíü</option>
                                <option value="10" ${syncFrequency === 10 ? 'selected' : ''}>10ÂàÜÈíü</option>
                                <option value="30" ${syncFrequency === 30 ? 'selected' : ''}>30ÂàÜÈíü</option>
                            </select>
                        </div>
                    </div>
                    <div style="margin-bottom: 20px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        <small style="color: #666;">
                            <strong>ÊúÄÂêéÂêåÊ≠•:</strong> ${lastSyncText}<br>
                            <strong>Ë∑ëÂèãÊï∞Èáè:</strong> ${runners.length} | <strong>ËÆ∞ÂΩïÊï∞Èáè:</strong> ${records.length}<br>
                            <strong>Ëá™Âä®ÂêåÊ≠•:</strong> ${autoSyncEnabled ? 'Â∑≤ÂêØÁî®' : 'Â∑≤Á¶ÅÁî®'} | 
                            <strong>ÂêåÊ≠•È¢ëÁéá:</strong> ${syncFrequency}ÂàÜÈíü
                        </small>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                    <button class="btn btn-success" onclick="saveCloudConfig()">‰øùÂ≠òÈÖçÁΩÆ</button>
                    <button class="btn btn-primary" onclick="syncToCloud()">ÂêåÊ≠•Âà∞‰∫ëÁ´Ø</button>
                    <button class="btn btn-info" onclick="syncFromCloud()">‰ªé‰∫ëÁ´ØÂêåÊ≠•</button>
                    <button class="btn btn-danger" onclick="closeCloudModal()">ÂÖ≥Èó≠</button>
                </div>
                <div style="margin-top: 15px; font-size: 12px; color: #999;">
                    üí° ÊèêÁ§∫ÔºöTokenÂè™ÈúÄË¶ÅÂàõÂª∫‰∏ÄÊ¨°ÔºåGist ID‰ºöÂú®Á¨¨‰∏ÄÊ¨°ÂêåÊ≠•Êó∂Ëá™Âä®ÁîüÊàê„ÄÇÂêØÁî®Ëá™Âä®ÂêåÊ≠•ÂêéÔºåÁ≥ªÁªü‰ºöÂÆöÊúüÊ£ÄÊü•‰∫ëÁ´ØÊõ¥Êñ∞„ÄÇ
                </div>
            `;

            modal.appendChild(modalContent);
            document.body.appendChild(modal);

            // ‰øùÂ≠òÈÖçÁΩÆÂáΩÊï∞
            window.saveCloudConfig = function() {
                const token = document.getElementById('githubToken').value.trim();
                const gistId = document.getElementById('gistId').value.trim();
                const autoSyncEnabled = document.getElementById('autoSyncEnabled').checked;
                const syncFrequency = parseInt(document.getElementById('syncFrequency').value);
                
                if (!token) {
                    alert('ËØ∑ËæìÂÖ•GitHub TokenÔºÅ');
                    return;
                }
                
                cloudSync.setGithubToken(token);
                if (gistId) {
                    cloudSync.setGistId(gistId);
                }
                
                // ‰øùÂ≠òËá™Âä®ÂêåÊ≠•ËÆæÁΩÆ
                if (autoSyncEnabled) {
                    autoSyncManager.enableAutoSync();
                } else {
                    autoSyncManager.disableAutoSync();
                }
                autoSyncManager.setSyncFrequency(syncFrequency);
                
                alert('ÈÖçÁΩÆ‰øùÂ≠òÊàêÂäüÔºÅ');
                closeCloudModal();
            };

            // ÂêåÊ≠•Âà∞‰∫ëÁ´ØÂáΩÊï∞
            window.syncToCloud = async function() {
                try {
                    if (!cloudSync.githubToken) {
                        alert('ËØ∑ÂÖà‰øùÂ≠òGitHub TokenÈÖçÁΩÆÔºÅ');
                        return;
                    }
                    
                    const btn = event.target;
                    btn.disabled = true;
                    btn.textContent = 'ÂêåÊ≠•‰∏≠...';
                    
                    await cloudSync.syncToCloud();
                    
                    alert('Êï∞ÊçÆÂêåÊ≠•Âà∞‰∫ëÁ´ØÊàêÂäüÔºÅ');
                    closeCloudModal();
                } catch (error) {
                    alert('ÂêåÊ≠•Â§±Ë¥•Ôºö' + error.message);
                } finally {
                    const btn = event.target;
                    btn.disabled = false;
                    btn.textContent = 'ÂêåÊ≠•Âà∞‰∫ëÁ´Ø';
                }
            };

            // ‰ªé‰∫ëÁ´ØÂêåÊ≠•ÂáΩÊï∞ÔºàÂ∏¶ÂÜ≤Á™ÅÂ§ÑÁêÜÔºâ
            window.syncFromCloud = async function() {
                try {
                    if (!cloudSync.gistId) {
                        alert('ËØ∑ÂÖàËÆæÁΩÆGist IDÔºÅ');
                        return;
                    }
                    
                    const btn = event.target;
                    btn.disabled = true;
                    btn.textContent = 'ÂêåÊ≠•‰∏≠...';
                    
                    const result = await cloudSync.syncFromCloud();
                    
                    // Ê£ÄÊü•ÊòØÂê¶ÊúâÂÜ≤Á™Å
                    if (result.hasConflict) {
                        console.log('Ê£ÄÊµãÂà∞Êï∞ÊçÆÂÜ≤Á™ÅÔºåÊòæÁ§∫ÂÜ≤Á™ÅËß£ÂÜ≥ÂØπËØùÊ°Ü');
                        
                        // ÊòæÁ§∫ÂÜ≤Á™ÅËß£ÂÜ≥ÂØπËØùÊ°Ü
                        return new Promise((resolve) => {
                            versionManager.showConflictResolutionDialog(result.conflictInfo, async (resolution) => {
                                try {
                                    // Ëß£ÂÜ≥ÂÜ≤Á™Å
                                    const resolvedData = versionManager.resolveConflict(result.localData, result.cloudData, resolution);
                                    
                                    // Â§á‰ªΩÂΩìÂâçÊï∞ÊçÆ
                                    const backup = {
                                        runners: runners,
                                        records: records,
                                        backupDate: new Date().toISOString()
                                    };
                                    localStorage.setItem('runningDataBackup', JSON.stringify(backup));
                                    
                                    // Êõ¥Êñ∞Êú¨Âú∞Êï∞ÊçÆ
                                    runners = resolvedData.runners;
                                    records = resolvedData.records;
                                    
                                    // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
                                    localStorage.setItem('runners', JSON.stringify(runners));
                                    localStorage.setItem('runningRecords', JSON.stringify(records));
                                    
                                    // Êõ¥Êñ∞ÁïåÈù¢
                                    updateRunnerSelect();
                                    updateRunnerList();
                                    updateRecordsTable();
                                    updateSummaryStats();
                                    updateWeekHistory();
                                    
                                    // ÊòæÁ§∫ÂêàÂπ∂Êó•Âøó
                                    if (resolvedData.mergeLog && resolvedData.mergeLog.length > 0) {
                                        alert(`Êï∞ÊçÆÂêàÂπ∂ÂÆåÊàêÔºÅ\n\n${resolvedData.mergeLog.join('\n')}`);
                                    } else {
                                        alert('‰ªé‰∫ëÁ´ØÂêåÊ≠•ÊàêÂäüÔºÅÂ∑≤Ëá™Âä®Â§á‰ªΩÂéüÊúâÊï∞ÊçÆ„ÄÇ');
                                    }
                                    
                                    closeCloudModal();
                                    resolve();
                                } catch (error) {
                                    alert('ÂÜ≤Á™ÅËß£ÂÜ≥Â§±Ë¥•Ôºö' + error.message);
                                    resolve();
                                }
                            });
                        });
                    } else {
                        // Êó†ÂÜ≤Á™ÅÔºåÁõ¥Êé•ÂêåÊ≠•
                        const cloudData = result.cloudData;
                        
                        // Á°ÆËÆ§ÂØºÂÖ•
                        const confirmMsg = `Á°ÆÂÆöË¶Å‰ªé‰∫ëÁ´ØÂêåÊ≠•Êï∞ÊçÆÂêóÔºü\n\n` +
                                         `Ë∑ëÂèãÊï∞ÈáèÔºö${cloudData.runners.length} ‰∫∫\n` +
                                         `ËÆ∞ÂΩïÊï∞ÈáèÔºö${cloudData.records.length} Êù°\n` +
                                         `ÊúÄÂêéÊõ¥Êñ∞Ôºö${cloudData.lastSync ? new Date(cloudData.lastSync).toLocaleString() : 'Êú™Áü•'}\n\n` +
                                         `‚ö†Ô∏è ÂêåÊ≠•Â∞ÜË¶ÜÁõñÊú¨Âú∞Êï∞ÊçÆÔºåËØ∑Ë∞®ÊÖéÊìç‰ΩúÔºÅ`;
                        
                        if (confirm(confirmMsg)) {
                            // Â§á‰ªΩÂΩìÂâçÊï∞ÊçÆ
                            const backup = {
                                runners: runners,
                                records: records,
                                backupDate: new Date().toISOString()
                            };
                            localStorage.setItem('runningDataBackup', JSON.stringify(backup));
                            
                            // ÂØºÂÖ•‰∫ëÁ´ØÊï∞ÊçÆ
                            runners = cloudData.runners;
                            records = cloudData.records;
                            
                            // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
                            localStorage.setItem('runners', JSON.stringify(runners));
                            localStorage.setItem('runningRecords', JSON.stringify(records));
                            
                            // Êõ¥Êñ∞ÁâàÊú¨‰ø°ÊÅØ
                            versionManager.saveVersion();
                            
                            // Êõ¥Êñ∞ÁïåÈù¢
                            updateRunnerSelect();
                            updateRunnerList();
                            updateRecordsTable();
                            updateSummaryStats();
                            updateWeekHistory();
                            
                            alert('‰ªé‰∫ëÁ´ØÂêåÊ≠•ÊàêÂäüÔºÅÂ∑≤Ëá™Âä®Â§á‰ªΩÂéüÊúâÊï∞ÊçÆ„ÄÇ');
                            closeCloudModal();
                        }
                    }
                } catch (error) {
                    alert('ÂêåÊ≠•Â§±Ë¥•Ôºö' + error.message);
                } finally {
                    const btn = event.target;
                    btn.disabled = false;
                    btn.textContent = '‰ªé‰∫ëÁ´ØÂêåÊ≠•';
                }
            };

            // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°ÜÂáΩÊï∞
            window.closeCloudModal = function() {
                document.body.removeChild(modal);
                delete window.saveCloudConfig;
                delete window.syncToCloud;
                delete window.syncFromCloud;
                delete window.closeCloudModal;
            };
        }

        // Êõ¥Êñ∞ÂéÜÂè≤ËÆ∞ÂΩïÊòæÁ§∫
        function updateWeekHistory() {
            const weekStart = getWeekStart(new Date());
            weekStart.setDate(weekStart.getDate() + (currentWeekOffset * 7));
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6);
            
            // Êõ¥Êñ∞Âë®ÊòæÁ§∫
            const weekDisplay = document.getElementById('currentWeekDisplay');
            const weekRange = `${weekStart.getMonth() + 1}Êúà${weekStart.getDate()}Êó• - ${weekEnd.getMonth() + 1}Êúà${weekEnd.getDate()}Êó•`;
            const yearDisplay = weekStart.getFullYear() !== new Date().getFullYear() ? `${weekStart.getFullYear()}Âπ¥` : '';
            weekDisplay.innerHTML = `<strong>${yearDisplay}${weekRange}</strong>`;
            
            // Ëé∑ÂèñÊú¨Âë®ÁªüËÆ°
            const weekStats = [];
            let totalDistance = 0;
            let totalRuns = 0;
            let qualifiedRunners = 0;
            
            runners.forEach(runner => {
                const stats = getRunnerWeekStats(runner.id, weekStart);
                const isComplete = stats.qualifiedRuns >= 3 && stats.totalDistance >= runner.targetDistance;
                
                weekStats.push({
                    runner: runner,
                    stats: stats,
                    isComplete: isComplete
                });
                
                totalDistance += stats.totalDistance;
                totalRuns += stats.records.length;
                if (isComplete) qualifiedRunners++;
            });
            
            // Êõ¥Êñ∞ÁªüËÆ°Ê¶ÇËßà
            updateWeekHistoryStats(totalDistance, totalRuns, qualifiedRunners, runners.length);
            
            // Êõ¥Êñ∞ËØ¶ÁªÜËÆ∞ÂΩï
            updateWeekHistoryDetails(weekStats);
        }
        
        // Êõ¥Êñ∞ÂéÜÂè≤ËÆ∞ÂΩïÁªüËÆ°Ê¶ÇËßà
        function updateWeekHistoryStats(totalDistance, totalRuns, qualifiedRunners, totalRunners) {
            const container = document.getElementById('weekHistoryStats');
            
            container.innerHTML = `
                <div class="week-history-card">
                    <h4>ÊÄªË∑ëÂèãÊï∞</h4>
                    <div class="stat-value">${totalRunners}</div>
                    <div class="stat-label">‰ΩçË∑ëÂèã</div>
                </div>
                <div class="week-history-card">
                    <h4>ËææÊ†á‰∫∫Êï∞</h4>
                    <div class="stat-value">${qualifiedRunners}</div>
                    <div class="stat-label">‰ΩçËææÊ†á</div>
                </div>
                <div class="week-history-card">
                    <h4>ÊÄªË∑ëÊ≠•Ê¨°Êï∞</h4>
                    <div class="stat-value">${totalRuns}</div>
                    <div class="stat-label">Ê¨°Ë∑ëÊ≠•</div>
                </div>
                <div class="week-history-card">
                    <h4>ÊÄªË∑ëÊ≠•Ë∑ùÁ¶ª</h4>
                    <div class="stat-value">${totalDistance.toFixed(1)}</div>
                    <div class="stat-label">ÂÖ¨Èáå</div>
                </div>
            `;
        }
        
        // Êõ¥Êñ∞ÂéÜÂè≤ËÆ∞ÂΩïËØ¶ÁªÜ‰ø°ÊÅØ
        function updateWeekHistoryDetails(weekStats) {
            const container = document.getElementById('weekHistoryDetails');
            
            if (weekStats.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">ÊöÇÊó†Ë∑ëÂèãÊï∞ÊçÆ</div>';
                return;
            }
            
            // ÊåâËææÊ†áÊÉÖÂÜµÊéíÂ∫è
            weekStats.sort((a, b) => {
                if (a.isComplete && !b.isComplete) return -1;
                if (!a.isComplete && b.isComplete) return 1;
                return b.stats.totalDistance - a.stats.totalDistance;
            });
            
            container.innerHTML = weekStats.map(item => {
                const statusClass = item.isComplete ? 'status-complete' : 'status-incomplete';
                const statusText = item.isComplete ? '‚úÖ ËææÊ†á' : '‚ùå Êú™ËææÊ†á';
                const completionRate = Math.min((item.stats.totalDistance / item.runner.targetDistance * 100), 100).toFixed(1);
                
                return `
                    <div class="week-history-runner">
                        <div class="week-history-runner-name">
                            ${item.runner.name}
                            <span class="${statusClass}" style="margin-left: 10px;">${statusText}</span>
                        </div>
                        <div class="week-history-runner-stats">
                            <div class="week-history-runner-stat">
                                <div class="value">${item.stats.totalDistance.toFixed(1)}</div>
                                <div class="label">ÊÄªË∑ùÁ¶ª(km)</div>
                            </div>
                            <div class="week-history-runner-stat">
                                <div class="value">${item.stats.runDays}</div>
                                <div class="label">Ë∑ëÊ≠•Â§©Êï∞</div>
                            </div>
                            <div class="week-history-runner-stat">
                                <div class="value">${item.stats.qualifiedRuns}</div>
                                <div class="label">ËææÊ†áÊ¨°Êï∞</div>
                            </div>
                            <div class="week-history-runner-stat">
                                <div class="value">${completionRate}%</div>
                                <div class="label">ÂÆåÊàêÁéá</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // ÂàáÊç¢Âë®
        function changeWeek(direction) {
            currentWeekOffset += direction;
            updateWeekHistory();
        }
        
        // ËøîÂõûÊú¨Âë®
        function goToCurrentWeek() {
            currentWeekOffset = 0;
            updateWeekHistory();
        }

        // Ê∑ªÂä†ÂØºÂá∫ÊåâÈíÆ
        document.addEventListener('DOMContentLoaded', function() {
            const header = document.querySelector('.header');
            
            // ÂàõÂª∫Êï∞ÊçÆÁÆ°ÁêÜÊåâÈíÆÁªÑ
            const dataMgmtGroup = document.createElement('div');
            dataMgmtGroup.style.cssText = 'position: absolute; top: 20px; right: 20px; display: flex; gap: 10px;';
            
            // ÂØºÂá∫ÊåâÈíÆ
            const exportBtn = document.createElement('button');
            exportBtn.className = 'btn btn-warning';
            exportBtn.textContent = 'ÂØºÂá∫Êï∞ÊçÆ';
            exportBtn.onclick = exportData;
            exportBtn.title = 'ÂØºÂá∫ÊâÄÊúâË∑ëÊ≠•Êï∞ÊçÆÂà∞Êñá‰ª∂';
            
            // ÂØºÂÖ•ÊåâÈíÆ
            const importBtn = document.createElement('button');
            importBtn.className = 'btn btn-info';
            importBtn.textContent = 'ÂØºÂÖ•Êï∞ÊçÆ';
            importBtn.onclick = importData;
            importBtn.title = '‰ªéÊñá‰ª∂ÂØºÂÖ•Ë∑ëÊ≠•Êï∞ÊçÆ';
            
            // ÊÅ¢Â§çÂ§á‰ªΩÊåâÈíÆ
            const restoreBtn = document.createElement('button');
            restoreBtn.className = 'btn btn-secondary';
            restoreBtn.textContent = 'ÊÅ¢Â§çÂ§á‰ªΩ';
            restoreBtn.onclick = restoreBackup;
            restoreBtn.title = 'ÊÅ¢Â§çÂà∞‰∏ä‰∏ÄÊ¨°ÁöÑÊï∞ÊçÆÂ§á‰ªΩ';
            
            // ‰∫ëÁ´ØÂêåÊ≠•ÊåâÈíÆ
            const cloudSyncBtn = document.createElement('button');
            cloudSyncBtn.className = 'btn btn-success';
            cloudSyncBtn.textContent = '‚òÅÔ∏è ‰∫ëÁ´ØÂêåÊ≠•';
            cloudSyncBtn.onclick = showCloudSyncModal;
            cloudSyncBtn.title = 'ÈÖçÁΩÆGitHub Gist‰∫ëÁ´ØÂêåÊ≠•';
            
            dataMgmtGroup.appendChild(exportBtn);
            dataMgmtGroup.appendChild(importBtn);
            dataMgmtGroup.appendChild(restoreBtn);
            dataMgmtGroup.appendChild(cloudSyncBtn);
            header.appendChild(dataMgmtGroup);
        });

        // ÂæÆ‰ø°ÊµèËßàÂô®Ê£ÄÊµãÂíåÈÄÇÈÖç
        function detectWeChatBrowser() {
            const ua = navigator.userAgent.toLowerCase();
            const isWeChat = /micromessenger/i.test(ua);
            
            if (isWeChat) {
                console.log('Ê£ÄÊµãÂà∞ÂæÆ‰ø°ÊµèËßàÂô®ÔºåÂ∫îÁî®ÂæÆ‰ø°‰∏ìÁî®‰ºòÂåñ');
                
                // Ê∑ªÂä†ÂæÆ‰ø°‰ºòÂåñÁ±ª
                document.body.classList.add('wechat-optimized');
                document.documentElement.classList.add('wechat-safe-area');
                
                // ÂæÆ‰ø°ÊµèËßàÂô®ÊªöÂä®‰ºòÂåñ
                document.querySelector('.container').classList.add('wechat-scroll');
                
                // ‰∏∫ÊâÄÊúâÊåâÈíÆÂíåÂèØÁÇπÂáªÂÖÉÁ¥†Ê∑ªÂä†ÂæÆ‰ø°ÁÇπÂáª‰ºòÂåñ
                const clickableElements = document.querySelectorAll('.btn, .runner-card, .day-stat, .week-history-card');
                clickableElements.forEach(element => {
                    element.classList.add('wechat-tap');
                });
                
                // ÂæÆ‰ø°ÊµèËßàÂô®Â≠ó‰Ωì‰ºòÂåñ
                document.body.style.fontFamily = '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"';
                
                // ÂæÆ‰ø°ÊµèËßàÂô®ËßÜÂè£ÈÄÇÈÖç
                const viewport = document.querySelector('meta[name="viewport"]');
                if (viewport) {
                    viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover');
                }
                
                // ÂæÆ‰ø°ÊµèËßàÂô®ÂÆâÂÖ®Âå∫ÂüüÈÄÇÈÖç
                const safeAreaStyle = document.createElement('style');
                safeAreaStyle.textContent = `
                    .wechat-safe-area {
                        padding-top: constant(safe-area-inset-top);
                        padding-top: env(safe-area-inset-top);
                        padding-bottom: constant(safe-area-inset-bottom);
                        padding-bottom: env(safe-area-inset-bottom);
                        padding-left: constant(safe-area-inset-left);
                        padding-left: env(safe-area-inset-left);
                        padding-right: constant(safe-area-inset-right);
                        padding-right: env(safe-area-inset-right);
                    }
                `;
                document.head.appendChild(safeAreaStyle);
                
                // ÂæÆ‰ø°ÊµèËßàÂô®ËæìÂÖ•Ê°Ü‰ºòÂåñ
                const inputs = document.querySelectorAll('input, select');
                inputs.forEach(input => {
                    input.style.fontSize = '16px'; // Èò≤Ê≠¢ÂæÆ‰ø°ÊµèËßàÂô®Áº©Êîæ
                    input.addEventListener('focus', function() {
                        document.body.style.position = 'fixed';
                        document.body.style.width = '100%';
                    });
                    input.addEventListener('blur', function() {
                        document.body.style.position = '';
                        document.body.style.width = '';
                    });
                });
                
                console.log('ÂæÆ‰ø°ÊµèËßàÂô®‰ºòÂåñÂ∑≤ÂÆåÊàê');
            }
            
            return isWeChat;
        }
        
        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÊâßË°åÂæÆ‰ø°Ê£ÄÊµã
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(detectWeChatBrowser, 100);
            
            // ÂêØÂä®Ëá™Âä®ÂêåÊ≠•ÔºàÂ¶ÇÊûúÂ∑≤ÈÖçÁΩÆÔºâ
            setTimeout(() => {
                const syncStatus = autoSyncManager.getSyncStatus();
                if (syncStatus.enabled && syncStatus.hasValidConfig) {
                    console.log('ÂêØÂä®Ëá™Âä®ÂêåÊ≠•...');
                    autoSyncManager.startAutoSync();
                }
            }, 2000); // Âª∂Ëøü2ÁßíÂêØÂä®ÔºåÁ°Æ‰øùÈ°µÈù¢ÂÆåÂÖ®Âä†ËΩΩ
        });
        
        // Á™óÂè£Â§ßÂ∞èÊîπÂèòÊó∂ÈáçÊñ∞ÈÄÇÈÖç
        window.addEventListener('resize', function() {
            if (document.body.classList.contains('wechat-optimized')) {
                detectWeChatBrowser();
            }
        });
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="email=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="x5-orientation" content="portrait">
    <meta name="x5-fullscreen" content="true">
    <meta name="x5-page-mode" content="app">
    <title>Ë∑ëÊ≠•ÊâìÂç°ËÆ∞ÂΩïÁ≥ªÁªü</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* ÂæÆ‰ø°ÊµèËßàÂô®ÈÄÇÈÖçÊ†∑Âºè */
        .weui-fix {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        /* ÂæÆ‰ø°ÊµèËßàÂô®Â≠ó‰Ωì‰ºòÂåñ */
        body.wechat {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
        }

        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        /* AIËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§ - Áõ∏ÂÖ≥Ê†∑ÂºèÂ∑≤Ê∏ÖÁêÜ */

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #ff6b6b, #ffa726);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .main-content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
            padding: 25px;
            border-radius: 10px;
            background: #f8f9fa;
            border-left: 5px solid #007bff;
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
        }

        .section h2::before {
            content: "üèÉ‚Äç";
            margin-right: 10px;
            font-size: 1.2em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        .btn {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,123,255,0.3);
        }

        .btn-success {
            background: linear-gradient(45deg, #28a745, #1e7e34);
        }

        .btn-danger {
            background: linear-gradient(45deg, #dc3545, #c82333);
        }

        .btn-warning {
            background: linear-gradient(45deg, #ffc107, #e0a800);
            color: #333;
        }

        .runner-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .runner-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 4px solid #28a745;
            transition: transform 0.3s;
        }

        .runner-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .runner-card.incomplete {
            border-left-color: #dc3545;
        }

        .runner-card.warning {
            border-left-color: #ffc107;
        }

        .runner-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .runner-target {
            color: #666;
            margin-bottom: 15px;
            font-size: 0.9em;
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #28a745, #20c997);
            border-radius: 10px;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .week-stats {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-top: 15px;
        }

        .day-stat {
            text-align: center;
            padding: 8px 4px;
            border-radius: 5px;
            font-size: 0.8em;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
        }

        .day-stat.completed {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .day-stat.incomplete {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .records-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .records-table th,
        .records-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .records-table th {
            background: #007bff;
            color: white;
            font-weight: bold;
        }

        .records-table tr:hover {
            background: #f8f9fa;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-top: 4px solid #007bff;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
        }

        .penalty-info {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .penalty-info h3 {
            margin-bottom: 10px;
        }

        .hidden {
            display: none;
        }

        /* Â∑≤ÁßªÈô§Â∑¶Âè≥ÂàÜÊ†èÂ∏ÉÂ±Ä - ÁïåÈù¢ÁÆÄÂåñ */

        /* ÊØèÂë®ÂéÜÂè≤ËÆ∞ÂΩïÊ†∑Âºè */
        .week-history-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .week-history-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            text-align: center;
            border-left: 4px solid #007bff;
        }

        .week-history-card h4 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 16px;
        }

        .week-history-card .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 5px;
        }

        .week-history-card .stat-label {
            color: #666;
            font-size: 14px;
        }

        .week-history-details {
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .week-history-runner {
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .week-history-runner:last-child {
            border-bottom: none;
        }

        .week-history-runner-name {
            font-weight: bold;
            color: #333;
            font-size: 16px;
        }

        .week-history-runner-stats {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .week-history-runner-stat {
            text-align: center;
        }

        .week-history-runner-stat .value {
            font-weight: bold;
            color: #007bff;
            font-size: 14px;
        }

        .week-history-runner-stat .label {
            font-size: 12px;
            color: #666;
        }

        .status-complete {
            color: #28a745;
        }

        .status-incomplete {
            color: #dc3545;
        }

        .divider {
            text-align: center;
            margin: 20px 0;
            color: #666;
            font-weight: bold;
            position: relative;
        }

        .divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #ddd;
            z-index: 1;
        }

        .divider span {
            background: white;
            padding: 0 15px;
            position: relative;
            z-index: 2;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .runner-list {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .week-stats {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .summary-stats {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }

            /* ÁßªÂä®Á´ØË°®Ê†º‰ºòÂåñ */
            .records-table {
                font-size: 12px;
            }
            
            .records-table th,
            .records-table td {
                padding: 8px 4px;
            }
            
            /* ÁßªÂä®Á´ØÊåâÈíÆ‰ºòÂåñ */
            .btn {
                padding: 8px 12px;
                font-size: 14px;
                margin: 2px;
            }
            
            /* ÁßªÂä®Á´ØË°®Âçï‰ºòÂåñ */
            .form-group {
                margin-bottom: 15px;
            }
            
            .form-group label {
                font-size: 14px;
                margin-bottom: 5px;
            }
            
            .form-group input,
            .form-group select {
                padding: 10px;
                font-size: 14px;
            }
            
            /* ÁßªÂä®Á´ØÂéÜÂè≤ËÆ∞ÂΩïÂØºËà™‰ºòÂåñ */
            .week-history-stats {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
            
            .week-history-card {
                padding: 15px;
            }
            
            /* ÁßªÂä®Á´ØË∑ëÂèãÂç°Áâá‰ºòÂåñ */
            .runner-card {
                padding: 15px;
                margin-bottom: 10px;
            }
            
            .runner-name {
                font-size: 16px;
            }
            
            .runner-stats {
                font-size: 12px;
            }
            
            /* ÁßªÂä®Á´ØÊ†áÈ¢ò‰ºòÂåñ */
            .header h1 {
                font-size: 24px;
            }
            
            .header p {
                font-size: 14px;
            }
            
            .section h2 {
                font-size: 18px;
                padding: 10px;
                margin: -20px -20px 20px -20px;
            }
            
            /* ÁßªÂä®Á´ØÂë®ÁªüËÆ°‰ºòÂåñ */
            .day-stat {
                padding: 8px;
                font-size: 12px;
            }
            
            .day-stat .day-name {
                font-size: 10px;
            }
            
            /* ÁßªÂä®Á´ØÂéÜÂè≤ËÆ∞ÂΩïËØ¶ÊÉÖ‰ºòÂåñ */
            .week-history-details {
                font-size: 14px;
            }
            
            .history-runner-item {
                padding: 10px;
                margin-bottom: 8px;
            }
            
            /* ÁßªÂä®Á´ØÁªüËÆ°Âç°Áâá‰ºòÂåñ */
            .stat-card {
                padding: 15px;
            }
            
            .stat-number {
                font-size: 1.5em;
            }
            
            .stat-label {
                font-size: 0.8em;
            }
            
            /* ÁßªÂä®Á´ØË∑ëÂèãÂç°Áâá‰ºòÂåñ */
            .runner-card {
                padding: 15px;
                margin-bottom: 10px;
            }
            
            .runner-name {
                font-size: 1.1em;
            }
            
            .runner-target {
                font-size: 0.8em;
            }
            
            .progress-bar {
                height: 15px;
            }
            
            .progress-fill {
                font-size: 10px;
            }
            
            /* ÁßªÂä®Á´ØÂØºËà™ÊåâÈíÆÁªÑ‰ºòÂåñ */
            .section > div[style*="display: flex"] {
                flex-direction: column;
                gap: 10px;
            }
            
            .section > div[style*="display: flex"] > button {
                width: 100%;
                margin: 0;
            }
            
            .section > div[style*="display: flex"] > div {
                width: 100%;
                margin: 10px 0;
            }
            
            /* Â∑≤ÁßªÈô§record-sectionÂìçÂ∫îÂºèÂ∏ÉÂ±Ä - ÁïåÈù¢ÁÆÄÂåñ */
        }
        
        /* Ë∂ÖÂ∞èÂ±èÂπïÈ¢ùÂ§ñ‰ºòÂåñ */
        @media (max-width: 480px) {
            .container {
                margin: 5px;
                border-radius: 8px;
            }
            
            .main-content {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 20px;
            }
            
            .section h2 {
                font-size: 16px;
                margin: -15px -15px 15px -15px;
            }
            
            .records-table {
                font-size: 11px;
            }
            
            .records-table th,
            .records-table td {
                padding: 6px 2px;
            }
            
            .btn {
                padding: 6px 10px;
                font-size: 12px;
            }
            
            .week-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 5px;
            }
            
            .day-stat {
                padding: 6px;
                font-size: 11px;
            }
            
            /* Ë∂ÖÂ∞èÂ±èÂπï‰∏ãÁöÑÂ∏ÉÂ±ÄË∞ÉÊï¥ */
            .summary-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            
            .week-history-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }
            
            .stat-card,
            .week-history-card {
                padding: 12px;
            }
            
            .stat-number,
            .week-history-card .stat-value {
                font-size: 18px;
            }
        }
        
        /* Ëß¶Êë∏ËÆæÂ§á‰ºòÂåñ */
        @media (hover: none) and (pointer: coarse) {
            .btn {
                min-height: 44px; /* iOSÊé®ËçêÁöÑÊúÄÂ∞èËß¶Êë∏ÁõÆÊ†á */
                -webkit-tap-highlight-color: transparent;
            }
            
            .btn:active {
                transform: scale(0.98);
                transition: transform 0.1s ease;
            }
            
            .runner-card {
                -webkit-tap-highlight-color: transparent;
            }
            
            .runner-card:active {
                transform: scale(0.99);
                transition: transform 0.1s ease;
            }
            
            /* ‰ºòÂåñÊªöÂä®ÊÄßËÉΩ */
            .records-table {
                -webkit-overflow-scrolling: touch;
                overflow-x: auto;
                display: block;
            }
            
            /* Èò≤Ê≠¢ÂèåÂáªÁº©Êîæ */
            .btn, .runner-card, .day-stat {
                touch-action: manipulation;
            }
            
            /* ÁßªÂä®Á´ØÊõ¥Â•ΩÁöÑËßÜËßâÂèçÈ¶à */
            .week-history-card {
                transition: all 0.2s ease;
            }
            
            .week-history-card:active {
                transform: translateY(1px);
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
        }
        
        /* ÊöóËâ≤Ê®°ÂºèÊîØÊåÅ */
        @media (prefers-color-scheme: dark) {
            body {
                background-color: #1a1a1a;
            }
            
            .container {
                background-color: #2d2d2d;
                color: #e0e0e0;
            }
            
            .section {
                background-color: #3d3d3d;
                border-color: #555;
            }
            
            .section h2 {
                background-color: #4a4a4a;
                color: #fff;
            }
            
            .form-group input,
            .form-group select {
                background-color: #4a4a4a;
                color: #e0e0e0;
                border-color: #666;
            }
            
            .records-table {
                background-color: #3d3d2d;
                color: #e0e0e0;
            }
            
            .records-table th {
                background-color: #4a4a4a;
            }
            
            .records-table tr:nth-child(even) {
                background-color: #454545;
            }
            
            .runner-card {
                background-color: #4a4a4a;
                border-color: #666;
            }
            
            .week-history-card {
                background-color: #4a4a4a;
                border-color: #666;
            }
            
            .day-stat {
                background-color: #4a4a4a;
                border-color: #666;
            }
            
            .status-complete {
                color: #4caf50;
            }
            
            .status-incomplete {
                color: #f44336;
            }
        }
        
        /* ÂæÆ‰ø°ÊµèËßàÂô®‰∏ìÁî®‰ºòÂåñ */
        .wechat-optimized .container {
            border-radius: 0;
            box-shadow: none;
            margin: 0;
            max-width: 100vw;
        }
        
        .wechat-optimized .header {
            border-radius: 0;
            padding: 15px;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .wechat-optimized .header h1 {
            font-size: 1.5em;
            margin-bottom: 5px;
        }
        
        .wechat-optimized .main-content {
            padding: 10px;
            padding-bottom: 20px;
        }
        
        .wechat-optimized .section {
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 8px;
        }
        
        .wechat-optimized .section h2 {
            font-size: 1.2em;
            margin: -15px -15px 10px -15px;
            padding: 10px 15px;
        }
        
        .wechat-optimized .btn {
            padding: 8px 16px;
            font-size: 14px;
            border-radius: 6px;
            min-height: 40px;
        }
        
        .wechat-optimized .runner-card {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .wechat-optimized .runner-name {
            font-size: 1.1em;
        }
        
        .wechat-optimized .stat-card {
            padding: 8px;
            border-radius: 6px;
        }
        
        .wechat-optimized .stat-number {
            font-size: 1.2em;
        }
        
        .wechat-optimized .stat-label {
            font-size: 0.8em;
        }
        
        /* ÂæÆ‰ø°ÊµèËßàÂô®ÂÆâÂÖ®Âå∫ÂüüÈÄÇÈÖç */
        .wechat-safe-area {
            padding-top: env(safe-area-inset-top);
            padding-bottom: env(safe-area-inset-bottom);
            padding-left: env(safe-area-inset-left);
            padding-right: env(safe-area-inset-right);
        }
        
        /* ÂæÆ‰ø°ÊµèËßàÂô®ÊªöÂä®‰ºòÂåñ */
        .wechat-scroll {
            -webkit-overflow-scrolling: touch;
            overflow-scrolling: touch;
        }
        
        /* ÂæÆ‰ø°ÊµèËßàÂô®ÁÇπÂáªÊïàÊûú‰ºòÂåñ */
        .wechat-tap {
            -webkit-tap-highlight-color: rgba(0,0,0,0);
            tap-highlight-color: rgba(0,0,0,0);
        }

        /* ÂêåÊ≠•Áä∂ÊÄÅÊ†∑Âºè */
        .sync-status {
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .sync-status.syncing {
            background: linear-gradient(45deg, #007bff, #0056b3) !important;
            color: white !important;
            animation: pulse 1.5s infinite;
        }
        
        .sync-status.synced {
            background: linear-gradient(45deg, #28a745, #1e7e34) !important;
            color: white !important;
        }
        
        .sync-status.offline {
            background: linear-gradient(45deg, #6c757d, #545b62) !important;
            color: white !important;
        }
        
        .sync-status.pending {
            background: linear-gradient(45deg, #ffc107, #e0a800) !important;
            color: #212529 !important;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
    </style>
    <!-- Tesseract.js OCRÂ∫ìÂºïÁî®Â∑≤ÁßªÈô§ - AI/OCRÂäüËÉΩÂ∑≤Ê∏ÖÁêÜ -->
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèÉ‚ÄçË∑ëÊ≠•ÊâìÂç°ËÆ∞ÂΩïÁ≥ªÁªü</h1>
            <p>ÊØèÂë®Ëá≥Â∞ë3Ê¨°ÔºåÊØèÊ¨°5ÂÖ¨ÈáåÔºåÂùöÊåÅÂ∞±ÊòØËÉúÂà©ÔºÅ</p>
            <button id="syncButton" class="btn btn-info" onclick="manualSync()" style="position: absolute; top: 10px; right: 10px; font-size: 12px; padding: 5px 10px;">üîÑ ÊâãÂä®ÂêåÊ≠•</button>
            <button id="configButton" class="btn btn-warning" onclick="showConfigModal()" style="position: absolute; top: 10px; right: 120px; font-size: 12px; padding: 5px 10px;">‚öôÔ∏è ÈÖçÁΩÆ</button>
        </div>

        <div class="main-content">
            <!-- Ê∑ªÂä†Êñ∞ÊàêÂëò -->
            <div class="section">
                <h2>Ê∑ªÂä†Êñ∞Ë∑ëÂèã</h2>
                <div class="form-group">
                    <label for="newRunnerName">Ë∑ëÂèãÂßìÂêçÔºö</label>
                    <input type="text" id="newRunnerName" placeholder="ËØ∑ËæìÂÖ•Ë∑ëÂèãÂßìÂêç">
                </div>
                <div class="form-group">
                    <label for="newRunnerTarget">Âë®ÁõÆÊ†áË∑ùÁ¶ªÔºö</label>
                    <select id="newRunnerTarget">
                        <option value="20">20ÂÖ¨Èáå</option>
                        <option value="25">25ÂÖ¨Èáå</option>
                    </select>
                </div>
                <button class="btn btn-success" onclick="addRunner()">Ê∑ªÂä†Ë∑ëÂèã</button>
            </div>

            <!-- Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï -->
            <div class="section">
                <h2>Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï</h2>
                <div class="form-group">
                    <label for="runnerSelect">ÈÄâÊã©Ë∑ëÂèãÔºö</label>
                    <select id="runnerSelect"></select>
                </div>
                <div class="form-group">
                    <label for="runDate">Ë∑ëÊ≠•Êó•ÊúüÔºö</label>
                    <input type="date" id="runDate">
                </div>
                <div class="form-group">
                    <label for="runDistance">Ë∑ëÊ≠•Ë∑ùÁ¶ªÔºàÂÖ¨ÈáåÔºâÔºö</label>
                    <input type="number" id="runDistance" step="0.1" min="0" placeholder="ËØ∑ËæìÂÖ•Ë∑ëÊ≠•Ë∑ùÁ¶ª">
                </div>
                <div class="form-group">
                    <label for="runDuration">Ë∑ëÊ≠•Êó∂ÈïøÔºàÂàÜÈíüÔºâÔºö</label>
                    <input type="number" id="runDuration" step="1" min="0" placeholder="ËØ∑ËæìÂÖ•Ë∑ëÊ≠•Êó∂Èïø">
                </div>
                <div class="form-group">
                    <label for="runPace">Ë∑ëÊ≠•ÈÖçÈÄüÔºàÂàÜÈíü/ÂÖ¨ÈáåÔºâÔºö</label>
                    <input type="text" id="runPace" placeholder="Ëá™Âä®ËÆ°ÁÆóÊàñÊâãÂä®ËæìÂÖ•ÔºåÂ¶ÇÔºö5:30">
                </div>
                <div class="form-group">
                    <label for="runCalories">Ë∑ëÊ≠•Ê∂àËÄóÔºàÂç°Ë∑ØÈáåÔºâÔºö</label>
                    <input type="number" id="runCalories" step="1" min="0" placeholder="Ëá™Âä®‰º∞ÁÆóÊàñÊâãÂä®ËæìÂÖ•">
                </div>
                <button class="btn" onclick="addRecord()">Ê∑ªÂä†ËÆ∞ÂΩï</button>
                <button class="btn btn-warning" onclick="calculatePaceAndCalories()">ËÆ°ÁÆóÈÖçÈÄüÂíåÊ∂àËÄó</button>
            </div>

            <!-- ÁªüËÆ°Ê¶ÇËßà -->
            <div class="section">
                <h2>Êú¨Âë®ÁªüËÆ°Ê¶ÇËßà</h2>
                <div class="summary-stats" id="summaryStats"></div>
                <div class="penalty-info" id="penaltyInfo"></div>
            </div>

            <!-- Ë∑ëÂèãÂàóË°® -->
            <div class="section">
                <h2>Ë∑ëÂèãÂÆåÊàêÊÉÖÂÜµ</h2>
                <div class="runner-list" id="runnerList"></div>
            </div>

            <!-- ÊØèÂë®ÂéÜÂè≤ËÆ∞ÂΩï -->
            <div class="section">
                <h2>ÊØèÂë®ÂéÜÂè≤ËÆ∞ÂΩï</h2>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <button class="btn" onclick="changeWeek(-1)">‚Üê ‰∏ä‰∏ÄÂë®</button>
                    <div style="text-align: center;">
                        <span id="currentWeekDisplay"></span>
                        <div style="margin-top: 10px;">
                            <button class="btn btn-warning" onclick="goToCurrentWeek()">ËøîÂõûÊú¨Âë®</button>
                        </div>
                    </div>
                    <button class="btn" onclick="changeWeek(1)">‰∏ã‰∏ÄÂë® ‚Üí</button>
                </div>
                <div class="week-history-stats" id="weekHistoryStats"></div>
                <div class="week-history-details" id="weekHistoryDetails"></div>
            </div>

            <!-- ËØ¶ÁªÜËÆ∞ÂΩï -->
            <div class="section">
                <h2>ËØ¶ÁªÜË∑ëÊ≠•ËÆ∞ÂΩï</h2>
                <table class="records-table" id="recordsTable">
                    <thead>
                        <tr>
                            <th>Ë∑ëÂèã</th>
                            <th>Êó•Êúü</th>
                            <th>Ë∑ùÁ¶ª(km)</th>
                            <th>Êó∂Èïø(ÂàÜ)</th>
                            <th>ÈÖçÈÄü</th>
                            <th>Ê∂àËÄó(Âç°)</th>
                            <th>Êìç‰Ωú</th>
                        </tr>
                    </thead>
                    <tbody id="recordsBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // ‰∫ëÁ´ØÂêåÊ≠•ÈÖçÁΩÆ
        const CLOUD_SYNC_CONFIG = (() => {
            const savedConfig = localStorage.getItem('cloudSyncConfig');
            if (savedConfig) {
                return JSON.parse(savedConfig);
            }
            return {
                apiKey: '', // JSONBin.io APIÂØÜÈí•
                binId: '', // Â≠òÂÇ®Êï∞ÊçÆÁöÑbin ID
                enableSync: false // ÊòØÂê¶ÂêØÁî®‰∫ëÁ´ØÂêåÊ≠•
            };
        })();

        // Êï∞ÊçÆÂ≠òÂÇ®
        let runners = JSON.parse(localStorage.getItem('runners')) || [];
        let records = JSON.parse(localStorage.getItem('runningRecords')) || [];
        
        // ÂéÜÂè≤ËÆ∞ÂΩïÁõ∏ÂÖ≥ÂèòÈáè
        let currentWeekOffset = 0; // ÂΩìÂâçÊü•ÁúãÁöÑÂë®ÂÅèÁßªÈáèÔºà0Ë°®Á§∫Êú¨Âë®Ôºå-1Ë°®Á§∫‰∏äÂë®Ôºå1Ë°®Á§∫‰∏ãÂë®Ôºâ
        
        // ÂêåÊ≠•Áä∂ÊÄÅÁÆ°ÁêÜ
        let syncStatus = {
            isOnline: navigator.onLine,
            lastSyncTime: localStorage.getItem('lastSyncTime') || null,
            pendingSync: JSON.parse(localStorage.getItem('pendingSync') || '[]'),
            isSyncing: false
        };

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', async function() {
            // ËÆæÁΩÆÈªòËÆ§Êó•Êúü‰∏∫‰ªäÂ§©
            document.getElementById('runDate').valueAsDate = new Date();
            
            // Ê∑ªÂä†ÂêåÊ≠•Áä∂ÊÄÅÊòæÁ§∫ÂÖÉÁ¥†
            const header = document.querySelector('.header');
            if (header) {
                const syncStatusElement = document.createElement('div');
                syncStatusElement.id = 'syncStatus';
                syncStatusElement.className = 'sync-status';
                syncStatusElement.style.cssText = `
                    position: absolute;
                    top: 10px;
                    right: 10px;
                    font-size: 12px;
                    padding: 5px 10px;
                    border-radius: 15px;
                    background: rgba(255,255,255,0.9);
                    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                    z-index: 100;
                `;
                header.appendChild(syncStatusElement);
            }
            
            // ‰ªé‰∫ëÁ´ØÂêåÊ≠•ÂàùÂßãÊï∞ÊçÆ
            if (CLOUD_SYNC_CONFIG.enableSync && navigator.onLine) {
                await syncFromCloud();
            }
            
            // Êõ¥Êñ∞ÁïåÈù¢
            updateRunnerSelect();
            updateRunnerList();
            updateRecordsTable();
            updateSummaryStats();
            updateWeekHistory(); // ÂàùÂßãÂåñÂéÜÂè≤ËÆ∞ÂΩïÊòæÁ§∫
            updateSyncStatus(); // Êõ¥Êñ∞ÂêåÊ≠•Áä∂ÊÄÅÊòæÁ§∫
            
            // ÂêØÂä®Ëá™Âä®ÂêåÊ≠•
            startAutoSync();
        });

        // ÁÆ°ÁêÜÂëòÂØÜÁ†ÅÔºàÂèØ‰ª•Ê†πÊçÆÈúÄË¶Å‰øÆÊîπÔºâ
        const ADMIN_PASSWORD = 'running2024';

        // ‰∫ëÁ´ØÂêåÊ≠•ÂäüËÉΩ
        async function syncToCloud() {
            if (!CLOUD_SYNC_CONFIG.enableSync || !CLOUD_SYNC_CONFIG.apiKey || !CLOUD_SYNC_CONFIG.binId) {
                console.log('‰∫ëÁ´ØÂêåÊ≠•Êú™ÈÖçÁΩÆÊàñÂ∑≤Á¶ÅÁî®');
                return false;
            }

            if (syncStatus.isSyncing) {
                console.log('ÂêåÊ≠•Ê≠£Âú®ËøõË°å‰∏≠...');
                return false;
            }

            syncStatus.isSyncing = true;
            updateSyncStatus();

            try {
                const data = {
                    runners: runners,
                    records: records,
                    lastUpdated: new Date().toISOString(),
                    version: '1.0'
                };

                const response = await fetch(`https://api.jsonbin.io/v3/b/${CLOUD_SYNC_CONFIG.binId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': CLOUD_SYNC_CONFIG.apiKey,
                        'X-Bin-Private': 'false' // ËÆæÁΩÆ‰∏∫ÂÖ¨ÂºÄËÆøÈóÆ
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    syncStatus.lastSyncTime = new Date().toISOString();
                    localStorage.setItem('lastSyncTime', syncStatus.lastSyncTime);
                    syncStatus.pendingSync = [];
                    localStorage.setItem('pendingSync', JSON.stringify(syncStatus.pendingSync));
                    console.log('Êï∞ÊçÆÂêåÊ≠•Âà∞‰∫ëÁ´ØÊàêÂäü');
                    return true;
                } else {
                    console.error('ÂêåÊ≠•Âà∞‰∫ëÁ´ØÂ§±Ë¥•:', response.status);
                    return false;
                }
            } catch (error) {
                console.error('ÂêåÊ≠•Âà∞‰∫ëÁ´ØÂá∫Èîô:', error);
                return false;
            } finally {
                syncStatus.isSyncing = false;
                updateSyncStatus();
            }
        }

        // ‰ªé‰∫ëÁ´ØÂêåÊ≠•Êï∞ÊçÆ
        async function syncFromCloud() {
            if (!CLOUD_SYNC_CONFIG.enableSync || !CLOUD_SYNC_CONFIG.apiKey || !CLOUD_SYNC_CONFIG.binId) {
                console.log('‰∫ëÁ´ØÂêåÊ≠•Êú™ÈÖçÁΩÆÊàñÂ∑≤Á¶ÅÁî®');
                return false;
            }

            if (syncStatus.isSyncing) {
                console.log('ÂêåÊ≠•Ê≠£Âú®ËøõË°å‰∏≠...');
                return false;
            }

            syncStatus.isSyncing = true;
            updateSyncStatus();

            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${CLOUD_SYNC_CONFIG.binId}/latest`, {
                    method: 'GET',
                    headers: {
                        'X-Master-Key': CLOUD_SYNC_CONFIG.apiKey
                    }
                });

                if (response.ok) {
                    const result = await response.json();
                    const cloudData = result.record;

                    if (cloudData && cloudData.runners && cloudData.records) {
                        // ÂêàÂπ∂Êú¨Âú∞Âíå‰∫ëÁ´ØÊï∞ÊçÆ
                        runners = mergeData(runners, cloudData.runners, 'id');
                        records = mergeData(records, cloudData.records, 'id');

                        // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
                        localStorage.setItem('runners', JSON.stringify(runners));
                        localStorage.setItem('runningRecords', JSON.stringify(records));

                        syncStatus.lastSyncTime = new Date().toISOString();
                        localStorage.setItem('lastSyncTime', syncStatus.lastSyncTime);

                        console.log('‰ªé‰∫ëÁ´ØÂêåÊ≠•Êï∞ÊçÆÊàêÂäü');
                        return true;
                    }
                } else if (response.status === 404) {
                    console.log('‰∫ëÁ´ØÊï∞ÊçÆ‰∏çÂ≠òÂú®ÔºåÈ¶ñÊ¨°‰ΩøÁî®');
                    return true;
                } else {
                    console.error('‰ªé‰∫ëÁ´ØÂêåÊ≠•Â§±Ë¥•:', response.status);
                    return false;
                }
            } catch (error) {
                console.error('‰ªé‰∫ëÁ´ØÂêåÊ≠•Âá∫Èîô:', error);
                return false;
            } finally {
                syncStatus.isSyncing = false;
                updateSyncStatus();
            }
        }

        // ÂêàÂπ∂Êï∞ÊçÆÔºà‰ª•‰∫ëÁ´ØÊï∞ÊçÆ‰∏∫ÂáÜÔºå‰øùÁïôÊú¨Âú∞Áã¨ÊúâÊï∞ÊçÆÔºâ
        function mergeData(localData, cloudData, keyField) {
            const cloudMap = new Map(cloudData.map(item => [item[keyField], item]));
            const localMap = new Map(localData.map(item => [item[keyField], item]));
            
            // ‰ΩøÁî®‰∫ëÁ´ØÊï∞ÊçÆ‰∏∫‰∏ª
            const merged = [...cloudData];
            
            // Ê∑ªÂä†Êú¨Âú∞Áã¨ÊúâÊï∞ÊçÆ
            localData.forEach(item => {
                if (!cloudMap.has(item[keyField])) {
                    merged.push(item);
                }
            });
            
            return merged;
        }

        // Êõ¥Êñ∞ÂêåÊ≠•Áä∂ÊÄÅÊòæÁ§∫
        function updateSyncStatus() {
            const statusElement = document.getElementById('syncStatus');
            if (!statusElement) return;

            let statusText = '';
            let statusClass = '';

            if (syncStatus.isSyncing) {
                statusText = 'üîÑ ÂêåÊ≠•‰∏≠...';
                statusClass = 'syncing';
            } else if (!navigator.onLine) {
                statusText = 'üì° Á¶ªÁ∫øÊ®°Âºè';
                statusClass = 'offline';
            } else if (syncStatus.lastSyncTime) {
                const lastSync = new Date(syncStatus.lastSyncTime);
                const now = new Date();
                const diffMinutes = Math.floor((now - lastSync) / 60000);
                
                if (diffMinutes < 1) {
                    statusText = '‚úÖ ÂàöÂàöÂêåÊ≠•';
                } else if (diffMinutes < 60) {
                    statusText = `‚úÖ ${diffMinutes}ÂàÜÈíüÂâçÂêåÊ≠•`;
                } else {
                    const hours = Math.floor(diffMinutes / 60);
                    statusText = `‚úÖ ${hours}Â∞èÊó∂ÂâçÂêåÊ≠•`;
                }
                statusClass = 'synced';
            } else {
                statusText = '‚è≥ Êú™ÂêåÊ≠•';
                statusClass = 'pending';
            }

            statusElement.textContent = statusText;
            statusElement.className = `sync-status ${statusClass}`;
        }

        // Ëá™Âä®ÂêåÊ≠•ÔºàÂÆöÊó∂Âô®Ôºâ
        function startAutoSync() {
            if (!CLOUD_SYNC_CONFIG.enableSync) return;

            // ÊØè30ÁßíÊ£ÄÊü•‰∏ÄÊ¨°ÂêåÊ≠•
            setInterval(async () => {
                if (navigator.onLine && !syncStatus.isSyncing) {
                    // Â¶ÇÊûúÊúâÂæÖÂêåÊ≠•Êï∞ÊçÆÔºåÂÖà‰∏ä‰º†Âà∞‰∫ëÁ´Ø
                    if (syncStatus.pendingSync.length > 0) {
                        await syncToCloud();
                    }
                    // ÁÑ∂Âêé‰ªé‰∫ëÁ´ØÊãâÂèñÊúÄÊñ∞Êï∞ÊçÆ
                    await syncFromCloud();
                    // Êõ¥Êñ∞ÁïåÈù¢
                    updateRunnerSelect();
                    updateRunnerList();
                    updateRecordsTable();
                    updateSummaryStats();
                }
            }, 30000); // 30ÁßíÂêåÊ≠•‰∏ÄÊ¨°

            // ÁΩëÁªúÁä∂ÊÄÅÂèòÂåñÊó∂Á´ãÂç≥ÂêåÊ≠•
            window.addEventListener('online', async () => {
                syncStatus.isOnline = true;
                if (!syncStatus.isSyncing) {
                    await syncFromCloud();
                    updateAllUI();
                }
            });

            window.addEventListener('offline', () => {
                syncStatus.isOnline = false;
                updateSyncStatus();
            });
        }

        // Êõ¥Êñ∞ÊâÄÊúâUI
        function updateAllUI() {
            updateRunnerSelect();
            updateRunnerList();
            updateRecordsTable();
            updateSummaryStats();
            updateWeekHistory();
        }

        // Â§ÑÁêÜÂæÖÂêåÊ≠•ÈòüÂàó
        async function processPendingSync() {
            if (syncStatus.pendingSync.length === 0 || !navigator.onLine || !CLOUD_SYNC_CONFIG.enableSync) {
                return;
            }

            console.log(`Â§ÑÁêÜÂæÖÂêåÊ≠•ÈòüÂàóÔºåÂÖ± ${syncStatus.pendingSync.length} È°πÂæÖÂêåÊ≠•`);
            
            try {
                // ÂÖàÂ∞ùËØïÂêåÊ≠•Âà∞‰∫ëÁ´Ø
                const success = await syncToCloud();
                
                if (success) {
                    // ÂêåÊ≠•ÊàêÂäüÂêéÊ∏ÖÁ©∫ÈòüÂàó
                    syncStatus.pendingSync = [];
                    localStorage.setItem('pendingSyncQueue', JSON.stringify(syncStatus.pendingSync));
                    console.log('ÂæÖÂêåÊ≠•ÈòüÂàóÂ§ÑÁêÜÂÆåÊàê');
                }
            } catch (error) {
                console.error('Â§ÑÁêÜÂæÖÂêåÊ≠•ÈòüÂàóÂ§±Ë¥•:', error);
            }
        }

        // ÂÆûÊó∂Êï∞ÊçÆÂêåÊ≠•ÁÆ°ÁêÜÂô®
        class RealtimeSyncManager {
            constructor() {
                this.syncInterval = null;
                this.lastSyncTime = 0;
                this.syncCooldown = 2000; // 2ÁßíÂêåÊ≠•ÂÜ∑Âç¥Êó∂Èó¥
                this.setupCrossTabCommunication();
                this.setupStorageListener();
            }

            // ËÆæÁΩÆË∑®Ê†áÁ≠æÈ°µÈÄö‰ø°
            setupCrossTabCommunication() {
                // ‰ΩøÁî®BroadcastChannel APIÔºàÂ¶ÇÊûúÊîØÊåÅÔºâ
                if (window.BroadcastChannel) {
                    this.broadcastChannel = new BroadcastChannel('runningAppSync');
                    this.broadcastChannel.onmessage = (event) => {
                        this.handleCrossTabMessage(event.data);
                    };
                }

                // ‰ΩøÁî®localStorage‰∫ã‰ª∂‰Ωú‰∏∫Â§áÈÄâÊñπÊ°à
                window.addEventListener('storage', (event) => {
                    if (event.key === 'runningAppSync' && event.newValue) {
                        this.handleCrossTabMessage(JSON.parse(event.newValue));
                    }
                });
            }

            // ËÆæÁΩÆÂ≠òÂÇ®ÁõëÂê¨Âô®
            setupStorageListener() {
                // ÁõëÂê¨Êú¨Âú∞Êï∞ÊçÆÂèòÂåñ
                const originalSetItem = localStorage.setItem;
                localStorage.setItem = (key, value) => {
                    originalSetItem.call(localStorage, key, value);
                    
                    // ÁõëÂê¨ÂÖ≥ÈîÆÊï∞ÊçÆÂèòÂåñ
                    if (key === 'runners' || key === 'runningRecords') {
                        this.notifyDataChange(key, value);
                    }
                };
            }

            // Â§ÑÁêÜË∑®Ê†áÁ≠æÈ°µÊ∂àÊÅØ
            handleCrossTabMessage(message) {
                switch (message.type) {
                    case 'dataChanged':
                        console.log(`Êî∂Âà∞Êï∞ÊçÆÂèòÊõ¥ÈÄöÁü•: ${message.dataType}`);
                        this.handleExternalDataChange(message.dataType);
                        break;
                    case 'syncRequest':
                        this.handleSyncRequest(message);
                        break;
                }
            }

            // Â§ÑÁêÜÂ§ñÈÉ®Êï∞ÊçÆÂèòÂåñ
            async handleExternalDataChange(dataType) {
                const now = Date.now();
                if (now - this.lastSyncTime < this.syncCooldown) {
                    return; // ÈÅøÂÖçÈ¢ëÁπÅÂêåÊ≠•
                }

                this.lastSyncTime = now;

                // ‰ªé‰∫ëÁ´ØÂêåÊ≠•ÊúÄÊñ∞Êï∞ÊçÆ
                if (CLOUD_SYNC_CONFIG.enableSync && navigator.onLine) {
                    try {
                        await syncFromCloud();
                        updateAllUI();
                        console.log(`Êï∞ÊçÆÂ∑≤ÂêåÊ≠•Êõ¥Êñ∞: ${dataType}`);
                    } catch (error) {
                        console.error('ÂÆûÊó∂ÂêåÊ≠•Â§±Ë¥•:', error);
                    }
                }
            }

            // ÈÄöÁü•Êï∞ÊçÆÂèòÂåñ
            notifyDataChange(dataType, data) {
                const message = {
                    type: 'dataChanged',
                    dataType: dataType,
                    timestamp: Date.now(),
                    sourceTab: this.getTabId()
                };

                // ‰ΩøÁî®BroadcastChannel
                if (this.broadcastChannel) {
                    this.broadcastChannel.postMessage(message);
                }

                // ‰ΩøÁî®localStorage‰Ωú‰∏∫Â§áÈÄâ
                try {
                    localStorage.setItem('runningAppSync', JSON.stringify(message));
                } catch (error) {
                    console.warn('Ë∑®Ê†áÁ≠æÈ°µÈÄöÁü•Â§±Ë¥•:', error);
                }
            }

            // Ëé∑ÂèñÊ†áÁ≠æÈ°µID
            getTabId() {
                if (!this.tabId) {
                    this.tabId = 'tab_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                }
                return this.tabId;
            }

            // ÂêØÂä®ÂÆûÊó∂ÂêåÊ≠•
            startRealtimeSync() {
                if (!CLOUD_SYNC_CONFIG.enableSync) return;

                // ÊØè10ÁßíÊ£ÄÊü•‰∏ÄÊ¨°Êï∞ÊçÆÊõ¥Êñ∞
                this.syncInterval = setInterval(async () => {
                    if (navigator.onLine && !syncStatus.isSyncing) {
                        try {
                            const lastCloudSync = localStorage.getItem('lastCloudSyncTime');
                            const now = Date.now();
                            
                            // Â¶ÇÊûúË∂ÖËøá30ÁßíÊ≤°ÊúâÂêåÊ≠•ÔºåÂàôËøõË°åÂêåÊ≠•
                            if (!lastCloudSync || (now - parseInt(lastCloudSync)) > 30000) {
                                await syncFromCloud();
                                updateAllUI();
                                localStorage.setItem('lastCloudSyncTime', now.toString());
                            }
                        } catch (error) {
                            console.error('ÂÆöÊó∂ÂêåÊ≠•Â§±Ë¥•:', error);
                        }
                    }
                }, 10000); // 10ÁßíÊ£ÄÊü•‰∏ÄÊ¨°

                console.log('ÂÆûÊó∂ÂêåÊ≠•Â∑≤ÂêØÂä®');
            }

            // ÂÅúÊ≠¢ÂÆûÊó∂ÂêåÊ≠•
            stopRealtimeSync() {
                if (this.syncInterval) {
                    clearInterval(this.syncInterval);
                    this.syncInterval = null;
                }

                if (this.broadcastChannel) {
                    this.broadcastChannel.close();
                }

                console.log('ÂÆûÊó∂ÂêåÊ≠•Â∑≤ÂÅúÊ≠¢');
            }

            // Â§ÑÁêÜÂêåÊ≠•ËØ∑Ê±Ç
            handleSyncRequest(message) {
                // ÂèØ‰ª•Âú®ËøôÈáåÂÆûÁé∞Êõ¥Â§çÊùÇÁöÑÂêåÊ≠•ÈÄªËæë
                console.log('Êî∂Âà∞ÂêåÊ≠•ËØ∑Ê±Ç:', message);
            }
        }

        // ÂàõÂª∫ÂÆûÊó∂ÂêåÊ≠•ÁÆ°ÁêÜÂô®ÂÆû‰æã
        let realtimeSyncManager = null;

        // ÊâãÂä®ÂêåÊ≠•
        async function manualSync() {
            if (!CLOUD_SYNC_CONFIG.enableSync) {
                alert('‰∫ëÁ´ØÂêåÊ≠•ÂäüËÉΩÊú™ÂêØÁî®ÔºåËØ∑ÂÖàÈÖçÁΩÆAPIÂØÜÈí•');
                return;
            }

            const syncButton = document.getElementById('syncButton');
            syncButton.disabled = true;
            syncButton.textContent = 'üîÑ ÂêåÊ≠•‰∏≠...';

            try {
                // ÂÖà‰∏ä‰º†Êú¨Âú∞Êï∞ÊçÆÂà∞‰∫ëÁ´Ø
                const uploadSuccess = await syncToCloud();
                // ÁÑ∂Âêé‰ªé‰∫ëÁ´Ø‰∏ãËΩΩÊúÄÊñ∞Êï∞ÊçÆ
                const downloadSuccess = await syncFromCloud();

                if (uploadSuccess && downloadSuccess) {
                    // Êõ¥Êñ∞ÊâÄÊúâÁïåÈù¢
                    updateAllUI();
                    alert('‚úÖ Êï∞ÊçÆÂêåÊ≠•ÊàêÂäüÔºÅ');
                } else {
                    alert('‚ùå Êï∞ÊçÆÂêåÊ≠•Â§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•ÂíåÈÖçÁΩÆ');
                }
            } catch (error) {
                console.error('ÊâãÂä®ÂêåÊ≠•Âá∫Èîô:', error);
                alert('‚ùå ÂêåÊ≠•ËøáÁ®ã‰∏≠Âá∫Áé∞ÈîôËØØ');
            } finally {
                syncButton.disabled = false;
                syncButton.textContent = 'üîÑ ÊâãÂä®ÂêåÊ≠•';
            }
        }

        // ÊòæÁ§∫ÈÖçÁΩÆÊ®°ÊÄÅÊ°Ü
        function showConfigModal() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;

            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white;
                padding: 30px;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                text-align: center;
                min-width: 400px;
                max-width: 500px;
            `;

            modalContent.innerHTML = `
                <h3 style="margin-bottom: 20px; color: #333;">‚öôÔ∏è ‰∫ëÁ´ØÂêåÊ≠•ÈÖçÁΩÆ</h3>
                <div style="text-align: left; margin-bottom: 20px;">
                    <p style="margin-bottom: 15px; color: #666; line-height: 1.5;">
                        ‰∏∫‰∫ÜÂÆûÁé∞Â§öËÆæÂ§áÊï∞ÊçÆÂêåÊ≠•ÔºåÊÇ®ÈúÄË¶Å‰ΩøÁî® JSONBin.io ÊúçÂä°Ôºö
                    </p>
                    <ol style="margin-bottom: 15px; color: #666; padding-left: 20px; line-height: 1.6;">
                        <li>ËÆøÈóÆ <a href="https://jsonbin.io" target="_blank" style="color: #007bff;">jsonbin.io</a></li>
                        <li>Ê≥®ÂÜåÂÖçË¥πË¥¶Êà∑</li>
                        <li>ÂàõÂª∫Êñ∞ÁöÑ BinÔºàÊï∞ÊçÆÂÆπÂô®Ôºâ</li>
                        <li>Ëé∑Âèñ API ÂØÜÈí•Âíå Bin ID</li>
                    </ol>
                </div>
                <div style="margin-bottom: 15px; text-align: left;">
                    <label style="display: block; margin-bottom: 5px; color: #333;">API ÂØÜÈí•Ôºö</label>
                    <input type="password" id="apiKeyInput" placeholder="ËæìÂÖ•ÊÇ®ÁöÑ API ÂØÜÈí•" 
                           style="width: 100%; padding: 10px; border: 2px solid #ddd; 
                                  border-radius: 8px; margin-bottom: 10px; font-size: 14px;">
                </div>
                <div style="margin-bottom: 20px; text-align: left;">
                    <label style="display: block; margin-bottom: 5px; color: #333;">Bin IDÔºö</label>
                    <input type="text" id="binIdInput" placeholder="ËæìÂÖ•ÊÇ®ÁöÑ Bin ID" 
                           style="width: 100%; padding: 10px; border: 2px solid #ddd; 
                                  border-radius: 8px; margin-bottom: 10px; font-size: 14px;">
                </div>
                <div style="margin-bottom: 20px;">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="enableSyncCheckbox" ${CLOUD_SYNC_CONFIG.enableSync ? 'checked' : ''} 
                               style="margin-right: 8px;">
                        <span style="color: #333;">ÂêØÁî®‰∫ëÁ´ØÂêåÊ≠•</span>
                    </label>
                </div>
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button class="btn btn-success" onclick="saveConfig()">‰øùÂ≠òÈÖçÁΩÆ</button>
                    <button class="btn btn-danger" onclick="closeConfigModal()">ÂèñÊ∂à</button>
                </div>
            `;

            modal.appendChild(modalContent);
            document.body.appendChild(modal);

            // Â°´ÂÖÖÂΩìÂâçÈÖçÁΩÆ
            document.getElementById('apiKeyInput').value = CLOUD_SYNC_CONFIG.apiKey || '';
            document.getElementById('binIdInput').value = CLOUD_SYNC_CONFIG.binId || '';

            // ‰øùÂ≠òÈÖçÁΩÆÂáΩÊï∞
            window.saveConfig = function() {
                const apiKey = document.getElementById('apiKeyInput').value.trim();
                const binId = document.getElementById('binIdInput').value.trim();
                const enableSync = document.getElementById('enableSyncCheckbox').checked;

                if (enableSync && (!apiKey || !binId)) {
                    alert('ÂêØÁî®ÂêåÊ≠•Êó∂ÂøÖÈ°ªÂ°´ÂÜô API ÂØÜÈí•Âíå Bin ID');
                    return;
                }

                // ‰øùÂ≠òÈÖçÁΩÆÂà∞Êú¨Âú∞Â≠òÂÇ®
                const newConfig = {
                    apiKey: apiKey,
                    binId: binId,
                    enableSync: enableSync
                };

                localStorage.setItem('cloudSyncConfig', JSON.stringify(newConfig));
                
                // Êõ¥Êñ∞ÂÖ®Â±ÄÈÖçÁΩÆ
                Object.assign(CLOUD_SYNC_CONFIG, newConfig);
                
                alert('‚úÖ ÈÖçÁΩÆ‰øùÂ≠òÊàêÂäüÔºÅ');
                closeConfigModal();
                
                // Â¶ÇÊûúÂêØÁî®‰∫ÜÂêåÊ≠•ÔºåÁ´ãÂç≥Â∞ùËØïÂêåÊ≠•
                if (enableSync && navigator.onLine) {
                    setTimeout(manualSync, 1000);
                }
            };

            // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°ÜÂáΩÊï∞
            window.closeConfigModal = function() {
                document.body.removeChild(modal);
                delete window.saveConfig;
                delete window.closeConfigModal;
            };

            // ‰øùÂ≠òÈÖçÁΩÆÂáΩÊï∞
            window.saveConfig = function() {
                const apiKey = document.getElementById('apiKeyInput').value.trim();
                const binId = document.getElementById('binIdInput').value.trim();
                const enableSync = document.getElementById('enableSyncCheckbox').checked;

                if (enableSync && (!apiKey || !binId)) {
                    alert('ÂêØÁî®ÂêåÊ≠•Êó∂ÂøÖÈ°ªÂ°´ÂÜô API ÂØÜÈí•Âíå Bin IDÔºÅ');
                    return;
                }

                // Êõ¥Êñ∞ÈÖçÁΩÆ
                CLOUD_SYNC_CONFIG.apiKey = apiKey;
                CLOUD_SYNC_CONFIG.binId = binId;
                CLOUD_SYNC_CONFIG.enableSync = enableSync;

                // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
                localStorage.setItem('cloudSyncConfig', JSON.stringify(CLOUD_SYNC_CONFIG));

                closeConfigModal();
                alert('‚úÖ ÈÖçÁΩÆÂ∑≤‰øùÂ≠òÔºÅ');
                
                // Â¶ÇÊûúÂêØÁî®‰∫ÜÂêåÊ≠•ÔºåÁ´ãÂç≥Â∞ùËØïÂêåÊ≠•
                if (enableSync && navigator.onLine) {
                    manualSync();
                }
            };

            // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°ÜÂáΩÊï∞
            window.closeConfigModal = function() {
                document.body.removeChild(modal);
                delete window.saveConfig;
                delete window.closeConfigModal;
            };
        }

        // ÊòæÁ§∫ÂØÜÁ†ÅËæìÂÖ•Ê®°ÊÄÅÊ°Ü
        function showPasswordModal(callback) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 1000;
            `;

            const modalContent = document.createElement('div');
            modalContent.style.cssText = `
                background: white;
                padding: 30px;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                text-align: center;
                min-width: 300px;
            `;

            modalContent.innerHTML = `
                <h3 style="margin-bottom: 20px; color: #333;">üîê ÁÆ°ÁêÜÂëòÈ™åËØÅ</h3>
                <p style="margin-bottom: 15px; color: #666;">ËØ∑ËæìÂÖ•ÁÆ°ÁêÜÂëòÂØÜÁ†ÅÔºö</p>
                <input type="password" id="adminPassword" placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å" 
                       style="width: 100%; padding: 12px; border: 2px solid #ddd; 
                              border-radius: 8px; margin-bottom: 20px; font-size: 16px;">
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button class="btn btn-success" onclick="confirmPassword()">Á°ÆËÆ§</button>
                    <button class="btn btn-danger" onclick="cancelPassword()">ÂèñÊ∂à</button>
                </div>
            `;

            modal.appendChild(modalContent);
            document.body.appendChild(modal);

            // ËÅöÁÑ¶Âà∞ÂØÜÁ†ÅËæìÂÖ•Ê°Ü
            setTimeout(() => {
                document.getElementById('adminPassword').focus();
            }, 100);

            // Á°ÆËÆ§ÂØÜÁ†ÅÂáΩÊï∞
            window.confirmPassword = function() {
                const password = document.getElementById('adminPassword').value;
                if (password === ADMIN_PASSWORD) {
                    document.body.removeChild(modal);
                    delete window.confirmPassword;
                    delete window.cancelPassword;
                    callback(true);
                } else {
                    alert('ÂØÜÁ†ÅÈîôËØØÔºÅ');
                    document.getElementById('adminPassword').value = '';
                    document.getElementById('adminPassword').focus();
                }
            };

            // ÂèñÊ∂àÂØÜÁ†ÅÂáΩÊï∞
            window.cancelPassword = function() {
                document.body.removeChild(modal);
                delete window.confirmPassword;
                delete window.cancelPassword;
                callback(false);
            };

            // ÂõûËΩ¶Á°ÆËÆ§
            document.getElementById('adminPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    confirmPassword();
                }
            });
        }

        // Ê∑ªÂä†Ë∑ëÂèãÔºàÂ∏¶ÊùÉÈôêÈ™åËØÅÔºâ
        function addRunner() {
            const name = document.getElementById('newRunnerName').value.trim();
            const target = parseInt(document.getElementById('newRunnerTarget').value);

            if (!name) {
                alert('ËØ∑ËæìÂÖ•Ë∑ëÂèãÂßìÂêçÔºÅ');
                return;
            }

            if (runners.some(runner => runner.name === name)) {
                alert('ËØ•Ë∑ëÂèãÂ∑≤Â≠òÂú®ÔºÅ');
                return;
            }

            // ÊòæÁ§∫ÂØÜÁ†ÅÈ™åËØÅÊ®°ÊÄÅÊ°Ü
            showPasswordModal(function(isAuthenticated) {
                if (isAuthenticated) {
                    const newRunner = {
                        id: Date.now(),
                        name: name,
                        targetDistance: target,
                        joinDate: new Date().toISOString().split('T')[0]
                    };

                    runners.push(newRunner);
                    localStorage.setItem('runners', JSON.stringify(runners));

                    // ÂêåÊ≠•Âà∞‰∫ëÁ´Ø
                    if (CLOUD_SYNC_CONFIG.enableSync && navigator.onLine) {
                        (async () => {
                            try {
                                await syncToCloud();
                                // ÂêåÊ≠•ÊàêÂäüÂêéÁ´ãÂç≥ÊãâÂèñÊúÄÊñ∞Êï∞ÊçÆ
                                await syncFromCloud();
                                updateAllUI();
                            } catch (error) {
                                console.error('ÂêåÊ≠•Â§±Ë¥•:', error);
                            }
                        })();
                    } else if (CLOUD_SYNC_CONFIG.enableSync) {
                        // Á¶ªÁ∫øÊó∂Ê∑ªÂä†Âà∞ÂæÖÂêåÊ≠•ÈòüÂàó
                        syncStatus.pendingSync.push({
                            type: 'addRunner', 
                            data: newRunner,
                            timestamp: Date.now()
                        });
                        localStorage.setItem('pendingSyncQueue', JSON.stringify(syncStatus.pendingSync));
                    }

                    // Ê∏ÖÁ©∫ËæìÂÖ•
                    document.getElementById('newRunnerName').value = '';

                    // Êõ¥Êñ∞ÁïåÈù¢
                    updateRunnerSelect();
                    updateRunnerList();
                    updateSummaryStats();

                    alert('Ë∑ëÂèãÊ∑ªÂä†ÊàêÂäüÔºÅ');
                } else {
                    alert('Ê∑ªÂä†Ë∑ëÂèãÂ∑≤ÂèñÊ∂à');
                }
            });
        }

        // Êõ¥Êñ∞Ë∑ëÂèãÈÄâÊã©‰∏ãÊãâÊ°Ü
        function updateRunnerSelect() {
            const select = document.getElementById('runnerSelect');
            select.innerHTML = '<option value="">ËØ∑ÈÄâÊã©Ë∑ëÂèã</option>';
            
            runners.forEach(runner => {
                const option = document.createElement('option');
                option.value = runner.id;
                option.textContent = runner.name;
                select.appendChild(option);
            });
        }

        // ËÆ°ÁÆóÈÖçÈÄüÂíåÂç°Ë∑ØÈáåÊ∂àËÄó
        function calculatePaceAndCalories() {
            const distance = parseFloat(document.getElementById('runDistance').value);
            const duration = parseFloat(document.getElementById('runDuration').value);
            const runnerId = document.getElementById('runnerSelect').value;

            if (!runnerId) {
                alert('ËØ∑ÂÖàÈÄâÊã©Ë∑ëÂèãÔºÅ');
                return;
            }

            if (!distance || !duration || distance <= 0 || duration <= 0) {
                alert('ËØ∑ÂÖàÂ°´ÂÜôË∑ëÊ≠•Ë∑ùÁ¶ªÂíåÊó∂ÈïøÔºÅ');
                return;
            }

            // ËÆ°ÁÆóÈÖçÈÄüÔºàÂàÜÈíü/ÂÖ¨ÈáåÔºâ
            const pace = duration / distance;
            const paceMinutes = Math.floor(pace);
            const paceSeconds = Math.round((pace - paceMinutes) * 60);
            const paceString = `${paceMinutes}:${paceSeconds.toString().padStart(2, '0')}`;

            // ‰º∞ÁÆóÂç°Ë∑ØÈáåÊ∂àËÄóÔºàÂü∫‰∫é‰ΩìÈáç65kgÁöÑÁ≤óÁï•‰º∞ÁÆóÔºâ
            const calories = Math.round(distance * duration * 0.1); // ÁÆÄÂåñÁöÑËÆ°ÁÆóÂÖ¨Âºè

            // Â°´ÂÖÖËÆ°ÁÆóÁªìÊûú
            document.getElementById('runPace').value = paceString;
            document.getElementById('runCalories').value = calories;

            alert(`ËÆ°ÁÆóÂÆåÊàêÔºÅ\nÈÖçÈÄüÔºö${paceString} ÂàÜÈíü/ÂÖ¨Èáå\n‰º∞ÁÆóÊ∂àËÄóÔºö${calories} Âç°Ë∑ØÈáå`);
        }

        // Ëß£ÊûêÈÖçÈÄüÂ≠óÁ¨¶‰∏≤ÔºàÂ¶ÇÔºö5:30Ôºâ‰∏∫ÂàÜÈíüÊï∞
        function parsePace(paceString) {
            if (!paceString) return 0;
            const parts = paceString.split(':');
            if (parts.length === 2) {
                const minutes = parseInt(parts[0]) || 0;
                const seconds = parseInt(parts[1]) || 0;
                return minutes + seconds / 60;
            }
            return parseFloat(paceString) || 0;
        }

        // ÊòæÁ§∫ÊâãÂä®ËæìÂÖ•ÊèêÁ§∫ÔºàÂ∑≤ÁßªÈô§ÂõæÁâá‰∏ä‰º†ÂäüËÉΩÔºâ
        function showManualInputHint() {
            alert('üìã ËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï\n\nÊ≠•È™§Ôºö\n1. ÈÄâÊã©Ë∑ëÂèã\n2. ËæìÂÖ•Êó•Êúü\n3. Â°´ÂÜôË∑ùÁ¶ªÂíåÊó∂Èïø\n4. ÁÇπÂáª"Ê∑ªÂä†ËÆ∞ÂΩï"');
        }

        // Â∑≤ÁßªÈô§ÊâÄÊúâOCRÂíåAIËØÜÂà´ÂäüËÉΩ

        // Â∑≤ÁßªÈô§AIËØÜÂà´ÂäüËÉΩÔºàÊõøÊç¢‰∏∫ÊèêÁ§∫Ôºâ
        function performAIRecognition(imageData) {
            alert('üö´ AIÊô∫ËÉΩËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ\n\nÊ≠•È™§Ôºö\n1. ÈÄâÊã©Ë∑ëÂèã\n2. ËæìÂÖ•Êó•Êúü\n3. Â°´ÂÜôË∑ùÁ¶ªÂíåÊó∂Èïø\n4. ÁÇπÂáª"Ê∑ªÂä†ËÆ∞ÂΩï"');
        }

        // Ë∞ÉÁî®SiliconFlow APIÔºàÂ∑≤ÁßªÈô§Ôºâ
        function callSiliconFlowAPI(base64Image, modal, timeoutId) {
            alert('üö´ AIËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ');
        }

        // Â§ÑÁêÜAIËØÜÂà´ÁªìÊûúÔºàÂ∑≤ÁßªÈô§Ôºâ
        function processAIResult(aiData) {
            alert('üö´ AIËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ');
        }

        // ÊòæÁ§∫AIËØÜÂà´ÁªìÊûúÔºàÂ∑≤ÁßªÈô§Ôºâ
        function showAIResult(data, rawData) {
            alert('üö´ AIËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ');
        }

        // ‰ªéAIË°®ÂçïÂ∫îÁî®Êï∞ÊçÆÔºàÂ∑≤ÁßªÈô§Ôºâ
        function applyAIDataFromForm() {
            alert('üö´ AIËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ');
        }

        // ‰ªéAIÁªìÊûúÈáçËØï‰º†ÁªüOCRÔºàÂ∑≤ÁßªÈô§Ôºâ
        function retryWithTraditionalOCR() {
            alert('üö´ OCRËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ');
        }

        // ‰ªéAIÁªìÊûúÂàáÊç¢Âà∞ÊâãÂä®ËæìÂÖ•ÔºàÂ∑≤ÁßªÈô§Ôºâ
        function showManualInputModalFromAI() {
            alert('üö´ AIËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ');
        }
        
        // ÁîüÊàêÊµãËØïÊà™ÂõæÔºàÂ∑≤ÁßªÈô§Ôºâ
        function generateTestScreenshot() {
            alert('üö´ ÊµãËØïÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ');
        }

        // ÊâßË°åAIËØÜÂà´ÔºàÂ∑≤ÁßªÈô§Ôºâ
        function performAIRecognition(imageData) {
            alert('üö´ AIËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ');
        }

        // Ë∞ÉÁî®SiliconFlow APIÔºàÂ∑≤ÁßªÈô§Ôºâ
        function callSiliconFlowAPI(base64Image, modal, timeoutId) {
            alert('üö´ AIËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ');
        }

        // Â§ÑÁêÜAIËØÜÂà´ÁªìÊûúÔºàÂ∑≤ÁßªÈô§Ôºâ
        function processAIResult(aiData) {
            alert('üö´ AIËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ');
        }

        // ÊòæÁ§∫AIËØÜÂà´ÁªìÊûúÔºàÂ∑≤ÁßªÈô§Ôºâ
        function showAIResult(data, rawData) {
            alert('üö´ AIËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ');
        }

        // ‰ªéAIË°®ÂçïÂ∫îÁî®Êï∞ÊçÆÔºàÂ∑≤ÁßªÈô§Ôºâ
        function applyAIDataFromForm() {
            alert('üö´ AIËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ');
        }

        // ‰ªéAIÁªìÊûúÈáçËØï‰º†ÁªüOCRÔºàÂ∑≤ÁßªÈô§Ôºâ
        function retryWithTraditionalOCR() {
            alert('üö´ OCRËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ');
        }

        // ‰ªéAIÁªìÊûúÂàáÊç¢Âà∞ÊâãÂä®ËæìÂÖ•ÔºàÂ∑≤ÁßªÈô§Ôºâ
        function showManualInputModalFromAI() {
            alert('üö´ AIËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§\n\nËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï„ÄÇ');
        }
        
        // ÁîüÊàêÊµãËØïË∑ëÊ≠•Êà™Âõæ - Â∑≤ÁßªÈô§
        function generateTestScreenshot() {
            alert('ÊµãËØïÊà™ÂõæÂäüËÉΩÂ∑≤ÁßªÈô§ÔºåËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï');
        }

        // ÊòæÁ§∫ÊâãÂä®ËæìÂÖ•Ê®°ÊÄÅÊ°ÜÔºàOCRÂ§±Ë¥•Êó∂‰ΩøÁî®Ôºâ- Â∑≤ÁßªÈô§
        function showManualInputModal() {
            alert('OCRËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§ÔºåËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï');
        }

        // Â∫îÁî®ÊâãÂä®ËæìÂÖ•ÁöÑÊï∞ÊçÆ - Â∑≤ÁßªÈô§
        function applyManualData() {
            alert('OCRËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§ÔºåËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï');
        }

        // Áõ¥Êé•ÊòæÁ§∫ÊâãÂä®ËæìÂÖ•ÁïåÈù¢ÔºàË∑≥ËøáOCRÔºâ- Â∑≤ÁßªÈô§
        function directManualInput() {
            alert('OCRËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§ÔºåËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï');
        }

        // ÂàõÂª∫Ê®°ÊÄÅÊ°Ü
        function createModal(content) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.cssText = `
                position: fixed;
                top: 0; left: 0;
                width: 100%; height: 100%;
                background: rgba(0,0,0,.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 2000;
            `;
            modal.appendChild(content);
            return modal;
        }

        // Â§ÑÁêÜOCRËØÜÂà´ÁªìÊûú
        function processOCRResult(text) {
            console.log('OCRËØÜÂà´ÁªìÊûúÔºö', text);
            
            // ÊèêÂèñË∑ëÊ≠•Êï∞ÊçÆÁöÑÊ≠£ÂàôË°®ËææÂºè - Â¢ûÂº∫ÁâàÊú¨
            const patterns = {
                // Ë∑ùÁ¶ªÔºöÊîØÊåÅÂ§öÁßçÊ†ºÂºèÔºåÂåÖÊã¨Â∞èÊï∞ÁÇπ
                distance: /(\d+\.?\d*)\s*(ÂÖ¨Èáå|km|ÂçÉÁ±≥|KM|ÂÖ¨Èáå|km)/gi,
                // Êó∂ÈïøÔºöÊîØÊåÅÂàÜÈíü„ÄÅÂ∞èÊó∂ÂàÜÈíüÊ†ºÂºè
                duration: /(\d+)\s*(ÂàÜÈíü|ÂàÜ|ÂàÜÈíü|min|m)|(\d+):(\d+)\s*(Â∞èÊó∂|Êó∂|h)/gi,
                // ÈÖçÈÄüÔºöÊîØÊåÅÂàÜ:ÁßíÊ†ºÂºèÔºåÂèØÂåÖÂê´ÂàÜÈíü/ÈÖçÈÄüÁ≠âÂ≠óÊ†∑
                pace: /(\d+):(\d+)(?:\s*(ÂàÜÈíü|ÈÖçÈÄü|pace|min\/km))?/gi,
                // Âç°Ë∑ØÈáåÔºöÊîØÊåÅÂ§öÁßçË°®Ëø∞
                calories: /(\d+)\s*(Âç°Ë∑ØÈáå|Âç°|ÁÉ≠Èáè|cal|kcal|ÂçÉÂç°)/gi,
                // Êó•ÊúüÔºöÊîØÊåÅÂ§öÁßçÊó•ÊúüÊ†ºÂºè
                date: /(\d{4})[Âπ¥\/-](\d{1,2})[Êúà\/-](\d{1,2})[Êó•\s]?|(\d{1,2})[Êúà\/-](\d{1,2})[Êó•\s]?|(\d{4})-(\d{2})-(\d{2})/g
            };

            const extractedData = {};
            
            // ÊèêÂèñË∑ùÁ¶ª - ÂèñÁ¨¨‰∏Ä‰∏™ÂåπÈÖçÁöÑÊï∞Â≠ó
            const distanceMatches = [...text.matchAll(patterns.distance)];
            if (distanceMatches.length > 0) {
                extractedData.distance = parseFloat(distanceMatches[0][1]);
            }
            
            // ÊèêÂèñÊó∂Èïø - ‰ºòÂÖàÂåπÈÖçÂàÜÈíüÊ†ºÂºèÔºåÂÖ∂Ê¨°ÂåπÈÖçÂ∞èÊó∂:ÂàÜÈíüÊ†ºÂºè
            const durationMatches = [...text.matchAll(patterns.duration)];
            if (durationMatches.length > 0) {
                const match = durationMatches[0];
                if (match[1]) {
                    // Á∫ØÂàÜÈíüÊ†ºÂºè
                    extractedData.duration = parseInt(match[1]);
                } else if (match[3] && match[4]) {
                    // Â∞èÊó∂:ÂàÜÈíüÊ†ºÂºèÔºåËΩ¨Êç¢‰∏∫ÊÄªÂàÜÈíüÊï∞
                    const hours = parseInt(match[3]) || 0;
                    const minutes = parseInt(match[4]) || 0;
                    extractedData.duration = hours * 60 + minutes;
                }
            }
            
            // ÊèêÂèñÈÖçÈÄü - ÂèñÁ¨¨‰∏Ä‰∏™ÂåπÈÖçÁöÑÈÖçÈÄü
            const paceMatches = [...text.matchAll(patterns.pace)];
            if (paceMatches.length > 0) {
                const match = paceMatches[0];
                extractedData.pace = `${match[1]}:${match[2].padStart(2, '0')}`;
            }
            
            // ÊèêÂèñÂç°Ë∑ØÈáå - ÂèñÁ¨¨‰∏Ä‰∏™ÂåπÈÖçÁöÑÊï∞Â≠ó
            const caloriesMatches = [...text.matchAll(patterns.calories)];
            if (caloriesMatches.length > 0) {
                extractedData.calories = parseInt(caloriesMatches[0][1]);
            }
            
            // ÊèêÂèñÊó•Êúü - ÊîØÊåÅÂ§öÁßçÊ†ºÂºè
            const dateMatches = [...text.matchAll(patterns.date)];
            if (dateMatches.length > 0) {
                const match = dateMatches[0];
                let year, month, day;
                
                if (match[1] && match[2] && match[3]) {
                    // 2024Âπ¥1Êúà15Êó• Êàñ 2024-1-15 Ê†ºÂºè
                    year = match[1];
                    month = match[2].padStart(2, '0');
                    day = match[3].padStart(2, '0');
                } else if (match[4] && match[5]) {
                    // 1Êúà15Êó• Ê†ºÂºèÔºåÈúÄË¶ÅË°•ÂÖ®Âπ¥‰ªΩ
                    year = new Date().getFullYear();
                    month = match[4].padStart(2, '0');
                    day = match[5].padStart(2, '0');
                } else if (match[6] && match[7] && match[8]) {
                    // 2024-01-15 Ê†ºÂºè
                    year = match[6];
                    month = match[7];
                    day = match[8];
                }
                
                if (year && month && day) {
                    extractedData.date = `${year}-${month}-${day}`;
                }
            }

            // Â¶ÇÊûúÊ≤°ÊúâËØÜÂà´Âà∞Êó•ÊúüÔºå‰ΩøÁî®ÂΩìÂâçÊó•Êúü‰Ωú‰∏∫ÈªòËÆ§ÂÄº
            if (!extractedData.date) {
                extractedData.date = new Date().toISOString().split('T')[0];
            }

            showOCRResult(extractedData, text);
        }

        // ÊòæÁ§∫OCRËØÜÂà´ÁªìÊûú - Â∑≤ÁßªÈô§
        function showOCRResult(data, rawText) {
            alert('OCRËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§ÔºåËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï');
        }

        // ÂÖ≥Èó≠OCRÁªìÊûúÂºπÁ™ó - Â∑≤ÁßªÈô§
        function closeOCRModal() {
            // ÂäüËÉΩÂ∑≤ÁßªÈô§
        }

        // ‰ªéOCRË°®ÂçïÂ∫îÁî®Êï∞ÊçÆ - Â∑≤ÁßªÈô§
        function applyOCRDataFromForm() {
            alert('OCRËØÜÂà´ÂäüËÉΩÂ∑≤ÁßªÈô§ÔºåËØ∑‰ΩøÁî®Â∑¶‰æßË°®ÂçïÊâãÂä®Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï');
        }

        // Ê∑ªÂä†Ë∑ëÊ≠•ËÆ∞ÂΩï
        function addRecord() {
            const runnerId = document.getElementById('runnerSelect').value;
            const date = document.getElementById('runDate').value;
            const distance = parseFloat(document.getElementById('runDistance').value);
            const duration = parseFloat(document.getElementById('runDuration').value);
            const pace = document.getElementById('runPace').value;
            const calories = parseInt(document.getElementById('runCalories').value) || 0;

            if (!runnerId || !date || !distance || distance <= 0) {
                alert('ËØ∑Â°´ÂÜôÂÆåÊï¥ÁöÑË∑ëÊ≠•ËÆ∞ÂΩï‰ø°ÊÅØÔºàËá≥Â∞ëÂåÖÂê´Ë∑ëÂèã„ÄÅÊó•Êúü„ÄÅË∑ùÁ¶ªÔºâÔºÅ');
                return;
            }

            // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÊúâÂêå‰∏ÄÂ§©ÁöÑËÆ∞ÂΩï
            const existingRecord = records.find(r => 
                r.runnerId == runnerId && r.date === date
            );

            const recordData = {
                id: existingRecord ? existingRecord.id : Date.now(),
                runnerId: parseInt(runnerId),
                date: date,
                distance: distance,
                duration: duration || null,
                pace: pace || null,
                calories: calories || null
            };

            if (existingRecord) {
                if (confirm('ËØ•Ë∑ëÂèã‰ªäÂ§©Â∑≤ÊúâË∑ëÊ≠•ËÆ∞ÂΩïÔºåÊòØÂê¶Êõ¥Êñ∞ËÆ∞ÂΩïÔºü')) {
                    const index = records.findIndex(r => r.id === existingRecord.id);
                    records[index] = recordData;
                } else {
                    return;
                }
            } else {
                records.push(recordData);
            }

            localStorage.setItem('runningRecords', JSON.stringify(records));

            // ÂêåÊ≠•Âà∞‰∫ëÁ´Ø
            if (CLOUD_SYNC_CONFIG.enableSync && navigator.onLine) {
                (async () => {
                    try {
                        await syncToCloud();
                        // ÂêåÊ≠•ÊàêÂäüÂêéÁ´ãÂç≥ÊãâÂèñÊúÄÊñ∞Êï∞ÊçÆ
                        await syncFromCloud();
                        updateAllUI();
                    } catch (error) {
                        console.error('ÂêåÊ≠•Â§±Ë¥•:', error);
                    }
                })();
            } else if (CLOUD_SYNC_CONFIG.enableSync) {
                // Á¶ªÁ∫øÊó∂Ê∑ªÂä†Âà∞ÂæÖÂêåÊ≠•ÈòüÂàó
                syncStatus.pendingSync.push({
                    type: 'addRecord', 
                    data: recordData,
                    timestamp: Date.now()
                });
                localStorage.setItem('pendingSyncQueue', JSON.stringify(syncStatus.pendingSync));
            }

            // Ê∏ÖÁ©∫ËæìÂÖ•
            document.getElementById('runDistance').value = '';
            document.getElementById('runDuration').value = '';
            document.getElementById('runPace').value = '';
            document.getElementById('runCalories').value = '';

            // Êõ¥Êñ∞ÁïåÈù¢
            updateRunnerList();
            updateRecordsTable();
            updateSummaryStats();

            alert('Ë∑ëÊ≠•ËÆ∞ÂΩïÊ∑ªÂä†ÊàêÂäüÔºÅ');
        }

        // Ëé∑ÂèñÂë®ÂºÄÂßãÊó•Êúü
        function getWeekStart(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1); // Ë∞ÉÊï¥‰∏∫Âë®‰∏ÄÂºÄÂßã
            return new Date(d.setDate(diff));
        }

        // Ëé∑ÂèñÂë®ÁªìÊùüÊó•Êúü
        function getWeekEnd(date) {
            const weekStart = getWeekStart(date);
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6);
            return weekEnd;
        }

        // Ëé∑ÂèñË∑ëÂèãÊú¨Âë®ÁªüËÆ°
        function getRunnerWeekStats(runnerId, weekStart) {
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6);

            const weekRecords = records.filter(r => {
                const recordDate = new Date(r.date);
                return r.runnerId == runnerId && 
                       recordDate >= weekStart && 
                       recordDate <= weekEnd;
            });

            const totalDistance = weekRecords.reduce((sum, r) => sum + r.distance, 0);
            const runDays = weekRecords.length;
            const qualifiedRuns = weekRecords.filter(r => r.distance >= 5).length;
            
            // ËÆ°ÁÆóÂπ≥ÂùáÈÖçÈÄü
            const paceRecords = weekRecords.filter(r => r.pace);
            let avgPace = null;
            if (paceRecords.length > 0) {
                const totalPaceMinutes = paceRecords.reduce((sum, r) => {
                    return sum + parsePace(r.pace);
                }, 0);
                const avgPaceMinutes = totalPaceMinutes / paceRecords.length;
                const avgMinutes = Math.floor(avgPaceMinutes);
                const avgSeconds = Math.round((avgPaceMinutes - avgMinutes) * 60);
                avgPace = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            }
            
            // ËÆ°ÁÆóÊÄªÊ∂àËÄóÂç°Ë∑ØÈáå
            const totalCalories = weekRecords.reduce((sum, r) => sum + (r.calories || 0), 0);

            return {
                totalDistance: totalDistance,
                runDays: runDays,
                qualifiedRuns: qualifiedRuns,
                records: weekRecords,
                avgPace: avgPace,
                totalCalories: totalCalories > 0 ? totalCalories : null
            };
        }

        // Êõ¥Êñ∞Ë∑ëÂèãÂàóË°®
        function updateRunnerList() {
            const container = document.getElementById('runnerList');
            container.innerHTML = '';

            // Êõ¥Êñ∞ÊâãÂä®Ê∑ªÂä†Âå∫ÂüüÁöÑË∑ëÂèãÈÄâÊã©
            const runnerSelect = document.getElementById('runnerSelect');
            runnerSelect.innerHTML = '<option value="">ËØ∑ÈÄâÊã©Ë∑ëÂèã</option>';
            
            // OCRÂå∫ÂüüÁöÑË∑ëÂèãÈÄâÊã©Â∑≤ÁßªÈô§
            // const runnerSelectOCR = document.getElementById('runnerSelectOCR');
            // runnerSelectOCR.innerHTML = '<option value="">ËØ∑ÈÄâÊã©Ë∑ëÂèã</option>';

            if (runners.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">ÊöÇÊó†Ë∑ëÂèãÔºåËØ∑ÂÖàÊ∑ªÂä†Ë∑ëÂèã</p>';
                return;
            }

            // Â°´ÂÖÖË∑ëÂèãÈÄâÊã©‰∏ãÊãâÊ°Ü
            runners.forEach(runner => {
                const option1 = document.createElement('option');
                option1.value = runner.id;
                option1.textContent = runner.name;
                runnerSelect.appendChild(option1);
                
                // OCRÂå∫ÂüüÁöÑË∑ëÂèãÈÄâÊã©Â∑≤ÁßªÈô§
                // const option2 = document.createElement('option');
                // option2.value = runner.id;
                // option2.textContent = runner.name;
                // runnerSelectOCR.appendChild(option2);
            });

            const weekStart = getWeekStart(new Date());

            runners.forEach(runner => {
                const stats = getRunnerWeekStats(runner.id, weekStart);
                const isComplete = stats.qualifiedRuns >= 3 && stats.totalDistance >= runner.targetDistance;
                const isWarning = stats.qualifiedRuns < 3 || stats.totalDistance < runner.targetDistance;

                const card = document.createElement('div');
                card.className = `runner-card ${isComplete ? '' : 'incomplete'} ${isWarning ? 'warning' : ''}`;

                const progressPercent = Math.min((stats.totalDistance / runner.targetDistance) * 100, 100);

                card.innerHTML = `
                    <div class="runner-name">${runner.name}</div>
                    <div class="runner-target">ÁõÆÊ†áÔºö${runner.targetDistance}ÂÖ¨Èáå/Âë® | Â∑≤ÂÆåÊàêÔºö${stats.totalDistance.toFixed(1)}ÂÖ¨Èáå</div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progressPercent}%">
                            ${progressPercent.toFixed(0)}%
                        </div>
                    </div>
                    <div style="font-size: 0.9em; margin-bottom: 10px;">
                        Êú¨Âë®Ë∑ëÊ≠•Ôºö${stats.runDays}Ê¨° | ËææÊ†áÔºö${stats.qualifiedRuns}Ê¨°
                        ${stats.avgPace ? `| Âπ≥ÂùáÈÖçÈÄüÔºö${stats.avgPace}` : ''}
                        ${stats.totalCalories ? `| ÊÄªÊ∂àËÄóÔºö${stats.totalCalories}Âç°` : ''}
                    </div>
                    <div class="week-stats">
                        ${getWeekDaysHTML(stats.records, weekStart)}
                    </div>
                `;

                container.appendChild(card);
            });
        }

        // Ëé∑ÂèñÂë®ÊòæÁ§∫HTML
        function getWeekDaysHTML(records, weekStart) {
            const days = ['‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠', 'Êó•'];
            let html = '';

            for (let i = 0; i < 7; i++) {
                const currentDate = new Date(weekStart);
                currentDate.setDate(weekStart.getDate() + i);
                const dateStr = currentDate.toISOString().split('T')[0];
                
                const dayRecord = records.find(r => r.date === dateStr);
                const hasRecord = !!dayRecord;
                const isQualified = hasRecord && dayRecord.distance >= 5;

                html += `
                    <div class="day-stat ${hasRecord ? (isQualified ? 'completed' : 'incomplete') : ''}">
                        <div>${days[i]}</div>
                        ${hasRecord ? `<div>${dayRecord.distance}km</div>` : '<div>-</div>'}
                        ${hasRecord && dayRecord.pace ? `<div>${dayRecord.pace}</div>` : ''}
                    </div>
                `;
            }

            return html;
        }

        // Êõ¥Êñ∞ËÆ∞ÂΩïË°®Ê†º
        function updateRecordsTable() {
            const tbody = document.getElementById('recordsBody');
            tbody.innerHTML = '';

            if (records.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: #666;">ÊöÇÊó†Ë∑ëÊ≠•ËÆ∞ÂΩï</td></tr>';
                return;
            }

            // ÊåâÊó•ÊúüÂÄíÂ∫èÊéíÂàó
            const sortedRecords = [...records].sort((a, b) => new Date(b.date) - new Date(a.date));

            sortedRecords.forEach(record => {
                const runner = runners.find(r => r.id == record.runnerId);
                if (!runner) return;

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${runner.name}</td>
                    <td>${record.date}</td>
                    <td>${record.distance}</td>
                    <td>${record.duration || '-'}</td>
                    <td>${record.pace || '-'}</td>
                    <td>${record.calories || '-'}</td>
                    <td>
                        <button class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;" 
                                onclick="deleteRecord(${record.id})">Âà†Èô§</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Âà†Èô§ËÆ∞ÂΩï
        function deleteRecord(recordId) {
            if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÊù°ËÆ∞ÂΩïÂêóÔºü')) {
                records = records.filter(r => r.id !== recordId);
                localStorage.setItem('runningRecords', JSON.stringify(records));
                
                updateRunnerList();
                updateRecordsTable();
                updateSummaryStats();
            }
        }

        // Êõ¥Êñ∞ÁªüËÆ°Ê¶ÇËßà
        function updateSummaryStats() {
            const container = document.getElementById('summaryStats');
            const penaltyContainer = document.getElementById('penaltyInfo');
            
            const weekStart = getWeekStart(new Date());
            let totalRunners = runners.length;
            let completedRunners = 0;
            let totalPenalties = 0;
            let completedDistance = 0;
            let totalDuration = 0;
            let totalCalories = 0;
            let avgPaceRecords = [];

            runners.forEach(runner => {
                const stats = getRunnerWeekStats(runner.id, weekStart);
                const isComplete = stats.qualifiedRuns >= 3 && stats.totalDistance >= runner.targetDistance;
                
                if (isComplete) {
                    completedRunners++;
                } else {
                    totalPenalties += 500;
                }
                
                completedDistance += stats.totalDistance;
                totalDuration += stats.records.reduce((sum, r) => sum + (r.duration || 0), 0);
                totalCalories += stats.totalCalories || 0;
                
                // Êî∂ÈõÜÊâÄÊúâÈÖçÈÄüÊï∞ÊçÆ
                stats.records.forEach(r => {
                    if (r.pace) {
                        avgPaceRecords.push(parsePace(r.pace));
                    }
                });
            });

            const rewardPerPerson = completedRunners > 0 ? totalPenalties / completedRunners : 0;
            
            // ËÆ°ÁÆóÂπ≥ÂùáÈÖçÈÄü
            let avgPace = null;
            if (avgPaceRecords.length > 0) {
                const avgPaceMinutes = avgPaceRecords.reduce((sum, pace) => sum + pace, 0) / avgPaceRecords.length;
                const avgMinutes = Math.floor(avgPaceMinutes);
                const avgSeconds = Math.round((avgPaceMinutes - avgMinutes) * 60);
                avgPace = `${avgMinutes}:${avgSeconds.toString().padStart(2, '0')}`;
            }

            container.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${totalRunners}</div>
                    <div class="stat-label">ÊÄªË∑ëÂèãÊï∞</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${completedRunners}</div>
                    <div class="stat-label">Êú¨Âë®ËææÊ†á</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${completedDistance.toFixed(1)}</div>
                    <div class="stat-label">Êú¨Âë®ÊÄªÈáåÁ®ã(km)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${Math.round(totalDuration)}</div>
                    <div class="stat-label">Êú¨Âë®ÊÄªÊó∂Èïø(ÂàÜ)</div>
                </div>
                ${avgPace ? `
                <div class="stat-card">
                    <div class="stat-number">${avgPace}</div>
                    <div class="stat-label">Âπ≥ÂùáÈÖçÈÄü</div>
                </div>
                ` : ''}
                ${totalCalories > 0 ? `
                <div class="stat-card">
                    <div class="stat-number">${Math.round(totalCalories)}</div>
                    <div class="stat-label">ÊÄªÊ∂àËÄó(Âç°)</div>
                </div>
                ` : ''}
                <div class="stat-card">
                    <div class="stat-number">${totalPenalties}</div>
                    <div class="stat-label">Êú¨Âë®ÁΩöÊ¨æÊÄªÈ¢ù(ÂÖÉ)</div>
                </div>
            `;

            if (totalPenalties > 0 && completedRunners > 0) {
                penaltyContainer.innerHTML = `
                    <h3>üèÜ Êú¨Âë®Â•ñÂä±ÂàÜÈÖç</h3>
                    <p>ËææÊ†áË∑ëÂèãÊØè‰∫∫ÂèØËé∑ÂæóÂ•ñÂä±Ôºö${rewardPerPerson.toFixed(2)}ÂÖÉ</p>
                    <p>Êú™ËææÊ†áË∑ëÂèãÈúÄË¶ÅÁº¥Á∫≥ÁΩöÊ¨æÔºö500ÂÖÉ</p>
                `;
            } else if (totalPenalties > 0) {
                penaltyContainer.innerHTML = `
                    <h3>‚ö†Ô∏è Êú¨Âë®Êó†ËææÊ†áË∑ëÂèã</h3>
                    <p>ÁΩöÊ¨æÊÄªÈ¢ùÔºö${totalPenalties}ÂÖÉÂ∞ÜÁ¥ØÁßØÂà∞‰∏ãÂë®</p>
                `;
            } else {
                penaltyContainer.innerHTML = `
                    <h3>üéâ Êú¨Âë®ÂÖ®ÂëòËææÊ†áÔºÅ</h3>
                    <p>ÊâÄÊúâË∑ëÂèãÈÉΩÂÆåÊàê‰∫ÜÊú¨Âë®ÁõÆÊ†áÔºåÂ§™Ê£í‰∫ÜÔºÅ</p>
                `;
            }
        }

        // ÂØºÂá∫Êï∞ÊçÆ
        function exportData() {
            const data = {
                runners: runners,
                records: records,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Ë∑ëÊ≠•Êï∞ÊçÆ_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Êõ¥Êñ∞ÂéÜÂè≤ËÆ∞ÂΩïÊòæÁ§∫
        function updateWeekHistory() {
            const weekStart = getWeekStart(new Date());
            weekStart.setDate(weekStart.getDate() + (currentWeekOffset * 7));
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6);
            
            // Êõ¥Êñ∞Âë®ÊòæÁ§∫
            const weekDisplay = document.getElementById('currentWeekDisplay');
            const weekRange = `${weekStart.getMonth() + 1}Êúà${weekStart.getDate()}Êó• - ${weekEnd.getMonth() + 1}Êúà${weekEnd.getDate()}Êó•`;
            const yearDisplay = weekStart.getFullYear() !== new Date().getFullYear() ? `${weekStart.getFullYear()}Âπ¥` : '';
            weekDisplay.innerHTML = `<strong>${yearDisplay}${weekRange}</strong>`;
            
            // Ëé∑ÂèñÊú¨Âë®ÁªüËÆ°
            const weekStats = [];
            let totalDistance = 0;
            let totalRuns = 0;
            let qualifiedRunners = 0;
            
            runners.forEach(runner => {
                const stats = getRunnerWeekStats(runner.id, weekStart);
                const isComplete = stats.qualifiedRuns >= 3 && stats.totalDistance >= runner.targetDistance;
                
                weekStats.push({
                    runner: runner,
                    stats: stats,
                    isComplete: isComplete
                });
                
                totalDistance += stats.totalDistance;
                totalRuns += stats.records.length;
                if (isComplete) qualifiedRunners++;
            });
            
            // Êõ¥Êñ∞ÁªüËÆ°Ê¶ÇËßà
            updateWeekHistoryStats(totalDistance, totalRuns, qualifiedRunners, runners.length);
            
            // Êõ¥Êñ∞ËØ¶ÁªÜËÆ∞ÂΩï
            updateWeekHistoryDetails(weekStats);
        }
        
        // Êõ¥Êñ∞ÂéÜÂè≤ËÆ∞ÂΩïÁªüËÆ°Ê¶ÇËßà
        function updateWeekHistoryStats(totalDistance, totalRuns, qualifiedRunners, totalRunners) {
            const container = document.getElementById('weekHistoryStats');
            
            container.innerHTML = `
                <div class="week-history-card">
                    <h4>ÊÄªË∑ëÂèãÊï∞</h4>
                    <div class="stat-value">${totalRunners}</div>
                    <div class="stat-label">‰ΩçË∑ëÂèã</div>
                </div>
                <div class="week-history-card">
                    <h4>ËææÊ†á‰∫∫Êï∞</h4>
                    <div class="stat-value">${qualifiedRunners}</div>
                    <div class="stat-label">‰ΩçËææÊ†á</div>
                </div>
                <div class="week-history-card">
                    <h4>ÊÄªË∑ëÊ≠•Ê¨°Êï∞</h4>
                    <div class="stat-value">${totalRuns}</div>
                    <div class="stat-label">Ê¨°Ë∑ëÊ≠•</div>
                </div>
                <div class="week-history-card">
                    <h4>ÊÄªË∑ëÊ≠•Ë∑ùÁ¶ª</h4>
                    <div class="stat-value">${totalDistance.toFixed(1)}</div>
                    <div class="stat-label">ÂÖ¨Èáå</div>
                </div>
            `;
        }
        
        // Êõ¥Êñ∞ÂéÜÂè≤ËÆ∞ÂΩïËØ¶ÁªÜ‰ø°ÊÅØ
        function updateWeekHistoryDetails(weekStats) {
            const container = document.getElementById('weekHistoryDetails');
            
            if (weekStats.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">ÊöÇÊó†Ë∑ëÂèãÊï∞ÊçÆ</div>';
                return;
            }
            
            // ÊåâËææÊ†áÊÉÖÂÜµÊéíÂ∫è
            weekStats.sort((a, b) => {
                if (a.isComplete && !b.isComplete) return -1;
                if (!a.isComplete && b.isComplete) return 1;
                return b.stats.totalDistance - a.stats.totalDistance;
            });
            
            container.innerHTML = weekStats.map(item => {
                const statusClass = item.isComplete ? 'status-complete' : 'status-incomplete';
                const statusText = item.isComplete ? '‚úÖ ËææÊ†á' : '‚ùå Êú™ËææÊ†á';
                const completionRate = Math.min((item.stats.totalDistance / item.runner.targetDistance * 100), 100).toFixed(1);
                
                return `
                    <div class="week-history-runner">
                        <div class="week-history-runner-name">
                            ${item.runner.name}
                            <span class="${statusClass}" style="margin-left: 10px;">${statusText}</span>
                        </div>
                        <div class="week-history-runner-stats">
                            <div class="week-history-runner-stat">
                                <div class="value">${item.stats.totalDistance.toFixed(1)}</div>
                                <div class="label">ÊÄªË∑ùÁ¶ª(km)</div>
                            </div>
                            <div class="week-history-runner-stat">
                                <div class="value">${item.stats.runDays}</div>
                                <div class="label">Ë∑ëÊ≠•Â§©Êï∞</div>
                            </div>
                            <div class="week-history-runner-stat">
                                <div class="value">${item.stats.qualifiedRuns}</div>
                                <div class="label">ËææÊ†áÊ¨°Êï∞</div>
                            </div>
                            <div class="week-history-runner-stat">
                                <div class="value">${completionRate}%</div>
                                <div class="label">ÂÆåÊàêÁéá</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // ÂàáÊç¢Âë®
        function changeWeek(direction) {
            currentWeekOffset += direction;
            updateWeekHistory();
        }
        
        // ËøîÂõûÊú¨Âë®
        function goToCurrentWeek() {
            currentWeekOffset = 0;
            updateWeekHistory();
        }

        // Ê∑ªÂä†ÂØºÂá∫ÊåâÈíÆ
        document.addEventListener('DOMContentLoaded', function() {
            const header = document.querySelector('.header');
            const exportBtn = document.createElement('button');
            exportBtn.className = 'btn btn-warning';
            exportBtn.textContent = 'ÂØºÂá∫Êï∞ÊçÆ';
            exportBtn.onclick = exportData;
            exportBtn.style.cssText = 'position: absolute; top: 20px; right: 20px;';
            header.appendChild(exportBtn);
        });

        // ÂæÆ‰ø°ÊµèËßàÂô®Ê£ÄÊµãÂíåÈÄÇÈÖç
        function detectWeChatBrowser() {
            const ua = navigator.userAgent.toLowerCase();
            const isWeChat = /micromessenger/i.test(ua);
            
            if (isWeChat) {
                console.log('Ê£ÄÊµãÂà∞ÂæÆ‰ø°ÊµèËßàÂô®ÔºåÂ∫îÁî®ÂæÆ‰ø°‰∏ìÁî®‰ºòÂåñ');
                
                // Ê∑ªÂä†ÂæÆ‰ø°‰ºòÂåñÁ±ª
                document.body.classList.add('wechat-optimized');
                document.documentElement.classList.add('wechat-safe-area');
                
                // ÂæÆ‰ø°ÊµèËßàÂô®ÊªöÂä®‰ºòÂåñ
                document.querySelector('.container').classList.add('wechat-scroll');
                
                // ‰∏∫ÊâÄÊúâÊåâÈíÆÂíåÂèØÁÇπÂáªÂÖÉÁ¥†Ê∑ªÂä†ÂæÆ‰ø°ÁÇπÂáª‰ºòÂåñ
                const clickableElements = document.querySelectorAll('.btn, .runner-card, .day-stat, .week-history-card');
                clickableElements.forEach(element => {
                    element.classList.add('wechat-tap');
                });
                
                // ÂæÆ‰ø°ÊµèËßàÂô®Â≠ó‰Ωì‰ºòÂåñ
                document.body.style.fontFamily = '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"';
                
                // ÂæÆ‰ø°ÊµèËßàÂô®ËßÜÂè£ÈÄÇÈÖç
                const viewport = document.querySelector('meta[name="viewport"]');
                if (viewport) {
                    viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover');
                }
                
                // ÂæÆ‰ø°ÊµèËßàÂô®ÂÆâÂÖ®Âå∫ÂüüÈÄÇÈÖç
                const safeAreaStyle = document.createElement('style');
                safeAreaStyle.textContent = `
                    .wechat-safe-area {
                        padding-top: constant(safe-area-inset-top);
                        padding-top: env(safe-area-inset-top);
                        padding-bottom: constant(safe-area-inset-bottom);
                        padding-bottom: env(safe-area-inset-bottom);
                        padding-left: constant(safe-area-inset-left);
                        padding-left: env(safe-area-inset-left);
                        padding-right: constant(safe-area-inset-right);
                        padding-right: env(safe-area-inset-right);
                    }
                `;
                document.head.appendChild(safeAreaStyle);
                
                // ÂæÆ‰ø°ÊµèËßàÂô®ËæìÂÖ•Ê°Ü‰ºòÂåñ
                const inputs = document.querySelectorAll('input, select');
                inputs.forEach(input => {
                    input.style.fontSize = '16px'; // Èò≤Ê≠¢ÂæÆ‰ø°ÊµèËßàÂô®Áº©Êîæ
                    input.addEventListener('focus', function() {
                        document.body.style.position = 'fixed';
                        document.body.style.width = '100%';
                    });
                    input.addEventListener('blur', function() {
                        document.body.style.position = '';
                        document.body.style.width = '';
                    });
                });
                
                console.log('ÂæÆ‰ø°ÊµèËßàÂô®‰ºòÂåñÂ∑≤ÂÆåÊàê');
            }
            
            return isWeChat;
        }
        
        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÊâßË°åÂæÆ‰ø°Ê£ÄÊµã
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(detectWeChatBrowser, 100);
            
            // ÂàùÂßãÂåñÂÆûÊó∂ÂêåÊ≠•ÁÆ°ÁêÜÂô®
            realtimeSyncManager = new RealtimeSyncManager();
            
            // Â§ÑÁêÜÂæÖÂêåÊ≠•ÈòüÂàó
            if (syncStatus.pendingSync.length > 0 && navigator.onLine && CLOUD_SYNC_CONFIG.enableSync) {
                setTimeout(processPendingSync, 2000); // 2ÁßíÂêéÂ§ÑÁêÜÂæÖÂêåÊ≠•ÈòüÂàó
            }
            
            // ÂêØÂä®ÂÆûÊó∂ÂêåÊ≠•
            if (CLOUD_SYNC_CONFIG.enableSync) {
                setTimeout(() => {
                    realtimeSyncManager.startRealtimeSync();
                }, 3000); // 3ÁßíÂêéÂêØÂä®ÂÆûÊó∂ÂêåÊ≠•
            }
        });
        
        // Á™óÂè£Â§ßÂ∞èÊîπÂèòÊó∂ÈáçÊñ∞ÈÄÇÈÖç
        window.addEventListener('resize', function() {
            if (document.body.classList.contains('wechat-optimized')) {
                detectWeChatBrowser();
            }
        });
    </script>
</body>
</html>